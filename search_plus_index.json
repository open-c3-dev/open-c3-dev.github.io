{"./":{"url":"./","title":"介绍","keywords":"","body":"介绍 本文档为开发指南，展示更细致的代码相关细节。非开发者请查看用户手册 https://open-c3.github.io Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 22:55:00 "},"FAQ/":{"url":"FAQ/","title":"FAQ","keywords":"","body":"大家最常见的问题 Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2024-02-21 01:02:16 "},"服务相关/":{"url":"服务相关/","title":"服务相关","keywords":"","body":"容器内不能上外网【通信方式：bridge】 $ sudo service docker stop $ sudo pkill docker $ sudo iptables -t nat -F $ sudo ifconfig docker0 down $ sudo brctl delbr docker0 $ sudo service docker start 安装OPEN-C3集群后，页面获取机器信息报错 解决办法：重启服务 上传镜像因文件太大而失败 修改Nginx配置文件，添加如下配置【文件名：/etc/nginx/nginx.conf 】 client_max_body_size 2048m; 如： http { include /etc/nginx/mime.types; default_type application/octet-stream; log_format main '$remote_addr - $remote_user [$time_local] \"$request\" ' '$status $body_bytes_sent \"$http_referer\" ' '\"$http_user_agent\" \"$http_x_forwarded_for\"'; client_max_body_size 2048m; access_log /var/log/nginx/access.log main; sendfile on; #tcp_nopush on; keepalive_timeout 65; #gzip on; include /etc/nginx/conf.d/*.conf; } 单机版中第一次拉取新git仓库代码出错 把容器中mydan的版本更新到最新，新的/data/Software/mydan/dan/tools/git中 会处理StrictHostKeyChecking=no。 集群版的没有这个问题。 OPEN-C3中提交的服务任务分配异常 集群机器时间不同步，运行下面命令启动时间同步服务。 /data/Software/mydan/dan/tools/ntpsync -d 显示的任务时间不对 时区不正确，通过mysql命令查看时间：select curtime(); 如果时区不正确需要通过下面方式进行调整。 第一种方法： 这种方法，不需要重启mysql，但是重启mysql时需要重新设置。 > set global time_zone = '+8:00'; ##修改mysql全局时区为北京时间 > set time_zone = '+8:00'; ##修改当前会话时区 > flush privileges; #立即生效 第二种方法：这种方式需要重启mysql。 # vim /etc/my.cnf ##在[mysqld]区域中加上 default-time_zone = '+8:00' # /etc/init.d/mysqld restart ##重启mysql使新时区生效 通过机器进行构建，不下载密钥也能正常使用 OPEN-C3服务端需要安装最新的mydan才能进行构建机器的私钥分离。否则会引起权限问题， 让不应该有权限的人访问到其他人的构建机。 运行环境：centos8+docker20+ 安装报错 运行环境：centos8+docker20+ 错误描述： 在服务器安装docker后生成容器时出现出如下错误 runc: symbol lookup error: runc: undefined symbol: seccomp_api_get 错误原因： 这是缺少头文件或者相关的库之类的问题，是缺少了依赖包，于是安装依赖包 解决办法： yum install libseccomp-devel 集群版制定域名【可以不做该操作，直接域名指向即可】 【注：在新版本中已经做了80端口的默认配置，不在需要指定域名】 在集群版安装步骤“部署应用”中，可以通过添加环境变量来进行域名绑定，只需要第一次部署的时候添加即可。 也可以随时在发布的时候通过这个变量来切换域名。 命令如： C3_DOMAIN=myopenc3.myopenc3.org /data/open-c3/Installer/scripts/cluster.sh deploy --envname bar --version 20210316 # myopenc3.myopenc3.org 即想绑定的域名 添加环境变量C3_DOMAIN逻辑上做了以下配置文件的修改操作 cd /etc/nginx/conf.d && cp open-c3.conf open-c3.pri.conf cat open-c3.pri.conf server { listen 80; server_name myopenc3.myopenc3.org; #这里改成自己的域名 location / { proxy_pass http://127.0.0.1:88; proxy_redirect off; proxy_set_header X-Real-IP $remote_addr; proxy_set_header Host $host:$server_port; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_http_version 1.1; proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection \"upgrade\"; } } Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2024-02-21 01:02:17 "},"通知模版可用变量/":{"url":"通知模版可用变量/","title":"通知模版可用变量","keywords":"","body":"通知模版可用变量 作业任务通知模版 作业名称:${name} 任务编号:${uuid} 作业状态:${status} 服务树名称:${projectname} 可以通过下面链接访问作业：http://域名/#/history/jobdetail/${projectid}/${uuid} 构建通知模版 状态: ${status} 服务树:${treename} 项目名称: ${projectname} 代码仓库地址: ${addr} 版本: ${version} 触发测试环境发布: ${calltestenv} 触发线上环境发布: ${callonlineenv} 错误信息: ${errormsg} 构建日志: ${buildlog} 通过下面链接可以访问流水线:http://域名/#/quickentry/flowlinedetail/${treeid}/${projectid} 审批通知模版 审批内容: ${cont} 审批链接:http://域名/#/quickapproval/${uuid} 极速审批【访问速度快】:http://域名/api/job/approval/fast/${uuid} cont具体内容变量 监控系统告警通知模版 告警名称: ${labels.alertname} 状态中文状态：${statusZH} 状态英文状态：${status} 告警时间中国时区: ${startsAtZH} 告警时间世界时间: ${startsAt} 监控对象: ${labels.instance} 告警名称: ${labels.alertname} 告警概要: ${annotations.summary} 服务树名称: ${treename} 别名【主机监控事是机器的hostname，mysql监控是别名】: ${hostname} 故障描述：${annotations.descriptions} 邮件系统邮件内容监控通知模版 账号名称：${labels.account} 邮件标题: ${labels.subject} 邮件内容：${labels.content} Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2024-02-21 01:02:17 "},"开发手册/":{"url":"开发手册/","title":"开发手册","keywords":"","body":"说明 本目录是从open-c3代码中自动生成的 Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2024-02-21 01:02:16 "},"open-c3-code/docs/code-commit.html":{"url":"open-c3-code/docs/code-commit.html","title":" 1代码提交/提交分支 ","keywords":"","body":"1代码提交/提交分支 说明 如果您有代码需要提交，请提交到 v2.6.0 C3当前主要版本v2.6.1、v2.6.0 v2.6.1 为线上稳定版本 v2.6.0 部分客户使用该版本 代码提交到v2.6.0后，测试如果通过，会合并到v2.6.0， v2.6.0版本稳定运行后的代码会合并到v2.6.1 Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/docs/automatic-packaging.html":{"url":"open-c3-code/docs/automatic-packaging.html","title":" 1代码提交/自动构建 ","keywords":"","body":"1代码提交/自动构建 代码自动打包 原因说明 C3系统使用了多个语言进行编写，包括perl、python、golang等 在不同的部署环境下，可能会因为网络问题导致依赖的模块下载失败。 所以在C3系统中，会把perl、python等依赖的包提前打包，对于golang的程序会提前编译。 在真正发布的时候会在C3镜像中获取已提前编译好的程序和依赖包。 手动处理 在提交代码时，在commit中描述需要进行自动打包的部分，格式：c3c3bot:autopkg(模块名)。 如: 您在python3中使用了一个新的模块,在代码中您已经描述了依赖的模块和版本， 在您提交代码的时候，在commit内容中包含字符串 \"c3c3bot:autopkg(python3)\" 当你的代码被合并进来后，C3的自动构建程序会发现该提交是需要重新构建python3的。 C3会选择一个时间进行自动构建，保证构建出来的最新python3的时间是您这个commit的时间之后。 注: 其中c3bot:autopkg:renew指令用于重新开始计算是否需要构建模块。 模块自动更新后会生成格式如 c3c3bot:autopkg(模块名:版本号) 的提交。 自动处理 除了以上说，提交代码时在commit中描述打包指令，自动工具也会自动进行对比。 如果发现对应模块的核心文件被编辑了，也会进行自动构建。 模块范围 当前涉及到的模块如下: perl python3 mysql install-cache dev-cache book trouble-ticketing jumpserver Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/Connector/pp/dtool/todo.html":{"url":"open-c3-code/Connector/pp/dtool/todo.html","title":" 2TODO/1.说明 ","keywords":"","body":"2TODO/1.说明 注：开发者必看 在设计或者编码的时候，如果有需要改进的地方，请使用如下格式进行标注， C3的文档工具会自动提取出内容归档到TODO列表中。 格式: # C3TODO 日期(6个数字，年月日) 标题 该行下面如果有一样内容的格式，会被识别为详情。 如perl中的注视时“#”号开头，可以在perl的代码中写上如下内容 # C3TODO 230203 测试todo功能1 # 如下内容用于测试todo自动提取 # 如果该内容出现在todo列表中，请忽略 # C3TODO 230203 测试todo功能2,只有标题 Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/c3todo.html":{"url":"open-c3-code/c3todo.html","title":" 2TODO/2.列表 ","keywords":"","body":"2TODO/2.列表 230831 falcon兼容程序失败重连问题 后端服务网络失败后，原先的设计是重连重试，所以使用的delete操作让连接重建 但是使用过程中会导致tcp释放不干净导致内存泄漏。 编辑 230316 前端请求了两次，会导致系统变慢，这里临时让toxlsx的时候返回全量的数据 delete $x->{$col}; 编辑 230424 清理c3_test相关代码 确认后续不再使用c3_test凭据，需要清理相关代码 编辑 230419 作业模块日志HTML解析问题 日志显示的时候会解析HTML的标签。这样导致的结果是，如果输出的日志内容里面有html的标签 可能会解析失败，比如gcp的sdk报错的时候会使用HttpError的标签 但是默认没有这个标签，这样在日志那里就看不到这个错误的信息。 编辑 230313 BPM表单，面对数字类型的数据load方式优化 用YAML::XS 直接load会导致数字类型加载进来后，在接口上得到的是字符串类型，这样会导致前端的显示异常 这里使用了yaml2json进行转换，看是否有其它更好的方式 编辑 230303 作业平台的插件应该使用pkg中的python pkg中有C3已经打包好的python，应该使用/data/Software/mydan/python3/bin/python3 如果有缺少的模块就可以进行统一管理 编辑 230306 BPM表单的数据，存入后重新获取后，整型变成了字符串类型 这里的multitempidx存入时是一个数字，存入后重新获取，变成了一个字符串 现在通过Number进行转换，应该处理一下接口让其返回数字类型 编辑 230821 该文件为旧版导航菜单文件，待新版本模块菜单稳定后可以删除掉 --> 编辑 230724 nginx中single.open-c3.org.conf的81端口暂时没有对外开放 后面经过反复测试后，应该把这个81端口作为入口。 或者把这里的81端口改成88端口，把原来的88端口更换一个端口。 这里涉及到第三方应用在这个变更之后会不会受影响。 编辑 230406 体验版的lotus/ooze问题需要处理 体验版也要做lotus/ooze的判断 `` 编辑 230302 此处不应该直接读取sysctl.conf文件，应该通过OPENC3::SysCtl模块来完成该操作。 编辑 230203 测试todo功能1 如下内容用于测试todo自动提取 如果该内容出现在todo列表中，请忽略 编辑 230203 测试todo功能2,只有标题 编辑 230814 启动完一个实例后休眠一段时间，尝试避免aws接口出现资源容量不足的错误 编辑 240605 这里要识别更多的Git的地址格式 编辑 230303 目前拉取ks3使用了kec的区域列表 但是kec的某些区域不在官方的域名列表里，比如cn-taipei-1, 此时拉取会出现域名解析错误, 因此拉取ks3时， 不在官方区域列表里的区域被自动跳过了 编辑 230404 华为云sfs-turbo没有测试用例所以同步功能只做了一半 下面代码应该可以正常获取sfs turbo实例 获取sfs的标签需要单独调其他接口， 测试ak没有sfs butbo资源，暂时先不做了 编辑 231210 都柏林是一个特殊的地区, 直接获取会获取到其他vpc，然后会因为没有权限而报错 编辑 230421 谷歌云lb同步可能需要扩展这里查询到的信息 谷歌云LB没有一个可以一次性查到lb所有信息的接口，目前看urlMap的 list方法获取的结果里包含了lb名称，其他接口查到的都是lb的其他相关信息 但是这个方法查询到的信息较少，可能需要扩展 编辑 230710 prom/mysqld-exporter使用最新版本报错 C3一直使用的v0.14.0版本，但是现在mysqld-exporter升级到v0.15.0版本后采集报错。 固定使用v0.14.0版本。 编辑 240609 主机宕控扩展监控不支持代理 该功能目前只能在全网通的情况下使用，在监控主机是否活着的时候， 任务是在Open-C3主机上执行的，没有区分情况把任务调度到代理机器上执行。 编辑 240305 ubuntu系统编译python不支持 --enable-optimizations 参数 添加这个参数的情况下，编辑过程会卡住 编辑 Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/AGENT/agent.mon/perl_patch/":{"url":"open-c3-code/AGENT/agent.mon/perl_patch/","title":" Agent/perl模块管理 ","keywords":"","body":"Agent/perl模块管理 OpenC3的agent在迭代开发过程中，可能会引用新的cpan.org上的依赖模块。 目前还没有形成一个perl的自动编译安装流程，所以在有新依赖包引入的时候。 当线上服务器agent升级时，需要连接公网进行依赖包的安装。 有的机器可能不能上公网，或者访问不了海外。新加的依赖模块临时放在这里管理。 当前的依赖模块: AnyEvent::HTTP AnyEvent::Ping Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/docs/api.html":{"url":"open-c3-code/docs/api.html","title":" API/1.接口规范 ","keywords":"","body":"API/1.接口规范 数据返回 如没有特殊情况,返回的数据都是如下结构: { stat: 1 data: [ \"foo\", \"bar\" ] info: \"ok\" } 字段说明: stat: 必须存在，只有两个状态，0或者1. 为1时表示接口返回正常。 data: 如有返回数据，通过data字段携带, 格式可以是数组，hash，字符串或数字。 info: 当stat为0时说明服务后端错误，通过info返回错误的原因。 V2版本接口: #下面的请求支持v2版本，如\"/api/ci/c3mc/foo\", 可以调用 \"/api/ci/v2/c3mc/foo\", 数据返回的内容一致。 #V2版本支持更高的并发和更好的超时处理。 ci: [ qw( GET POST DELETE ) ] => '/kubernetes/*' [ qw( GET POST DELETE ) ] => '/c3mc/*' agent: GET => '/cloudmonmetrics/*' Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/api.html":{"url":"open-c3-code/api.html","title":" API/文档 ","keywords":"","body":"API/文档 AGENT/代理/获取列表 API: get http://127.0.0.1/api/agent/proxy/:projectid' 编辑 AGENT/代理/获取详情 API: get http://127.0.0.1/api/agent/proxy/:projectid/:regionid' Param: projectid => qr/^\\d+$/, 1, regionid => qr/^\\d+$/, 1, 编辑 AGENT/代理/删除 API: del http://127.0.0.1/api/agent/proxy/:projectid/:proxyid' Param: projectid => qr/^\\d+$/, 1, proxyid => qr/^\\d+$/, 1, 编辑 AGENT/代理/添加代理 API: post http://127.0.0.1/api/agent/proxy/:projectid/:regionid' Param: projectid => qr/^\\d+$/, 1, regionid => qr/^\\d+$/, 1, ip => qr/^[a-zA-Z0-9 \\-\\._,]+$/, 1, 编辑 AGENT/区域/获取列表 API: get http://127.0.0.1/api/agent/region/:projectid' relation 同时返回项目0的列表 编辑 AGENT/区域/创建区域 API: post http://127.0.0.1/api/agent/region/:projectid' Param: projectid => qr/^\\d+$/, 1, name => [ 'mismatch', qr/'/ ], 1, 编辑 AGENT/区域/删除 API: del http://127.0.0.1/api/agent/region/:projectid/:regionid' Param: projectid => qr/^\\d+$/, 1, regionid => qr/^\\d+$/, 1, 编辑 AGENT/区域/获取活跃区域信息 API: get http://127.0.0.1/api/agent/region/:projectid/active' 编辑 AGENT/区域管理/获取区域和服务树的绑定关系 API: get http://127.0.0.1/api/agent/project_region_relation/:projectid' 编辑 AGENT/区域管理/添加区域和服务树的绑定关系 API: post http://127.0.0.1/api/agent/project_region_relation/:projectid' Param: projectid => qr/^\\d+$/, 1, regionid => qr/^\\d+$/, 1, 编辑 AGENT/区域管理/解除区域和服务树的绑定关系 API: del http://127.0.0.1/api/agent/project_region_relation/:projectid/:regionid' Param: projectid => qr/^\\d+$/, 1, regionid => qr/^\\d+$/, 1, 编辑 AGENT/自动检查/获取开关状态 API: get http://127.0.0.1/api/agent/check/:projectid' 编辑 AGENT/自动检查/修改开关状态 API: post http://127.0.0.1/api/agent/check/:projectid' Param: projectid => qr/^\\d+$/, 1, status => qr/^[a-z]+$/, 1, 编辑 AGENT/获取安装列表 API: get http://127.0.0.1/api/agent/install/:projectid' 编辑 AGENT/获取安装详情 API: get http://127.0.0.1/api/agent/install/:projectid/:uuid' Param: projectid => qr/^\\d+$/, 1, uuid => qr/^[a-zA-Z0-9]+$/, 1, 编辑 AGENT/安装agent API: post http://127.0.0.1/api/agent/install/:projectid/:regionid' Param: projectid => qr/^\\d+$/, 1, regionid => qr/^\\d+$/, 1, ip => qr/^[a-zA-Z0-9 \\-\\._,]+$/, 1, type => qr/^[a-z_]+$/, 1, username => qr/^[a-zA-Z0-9\\-]+$/, 0, password => qr/^.*$/, 0, 编辑 AGENT/获取服务树下agent列表 API: get http://127.0.0.1/api/agent/agent/:projectid' 编辑 AGENT/获取服务树下某区域的agent列表 API: get http://127.0.0.1/api/agent/agent/:projectid/:regionid' Param: projectid => qr/^\\d+$/, 1, regionid => qr/^\\d+$/, 1, 编辑 AGENT/在区域中添加子网地址 API: post http://127.0.0.1/api/agent/agent/:projectid/:regionid/subnet' Param: projectid => qr/^\\d+$/, 1, regionid => qr/^\\d+$/, 1, subnet => qr/^[\\^\\$a-zA-Z\\-\\*\\d\\.\\/, ]+$/, 1, 编辑 AGENT/删除agent API: del http://127.0.0.1/api/agent/agent/:projectid/:agentid' Param: projectid => qr/^\\d+$/, 1, agentid => qr/^\\d+$/, 1, 编辑 AWS/ECS/获取服务列表 API: get http://127.0.0.1/api/ci/awsecs/:treeid' 编辑 BASE/获取用户领导信息 API: get http://127.0.0.1/api/ci/c3mc/base/userleader' Param: user => qr/^[a-zA-Z0-9][a-zA-Z0-9\\.\\-_\\@]+$/, 1, 编辑 BPM/管理/获取k8s应用模版列表 API: get http://127.0.0.1/api/job/bpm/k8sapptpl' 编辑 BPM/管理/获取某个k8s应用模版的内容 API: get http://127.0.0.1/api/job/bpm/k8sapptpl/:name' Param: name => qr/^[a-zA-Z0-9][a-zA-Z0-9\\-]+$/, 1, 编辑 BPM/管理/编辑某个模版 API: post http://127.0.0.1/api/job/bpm/k8sapptpl' Param: name => qr/^[a-zA-Z0-9][a-zA-Z0-9\\-]+$/, 1, 编辑 BPM/获取BPM下拉选项 API: post http://127.0.0.1/api/ci/c3mc/bpm/optionx' Param: jobname => qr/^[a-zA-Z0-9][a-zA-Z\\d\\-]+$/, 1, stepname => qr/^\\d+\\.[a-zA-Z0-9][a-zA-Z\\d\\-_\\.]+$/, 1, 编辑 BPM/获取BPM下拉选项 API: post http://127.0.0.1/api/ci/c3mc/bpm/optchk' Param: jobname => qr/^[a-zA-Z0-9][a-zA-Z\\d\\-]+$/, 1, stepname => qr/^\\d+\\.[a-zA-Z0-9][a-zA-Z\\d\\-_\\.]+$/, 1, 编辑 BPM/获取bpm列表 API: get http://127.0.0.1/api/job/bpm/menu' 编辑 BPM/获取bpm流程的变量 API: get http://127.0.0.1/api/job/bpm/variable/:bpmname' Param: bpmname => qr/^[a-zA-Z\\d][a-zA-Z\\d\\-]+$/, 1, 编辑 BPM/获取bpm流程中的日志 API: get http://127.0.0.1/api/job/bpm/log/:bpmuuid' Param: bpmuuid => qr/^[a-zA-Z\\d]+$/, 1, 编辑 BPM/获取bpm某个流程的变量 API: get http://127.0.0.1/api/job/bpm/var/:bpmuuid' Param: bpmuuid => qr/^[a-zA-Z\\d]+$/, 1, 编辑 BPM/编辑流程 API: post http://127.0.0.1/api/job/bpm/var/:bpmuuid' Param: bpmuuid => qr/^[a-zA-Z\\d]+$/, 1, 编辑 BPM/获取bpm流程保护信息 API: get http://127.0.0.1/api/job/bpm/protect/:bpmuuid' Param: bpmuuid => qr/^[a-zA-Z\\d]+$/, 1, 编辑 BPM/BPM流程保护审批意见 API: post http://127.0.0.1/api/job/bpm/protect/:bpmuuid' Param: bpmuuid => qr/^[a-zA-Z\\d]+$/, 1, opinion => [ 'in', 'agree', 'refuse' ], 1, 编辑 BPM/获取BPM任务的UUID API: get http://127.0.0.1/api/job/bpm/taskuuid/:bpmuuid' Param: bpmuuid => qr/^[a-zA-Z\\d]+$/, 1, 编辑 BPM/通过任务UUID获取BPMUUID API: get http://127.0.0.1/api/job/bpm/bpmuuid/:taskuuid' Param: taskuuid => qr/^[a-zA-Z\\d]+$/, 1, 编辑 BPM/查询这个流程是不是当前需要我处理的 API: get http://127.0.0.1/api/job/bpm/deal/:bpmuuid' Param: bpmuuid => qr/^[a-zA-Z\\d]+$/, 1, 编辑 BPM/设置流程处理状态 API: post http://127.0.0.1/api/job/bpm/deal/:bpmuuid' Param: bpmuuid => qr/^[a-zA-Z\\d]+$/, 1, opinion => [ 'in', 'agree', 'refuse' ], 1, 编辑 BPM/管理/获取bpm列表详情 API: get http://127.0.0.1/api/job/bpm/manage/menu' Param: name => [ 'mismatch', qr/'/ ], 0, 编辑 BPM/管理/获取详情 API: get http://127.0.0.1/api/job/bpm/manage/conf/:bpmname' Param: bpmname => qr/^[a-zA-Z\\d][a-zA-Z\\d\\-]+$/, 1, 编辑 BPM/管理/创建或编辑 API: post http://127.0.0.1/api/job/bpm/manage/conf/:bpmname' Param: bpmname => qr/^[a-zA-Z\\d][a-zA-Z\\d\\-]+$/, 1, 编辑 BPM/管理/删除 API: del http://127.0.0.1/api/job/bpm/manage/conf/:bpmname' Param: bpmname => qr/^[a-zA-Z\\d][a-zA-Z\\d\\-]+$/, 1, 编辑 BPM/管理/获取插件列表 API: get http://127.0.0.1/api/job/bpm/manage/plugin/list' 编辑 BPM/管理/获取插件列表 API: get http://127.0.0.1/api/job/bpm/manage/plugin/conf/:name' Param: name => qr/^[a-zA-Z\\d][a-zA-Z\\d\\-]+$/, 1, 编辑 BPM/管理/修改BPM显示开关 API: any http://127.0.0.1/api/job/bpm/manage/show/:name/:show' Param: name => qr/^[a-zA-Z\\d][a-zA-Z\\d\\-]+$/, 1, show => qr/^\\d+$/, 1, 编辑 BPM/获取bpm定时任务列表 API: get http://127.0.0.1/api/job/bpm/crontask' 编辑 BPM/上传附件 API: post http://127.0.0.1/api/job/bpm/attachments' Param: filename => [ 'mismatch', qr/'/ ], 1, tempname => [ 'mismatch', qr/'/ ], 1, size => qr/^\\d+$/, 1, )->check( %$info ); return +{ stat => $JSON::false, info => \"check format fail $error\" } if $error; my ( $filename, $tempname, $size ) = @$info{qw( filename tempname size )}; open my $fh, \" $JSON::false, info => 'open file fail' }; my $md5 = Digest::MD5->new()->addfile( $fh )->hexdigest; close $fh; return +{ stat => $JSON::false, info => 'rename fail' } if system \"mv '$tempname' '$path/$md5' && chmod a+r '$path/$md5'\"; $res{$md5} = $filename; } return +{ stat => $JSON::true, data => \\%res }; }; 编辑 CI/代码合并 API: post http://127.0.0.1/api/ci/c3mc/cicodemerge/:flowid/:srcbranch/:dstbranch' Param: flowid => qr/^\\d+$/, 1, srcbranch => qr/^[a-zA-Z0-9][a-zA-Z0-9_\\-\\.]*$/, 1, dstbranch => qr/^[a-zA-Z0-9][a-zA-Z0-9_\\-\\.]*$/, 1, 编辑 CI/展示CI发布的对象 API: get http://127.0.0.1/api/ci/c3mc/cishowtarget/:flowid' Param: flowid => qr/^\\d+$/, 1, 编辑 CI/获取Tags列表 API: get http://127.0.0.1/api/ci/c3mc/citags/:projectid' Param: projectid => qr/^\\d+$/, 1, 编辑 CI/通过Tags提交构建任务 API: any http://127.0.0.1/api/ci/c3mc/citags/:projectid/:tags' Param: projectid => qr/^\\d+$/, 1, tags => qr/^[a-zA-Z0-9][a-zA-Z0-9\\-\\._]+$/, 1, 编辑 CI/获取分支列表 API: get http://127.0.0.1/api/ci/c3mc/cibranch/:projectid' Param: projectid => qr/^\\d+$/, 1, 编辑 CI/通过分支提交构建任务 API: any http://127.0.0.1/api/ci/c3mc/cibranch/:projectid/:branch' Param: projectid => qr/^\\d+$/, 1, branch => qr/^[a-zA-Z0-9][a-zA-Z0-9\\-\\._]+$/, 1, 编辑 CI/进入构建调试的shell中 API: any http://127.0.0.1/api/ci/dockershell' 编辑 CI镜像/获取镜像列表 API: get http://127.0.0.1/api/ci/images' 编辑 CI镜像/获取某个镜像详情 API: get http://127.0.0.1/api/ci/images/:imagesid' Param: imagesid => qr/^\\d+$/, 1, 编辑 CI镜像/获取某个镜像的公钥 API: get http://127.0.0.1/api/ci/images/:imagesid/sshkey.pub' 把主机当作镜像来用时，在主机安装agent过程中， 会通过这个地址下载公钥。 Param: imagesid => qr/^\\d+$/, 1, 编辑 CI镜像/创建镜像 API: post http://127.0.0.1/api/ci/images' Param: name => [ 'mismatch', qr/'/ ], 1, describe => [ 'mismatch', qr/'/ ], 1, 编辑 CI镜像/编辑镜像 API: post http://127.0.0.1/api/ci/images/:imagesid' Param: imagesid => qr/^\\d+$/, 1, name => [ 'mismatch', qr/'/ ], 1, describe => [ 'mismatch', qr/'/ ], 1, 编辑 CI镜像/删除镜像 API: del http://127.0.0.1/api/ci/images/:imagesid' Param: imagesid => qr/^\\d+$/, 1, 编辑 CI镜像/镜像上传/获取状态 API: get http://127.0.0.1/api/ci/images/:imagesid/upload' 编辑 CI镜像/镜像上传/提交上传文件 API: post http://127.0.0.1/api/ci/images/:imagesid/upload' 编辑 CMDB/云帐号管理/AWS/获取列表 API: get http://127.0.0.1/api/agent/cmdbmanage/account/aws' 编辑 CMDB/云帐号管理/AWS/获取详情 API: get http://127.0.0.1/api/agent/cmdbmanage/account/aws/:id' Param: id => qr/^\\d+$/, 1, 编辑 CMDB/云帐号管理/AWS/添加或编辑帐号 API: post http://127.0.0.1/api/agent/cmdbmanage/account/aws' Param: id => qr/^\\d+$/, 0, accountname => [ 'mismatch', qr/'/ ], 1, accesskey => [ 'mismatch', qr/'/ ], 1, secretkey => [ 'mismatch', qr/'/ ], 1, region => [ 'mismatch', qr/'/ ], 1, note => [ 'mismatch', qr/'/ ], 1, 编辑 CMDB/云帐号管理/AWS/删除帐号 API: del http://127.0.0.1/api/agent/cmdbmanage/account/aws/:id' Param: id => qr/^\\d+$/, 1, 编辑 CMDB/云帐号管理/IBM/获取列表 API: get http://127.0.0.1/api/agent/cmdbmanage/account/ibm' 编辑 CMDB/云帐号管理/IBM/获取详情 API: get http://127.0.0.1/api/agent/cmdbmanage/account/ibm/:id' Param: id => qr/^\\d+$/, 1, 编辑 CMDB/云帐号管理/IBM/添加或编辑帐号 API: post http://127.0.0.1/api/agent/cmdbmanage/account/ibm' Param: id => qr/^\\d+$/, 0, accountname => [ 'mismatch', qr/'/ ], 1, username => [ 'mismatch', qr/'/ ], 1, api_key => [ 'mismatch', qr/'/ ], 1, vpc_name => [ 'mismatch', qr/'/ ], 1, note => [ 'mismatch', qr/'/ ], 1, 编辑 CMDB/云帐号管理/IBM/删除帐号 API: del http://127.0.0.1/api/agent/cmdbmanage/account/ibm/:id' Param: id => qr/^\\d+$/, 1, 编辑 CMDB/云帐号管理/华为云/获取列表 API: get http://127.0.0.1/api/agent/cmdbmanage/account/huawei' 编辑 CMDB/云帐号管理/华为云/获取详情 API: get http://127.0.0.1/api/agent/cmdbmanage/account/huawei/:id' Param: id => qr/^\\d+$/, 1, 编辑 CMDB/云帐号管理/华为云/添加或编辑帐号 API: post http://127.0.0.1/api/agent/cmdbmanage/account/huawei' Param: id => qr/^\\d+$/, 0, accountname => [ 'mismatch', qr/'/ ], 1, accesskey => [ 'mismatch', qr/'/ ], 1, secretkey => [ 'mismatch', qr/'/ ], 1, project => [ 'mismatch', qr/'/ ], 1, region => [ 'mismatch', qr/'/ ], 1, iamid => [ 'mismatch', qr/'/ ], 1, note => [ 'mismatch', qr/'/ ], 1, 编辑 CMDB/云帐号管理/华为云/删除帐号 API: del http://127.0.0.1/api/agent/cmdbmanage/account/huawei/:id' Param: id => qr/^\\d+$/, 1, 编辑 CMDB/云帐号管理/腾讯云/获取列表 API: get http://127.0.0.1/api/agent/cmdbmanage/account/qcloud' 编辑 CMDB/云帐号管理/腾讯云/获取详情 API: get http://127.0.0.1/api/agent/cmdbmanage/account/qcloud/:id' Param: id => qr/^\\d+$/, 1, 编辑 CMDB/云帐号管理/腾讯云/添加或编辑帐号 API: post http://127.0.0.1/api/agent/cmdbmanage/account/qcloud' Param: id => qr/^\\d+$/, 0, accountname => [ 'mismatch', qr/'/ ], 1, accesskey => [ 'mismatch', qr/'/ ], 1, secretkey => [ 'mismatch', qr/'/ ], 1, region => [ 'mismatch', qr/'/ ], 1, accountid => [ 'mismatch', qr/'/ ], 1, note => [ 'mismatch', qr/'/ ], 1, 编辑 CMDB/云帐号管理/腾讯云/删除帐号 API: del http://127.0.0.1/api/agent/cmdbmanage/account/qcloud/:id' Param: id => qr/^\\d+$/, 1, 编辑 CMDB/云帐号管理/谷歌云/获取列表 API: get http://127.0.0.1/api/agent/cmdbmanage/account/google' 编辑 CMDB/云帐号管理/谷歌云/获取详情 API: get http://127.0.0.1/api/agent/cmdbmanage/account/google/:id' Param: id => qr/^\\d+$/, 1, 编辑 CMDB/云帐号管理/谷歌云/添加或编辑帐号 API: post http://127.0.0.1/api/agent/cmdbmanage/account/google' Param: id => qr/^\\d+$/, 0, accountname => [ 'mismatch', qr/'/ ], 1, credentials => [ 'mismatch', qr/'/ ], 1, region => [ 'mismatch', qr/'/ ], 1, note => [ 'mismatch', qr/'/ ], 1, 编辑 CMDB/云帐号管理/谷歌云/删除帐号 API: del http://127.0.0.1/api/agent/cmdbmanage/account/google/:id' Param: id => qr/^\\d+$/, 1, 编辑 CMDB/云帐号管理/金山云/获取列表 API: get http://127.0.0.1/api/agent/cmdbmanage/account/ksyun' 编辑 CMDB/云帐号管理/金山云/获取详情 API: get http://127.0.0.1/api/agent/cmdbmanage/account/ksyun/:id' Param: id => qr/^\\d+$/, 1, 编辑 CMDB/云帐号管理/金山云/添加或编辑帐号 API: post http://127.0.0.1/api/agent/cmdbmanage/account/ksyun' Param: id => qr/^\\d+$/, 0, accountname => [ 'mismatch', qr/'/ ], 1, accesskey => [ 'mismatch', qr/'/ ], 1, secretkey => [ 'mismatch', qr/'/ ], 1, region => [ 'mismatch', qr/'/ ], 1, note => [ 'mismatch', qr/'/ ], 1, 编辑 CMDB/云帐号管理/金山云/删除帐号 API: del http://127.0.0.1/api/agent/cmdbmanage/account/ksyun/:id' Param: id => qr/^\\d+$/, 1, 编辑 CMDB/云帐号管理/阿里云/获取列表 API: get http://127.0.0.1/api/agent/cmdbmanage/account/aliyun' 编辑 CMDB/云帐号管理/阿里云/获取详情 API: get http://127.0.0.1/api/agent/cmdbmanage/account/aliyun/:id' Param: id => qr/^\\d+$/, 1, 编辑 CMDB/云帐号管理/阿里云/添加或编辑帐号 API: post http://127.0.0.1/api/agent/cmdbmanage/account/aliyun' Param: id => qr/^\\d+$/, 0, accountname => [ 'mismatch', qr/'/ ], 1, accesskey => [ 'mismatch', qr/'/ ], 1, secretkey => [ 'mismatch', qr/'/ ], 1, region => [ 'mismatch', qr/'/ ], 1, note => [ 'mismatch', qr/'/ ], 1, 编辑 CMDB/云帐号管理/阿里云/删除帐号 API: del http://127.0.0.1/api/agent/cmdbmanage/account/aliyun/:id' Param: id => qr/^\\d+$/, 1, 编辑 CMDB/修改资源密码 API: any http://127.0.0.1/api/agent/device/chpassword' mysql/redis/mongodb 监控时需要登录帐号，在CMDB中管理该帐号 Param: dbtype => qr/^[a-zA-Z0-9][a-zA-Z0-9\\-]+[a-zA-Z0-9]$/, 1, dbaddr => qr/^[a-zA-Z0-9][a-zA-Z0-9\\-:\\.]+[a-zA-Z0-9]$/, 1, #passwd 编辑 CMDB/管理/获取账号类型列表 API: get http://127.0.0.1/api/agent/cmdbmanage' 编辑 CMDB/管理/获取某个公有云的配置 API: get http://127.0.0.1/api/agent/cmdbmanage/:name' Param: name => qr/^[a-zA-Z0-9][a-zA-Z0-9\\-]+$/, 1, 编辑 CMDB/管理/编辑某个公有云的配置 API: post http://127.0.0.1/api/agent/cmdbmanage' Param: name => qr/^[a-zA-Z0-9][a-zA-Z0-9\\-]+$/, 1, 编辑 CMDB/获取CMDB数据 API: get http://127.0.0.1/api/ci/c3mc/cmdb' Param: type => qr/^[a-zA-Z0-9][a-zA-Z0-9\\-]+$/, 1, subtype => qr/^[a-zA-Z0-9][a-zA-Z0-9\\-]+$/, 1, alias => qr/^\\d+$/, 0, 编辑 CMDB/获取菜单 API: get http://127.0.0.1/api/ci/c3mc/cmdb/menu' Param: treeid => qr/^\\d+$/, 1, timemachine => qr/^[a-z0-9][a-z0-9\\-]+[a-z0-9]$/, 1, 编辑 CMDB/获取子分类的表格 API: any http://127.0.0.1/api/agent/device/data/:type/:subtype/:treeid' Param: type => qr/^[a-z\\d\\-_]+$/, 1, subtype => qr/^[a-z\\d\\-_]+$/, 1, treeid => qr/^\\d+$/, 1, timemachine => qr/^[a-z0-9][a-z0-9\\-]+[a-z0-9]$/, 1, # grepdata toxlsx => qr/^\\d+$/, 0, 编辑 CMDB/获取单个资源的详情 API: any http://127.0.0.1/api/agent/device/detail/:type/:subtype/:treeid/:uuid' Param: type => qr/^[a-z\\d\\-_]+$/, 1, subtype => qr/^[a-z\\d\\-_]+$/, 1, treeid => qr/^\\d+$/, 1, uuid => qr/^[a-zA-Z0-9][a-zA-Z\\d\\-_\\.:]+$/, 1, timemachine => qr/^[a-z0-9][a-z0-9\\-]+[a-z0-9]$/, 1, hash => qr/^[a-z\\d\\-_]+$/, 0, # 默认为0，当为1时返回hash数据 exturl => qr/.*/, 0, # 扩展URL，如果有这个字段，说明需要的是url解析。数据返回解析后的url 编辑 CMDB/获取时间机器列表 API: get http://127.0.0.1/api/agent/device/timemachine' 编辑 CMDB/获取扩增字段 API: get http://127.0.0.1/api/agent/device/extcol/:type/:subtype/:uuid/:name' Param: type => qr/^[a-z\\d\\-_]+$/, 1, subtype => qr/^[a-z\\d\\-_]+$/, 1, uuid => qr/^[a-zA-Z\\d\\-_\\.:]+$/, 1, name => qr/^[a-zA-Z\\d\\-_\\.\\,]+$/, 1, 编辑 CMDB/编辑扩增字段 API: post http://127.0.0.1/api/agent/device/extcol/:type/:subtype/:uuid/:name' Param: type => qr/^[a-z\\d\\-_]+$/, 1, subtype => qr/^[a-z\\d\\-_]+$/, 1, uuid => qr/^[a-zA-Z\\d\\-_\\.:]+$/, 1, name => qr/^[a-zA-Z\\d\\-_\\.\\,]+$/, 1, 编辑 CMDB/资源绑定服务树/全量 API: any http://127.0.0.1/api/agent/device/tree/bind/:type/:subtype/:uuid/:tree' Param: type => qr/^[a-z\\d\\-_]+$/, 1, subtype => qr/^[a-z\\d\\-_]+$/, 1, uuid => qr/^[a-zA-Z\\d\\-_\\.\\:]+$/, 1, tree => qr/^[a-zA-Z\\d\\-_\\.\\,]+$/, 1, 编辑 CMDB/资源绑定服务树/增量/拷贝 API: any http://127.0.0.1/api/agent/device/tree/copy/:type/:subtype/:uuid/:tree' Param: type => qr/^[a-z\\d\\-_]+$/, 1, subtype => qr/^[a-z\\d\\-_]+$/, 1, uuid => qr/^[a-zA-Z\\d\\-_\\.\\:]+$/, 1, tree => qr/^[a-zA-Z\\d\\-_\\.\\,]+$/, 1, 编辑 CMDB/资源绑定服务树/增量/移动 API: any http://127.0.0.1/api/agent/device/tree/move/:type/:subtype/:uuid/:fromtree/:totree' Param: type => qr/^[a-z\\d\\-_]+$/, 1, subtype => qr/^[a-z\\d\\-_]+$/, 1, uuid => qr/^[a-zA-Z\\d\\-_\\.\\:]+$/, 1, fromtree => qr/^[a-zA-Z\\d\\-_\\.]+$/, 1, totree => qr/^[a-zA-Z\\d\\-_\\.]+$/, 1, 编辑 CMDB/跳板机/外网站点列表 API: get http://127.0.0.1/api/agent/device/jumpserverexipsite' 编辑 CMDB/跳板机/添加外网站点 API: post http://127.0.0.1/api/agent/device/jumpserverexipsite/:name' Param: name => qr/^[a-zA-Z0-9][a-zA-Z0-9\\-\\_]+$/, 1, 编辑 CMDB/跳板机/删除外网站点 API: del http://127.0.0.1/api/agent/device/jumpserverexipsite/:name' Param: name => qr/^[a-zA-Z0-9][a-zA-Z0-9\\-\\_]+$/, 1, 编辑 DEMO/QA的回调接口 API: any http://127.0.0.1/api/ci/demo/qa/callback' 编辑 ECS/获取ECS的描述信息 API: any http://127.0.0.1/api/ci/kubernetes/app/describe/ecs' Param: ticketid => qr/^\\d+$/, 1, 编辑 googleplay/获取包列表 API: get http://127.0.0.1/api/ci/googleplay/review/app_package_name' 编辑 googleplay/获取评论列表 API: get http://127.0.0.1/api/ci/googleplay/review' Param: appname => qr/^[\\.a-zA-Z0-9\\-_]*$/, 0, 编辑 googleplay/评论上报 API: post http://127.0.0.1/api/ci/googleplay/review/record' Param: map{ ( $_ => [ 'mismatch', qr/'/ ], 1, ) }grep{ !( $_ eq 'user_comment' || $_ eq 'developer_comment' ) }@col 编辑 GooglePlay/回复评论 API: post http://127.0.0.1/api/ci/c3mc/googleplay/review/reply' Param: review_id => qr/^.+$/, 1, text => qr/.+/, 1, callback => qr/^.+$/, 1, 编辑 JOBX/slave/获取任务日志 API: get http://127.0.0.1/api/jobx/log/:uuid' 返回的是html页面 编辑 JOBX/模块监控 API: any http://127.0.0.1/api/jobx/mon' 编辑 JOBX/模块reload API: any http://127.0.0.1/api/jobx/reload' 编辑 K8S/HPA/获取集群HPA列表 API: get http://127.0.0.1/api/ci/kubernetes/hpa' Param: ticketid => qr/^\\d+$/, 1, 编辑 K8S/HPA/创建 API: post http://127.0.0.1/api/ci/kubernetes/hpa/create' Param: ticketid => qr/^\\d+$/, 1, namespace => qr/^[\\w@\\.\\-]*$/, 1, type => qr/^[\\w@\\.\\-]*$/, 1, name => qr/^[\\w@\\.\\-]*$/, 1, min => qr/^\\d+$/, 1, max => qr/^\\d+$/, 1, cpu => qr/^\\d+$/, 1, 编辑 K8S/harbor/获取harbor中仓库列表 API: get http://127.0.0.1/api/ci/kubernetes/harbor/repository' Param: ticketid => qr/^\\d+$/, 1, 编辑 K8S/ingress/获取集群ingress列表 API: get http://127.0.0.1/api/ci/kubernetes/ingress' Param: namespace => qr/^[\\w@\\.\\-]*$/, 0, status => qr/^[a-z]*$/, 0, ticketid => qr/^\\d+$/, 1, 编辑 K8S/ingress/获取用户所有集群的ingress表格信息 API: get http://127.0.0.1/api/ci/kubernetes/app/ingress/dump' 编辑 K8S/secret/获取列表 API: get http://127.0.0.1/api/ci/kubernetes/secret' Param: ticketid => qr/^\\d+$/, 1, namespace => qr/^[\\w@\\.\\-]*$/, 0, skip => qr/^[\\w@\\.\\-\\/,]*$/, 0, 编辑 K8S/secret/创建dockerconfigjson API: post http://127.0.0.1/api/ci/kubernetes/secret/dockerconfigjson' Param: ticketid => qr/^\\d+$/, 1, namespace => qr/^[\\w@\\.\\-]*$/, 1, name => qr/^[\\w@\\.\\-]*$/, 1, server => qr/^[\\w@\\.\\-]*$/, 1, username => qr/^[\\w@\\.\\-]*$/, 1, password => [ 'mismatch', qr/'/ ], 1, email => qr/^[\\w@\\.\\-]*$/, 0, 编辑 K8S/service/获取列表 API: get http://127.0.0.1/api/ci/kubernetes/service' Param: namespace => qr/^[\\w@\\.\\-]*$/, 0, status => qr/^[a-z]*$/, 0, ticketid => qr/^\\d+$/, 1, 编辑 K8S/修改镜像地址 API: post http://127.0.0.1/api/ci/kubernetes/app/set/image' 对应K8S中的set image命令 Param: type => qr/^[\\w@\\.\\-]*$/, 1, name => qr/^[\\w@\\.\\-]*$/, 1, container => qr/^[\\w@\\.\\-]*$/, 1, namespace => qr/^[\\w@\\.\\-]*$/, 1, image => qr/^[\\w@\\.\\-\\/:]*$/, 1, ticketid => qr/^\\d+$/, 1, 编辑 K8S/调整福本数 API: post http://127.0.0.1/api/ci/kubernetes/app/set/replicas' Param: type => qr/^[\\w@\\.\\-]*$/, 1, name => qr/^[\\w@\\.\\-]*$/, 1, namespace => qr/^[\\w@\\.\\-]*$/, 1, replicas => qr/\\d+$/, 1, ticketid => qr/^\\d+$/, 1, 编辑 K8S/命名空间/获取命名空间列表 API: get http://127.0.0.1/api/ci/kubernetes/namespace' Param: ticketid => qr/^\\d+$/, 1, 编辑 K8S/命名空间/创建命名空间 API: post http://127.0.0.1/api/ci/kubernetes/namespace' Param: namespace => qr/^[a-zA-Z0-9][a-zA-Z0-9_\\-\\.]+$/, 1, ticketid => qr/^\\d+$/, 1, 编辑 K8S/备份/获取备份列表 API: get http://127.0.0.1/api/ci/kubernetes/k8sbackup' Param: ticketid => qr/^\\d+$/, 1, 编辑 K8S/备份/下载备份文件 API: get http://127.0.0.1/api/ci/kubernetes/k8sbackup/download' Param: ticketid => qr/^\\d+$/, 1, name => qr/^[a-zA-Z0-9][a-zA-Z0-9\\-\\._]+$/, 1, 编辑 K8S/备份/下载备份文件/普通角色进行下载 API: get http://127.0.0.1/api/ci/kubernetes/k8sbackup/download/mine' 只下载我有权限的命名空间 Param: ticketid => qr/^\\d+$/, 1, name => qr/^[a-zA-Z0-9][a-zA-Z0-9\\-\\._]+$/, 1, 编辑 K8S/备份/触发一次备份任务 API: post http://127.0.0.1/api/ci/kubernetes/k8sbackup' Param: ticketid => qr/^\\d+$/, 1, 编辑 K8S/按照命名空间授权/获取已授权的列表 API: get http://127.0.0.1/api/ci/kubernetes/namespaceauth/:ticketid' Param: ticketid => qr/^\\d+$/, 1, namespace => [ 'mismatch', qr/'/ ], 1, 编辑 K8S/按照命名空间授权/添加一个授权 API: post http://127.0.0.1/api/ci/kubernetes/namespaceauth/:ticketid' Param: ticketid => qr/^\\d+$/, 1, namespace => [ 'mismatch', qr/'/ ], 1, user => [ 'mismatch', qr/'/ ], 1, auth => [ 'in', 'r', 'rx', 'rw' ], 1, 编辑 K8S/按照命名空间授权/删除一个授权 API: del http://127.0.0.1/api/ci/kubernetes/namespaceauth/:ticketid/:id' Param: ticketid => qr/^\\d+$/, 1, id => qr/^\\d+$/, 1, 编辑 K8S/数据/获取模版内容 API: get http://127.0.0.1/api/ci/kubernetes/data/template/:name' Param: name => qr/^[a-zA-Z0-9_]+$/, 1, 编辑 K8S/数据/json转yaml API: any http://127.0.0.1/api/ci/kubernetes/data/json2yaml' 注: 必须通过这个来进行转换，直接在前端转换可能会有差异 Param: data => qr/.*/, 1, 编辑 K8S/数据/json转yaml/perl的现实方式 API: any http://127.0.0.1/api/ci/kubernetes/data/json2yaml/perl' 注: 旧的方式，后续可能会删除，尽量不要使用。 Param: data => qr/.*/, 1, 编辑 K8S/数据/yaml转json API: any http://127.0.0.1/api/ci/kubernetes/data/yaml2json' 注: 必须通过这个来进行转换，直接在前端转换可能会有差异 Param: data => qr/.*/, 1, 编辑 K8S/数据/yaml转json/perl的现实方式 API: any http://127.0.0.1/api/ci/kubernetes/data/yaml2json/perl' 注: 旧的方式，后续可能会删除，尽量不要使用。 Param: data => qr/.*/, 1, 编辑 K8S/服务树绑定/获取绑定关系 API: get http://127.0.0.1/api/ci/k8stree/:treeid' Param: treeid => qr/^\\d+$/, 1, 编辑 K8S/服务树绑定/进行绑定 API: post http://127.0.0.1/api/ci/k8stree/:treeid/:k8sid' Param: treeid => qr/^\\d+$/, 1, k8sid => qr/^\\d+$/, 1, 编辑 K8S/服务树绑定/删除绑定 API: del http://127.0.0.1/api/ci/k8stree/:treeid/:k8sid' Param: treeid => qr/^\\d+$/, 1, k8sid => qr/^\\d+$/, 1, 编辑 K8S/标签/获取标签 API: get http://127.0.0.1/api/ci/kubernetes/util/labels/:name' kubectl get node --show-labels 用于亲和性的标签选择 name = node, pod, node_pod Param: ticketid => qr/^\\d+$/, 1, namespace => qr/^[\\w@\\.\\-]*$/, 0, name => qr/^[a-z][a-z_]+$/, 1, 编辑 K8S/流水线/获取K8S集群关联的流水线 API: get http://127.0.0.1/api/ci/project/kubernetes/:ticketid' 在K8S管理页面中，显示应用在哪些流水线中被使用了。 编辑 K8S/节点管理/获取节点列表 API: get http://127.0.0.1/api/ci/kubernetes/node' Param: ticketid => qr/^\\d+$/, 1, 编辑 K8S/节点管理/调度设置 API: post http://127.0.0.1/api/ci/kubernetes/node/cordon' 对应K8S中的cordon操作 cordon: 不可调度 uncordon: 可调度 因为可以进行批量操作，在批量操作时候node传入数组格式。 Param: #node => qr/^[a-zA-Z0-9][a-zA-Z0-9_\\.\\-@]+$/, 1, 批量操作时请传入数组 cordon => [ 'in', 'cordon', 'uncordon' ], 1, ticketid => qr/^\\d+$/, 1, 编辑 K8S/节点管理/驱逐 API: post http://127.0.0.1/api/ci/kubernetes/node/drain' 对应K8S中的drain操作 因为可以进行批量操作，在批量操作时候node传入数组格式。 Param: #node => qr/^[a-zA-Z0-9][a-zA-Z0-9_\\.\\-]+$/, 1, 批量操作时候传入数组 ticketid => qr/^\\d+$/, 1, 编辑 K8S/节点管理/污点信息获取 API: get http://127.0.0.1/api/ci/kubernetes/node/taint' Param: ticketid => qr/^\\d+$/, 1, nodename => qr/^[a-zA-Z0-9\\-\\._\\-]+$/, 1, 编辑 K8S/节点管理/污点设置 API: post http://127.0.0.1/api/ci/kubernetes/node/taint' Param: ticketid => qr/^\\d+$/, 1, nodename => qr/^[a-zA-Z0-9\\-\\._\\-]+$/, 1, key => qr/^[a-zA-Z0-9\\-\\._\\/]+$/, 1, value => qr/^[a-zA-Z0-9\\-\\._]+$/, 1, effect => qr/^[a-zA-Z0-9\\-\\._]+$/, 1, 编辑 K8S/节点管理/污点删除 API: del http://127.0.0.1/api/ci/kubernetes/node/taint' Param: ticketid => qr/^\\d+$/, 1, nodename => qr/^[a-zA-Z0-9\\-\\._\\-]+$/, 1, key => qr/^[a-zA-Z0-9\\-\\._\\/]+$/, 1, effect => qr/^[a-zA-Z0-9\\-\\._]+$/, 1, 编辑 K8S/获取configmap列表 API: get http://127.0.0.1/api/ci/kubernetes/configmap' Param: ticketid => qr/^\\d+$/, 1, namespace => qr/^[\\w@\\.\\-]*$/, 0, 编辑 K8S/获取daemonset列表 API: get http://127.0.0.1/api/ci/kubernetes/daemonset' Param: namespace => qr/^[\\w@\\.\\-]*$/, 0, status => qr/^[a-z]*$/, 0, ticketid => qr/^\\d+$/, 1, 编辑 K8S/获取deployment列表 API: get http://127.0.0.1/api/ci/kubernetes/deployment' Param: namespace => qr/^[\\w@\\.\\-]*$/, 0, status => qr/^[a-z]*$/, 0, ticketid => qr/^\\d+$/, 1, 编辑 K8S/获取endpoint列表 API: get http://127.0.0.1/api/ci/kubernetes/endpoint' Param: namespace => qr/^[\\w@\\.\\-]*$/, 0, status => qr/^[a-z]*$/, 0, ticketid => qr/^\\d+$/, 1, 编辑 K8S/获取statefulset列表 API: get http://127.0.0.1/api/ci/kubernetes/statefulset' Param: namespace => qr/^[\\w@\\.\\-]*$/, 0, status => qr/^[a-z]*$/, 0, ticketid => qr/^\\d+$/, 1, 编辑 K8S/获取应用列表 API: get http://127.0.0.1/api/ci/kubernetes/app' Param: namespace => qr/^[\\w@\\.\\-]*$/, 0, status => qr/^[a-z]*$/, 0, ticketid => qr/^\\d+$/, 1, 编辑 K8S/获取应用YAML内容 API: get http://127.0.0.1/api/ci/kubernetes/app/yaml' Param: type => qr/^[\\w@\\.\\-]*$/, 1, name => qr/^[\\w@\\.\\-]*$/, 1, namespace => qr/^[\\w@\\.\\-]*$/, 1, ticketid => qr/^\\d+$/, 1, 编辑 K8S/获取应用YAML内容/总是 API: get http://127.0.0.1/api/ci/kubernetes/app/yaml/always' 与上一个接口不一样的地方是，如果应用不存在，会返回空的内容。 在创建和编辑应用的时候，前端需要显示diff内容。 该接口在获取不存在的应用时，查询K8S发现该应用不存在时，接口会返回空。 Param: type => qr/^[\\w@\\.\\-]*$/, 1, name => qr/^[\\w@\\.\\-]*$/, 1, namespace => qr/^[\\w@\\.\\-]*$/, 1, ticketid => qr/^\\d+$/, 1, 编辑 K8S/获取应用json内容 API: get http://127.0.0.1/api/ci/kubernetes/app/json' Param: type => qr/^[\\w@\\.\\-]*$/, 1, name => qr/^[\\w@\\.\\-]*$/, 1, namespace => qr/^[\\w@\\.\\-]*$/, 1, ticketid => qr/^\\d+$/, 1, 编辑 K8S/获取应用中的数据给流水线 API: get http://127.0.0.1/api/ci/kubernetes/app/flowlineinfo' 返回应用的镜像地址，仓库等信息，在配置流水线的时候用于提取 Param: type => qr/^[\\w@\\.\\-]*$/, 1, name => qr/^[\\w@\\.\\-]*$/, 1, namespace => qr/^[\\w@\\.\\-]*$/, 1, ticketid => qr/^\\d+$/, 1, 编辑 K8S/提交变更配置到K8S中 API: post http://127.0.0.1/api/ci/kubernetes/app/apply' 对应K8S中的apply命令 Param: yaml => qr/.*/, 1, ticketid => qr/^\\d+$/, 1, 编辑 K8S/提交新配置到K8S中 API: post http://127.0.0.1/api/ci/kubernetes/app/create' 对应K8S中的create命令 Param: yaml => qr/.*/, 1, ticketid => qr/^\\d+$/, 1, 编辑 K8S/对应用进行回滚 API: post http://127.0.0.1/api/ci/kubernetes/app/rollback' Param: type => qr/^[\\w@\\.\\-]*$/, 1, name => qr/^[\\w@\\.\\-]*$/, 1, namespace => qr/^[\\w@\\.\\-]*$/, 1, version => qr/^\\d+$/, 1, ticketid => qr/^\\d+$/, 1, 编辑 K8S/获取应用可回滚的版本列表 API: get http://127.0.0.1/api/ci/kubernetes/app/rollback' Param: type => qr/^[\\w@\\.\\-]*$/, 1, name => qr/^[\\w@\\.\\-]*$/, 1, namespace => qr/^[\\w@\\.\\-]*$/, 1, ticketid => qr/^\\d+$/, 1, 编辑 K8S/删除应用 API: post http://127.0.0.1/api/ci/kubernetes/app/delete' 对应K8S中的delete命令 Param: type => qr/^[\\w@\\.\\-]*$/, 1, name => qr/^[\\w@\\.\\-]*$/, 1, namespace => qr/^[\\w@\\.\\-]*$/, 1, ticketid => qr/^\\d+$/, 1, 编辑 K8S/获取应用的describe信息 API: get http://127.0.0.1/api/ci/kubernetes/app/describe' 对应K8S中的describe命令 Param: type => qr/^[\\w@\\.\\-]*$/, 1, name => qr/^[\\w@\\.\\-]*$/, 1, namespace => qr/^[\\w@\\.\\-]*$/, 1, ticketid => qr/^\\d+$/, 1, 编辑 K8S/获取应用的describe信息/针对deployment API: get http://127.0.0.1/api/ci/kubernetes/app/describe/deployment' 对deployment的describe进行特殊处理，返回更多的信息 Param: type => qr/^[\\w@\\.\\-]*$/, 1, name => qr/^[\\w@\\.\\-]*$/, 1, namespace => qr/^[\\w@\\.\\-]*$/, 1, ticketid => qr/^\\d+$/, 1, 编辑 K8S/获取应用的describe信息/针对ingress API: get http://127.0.0.1/api/ci/kubernetes/app/describe/ingress' 对ingress的describe进行特殊处理，返回更多的信息 Param: type => qr/^[\\w@\\.\\-]*$/, 1, name => qr/^[\\w@\\.\\-]*$/, 1, namespace => qr/^[\\w@\\.\\-]*$/, 1, ticketid => qr/^\\d+$/, 1, 编辑 K8S/获取应用的describe信息/针对service API: get http://127.0.0.1/api/ci/kubernetes/app/describe/service' 对service的describe进行特殊处理，返回更多的信息 Param: type => qr/^[\\w@\\.\\-]*$/, 1, name => qr/^[\\w@\\.\\-]*$/, 1, namespace => qr/^[\\w@\\.\\-]*$/, 1, ticketid => qr/^\\d+$/, 1, 编辑 K8S/虚拟终端/进入POD API: any http://127.0.0.1/api/ci/kubernetes/pod/shell' 编辑 K8S/虚拟终端/进入kubectl命令行 API: any http://127.0.0.1/api/ci/kubernetes/kubectl/shell' 编辑 K8S/集群/集群的链接测试/通过配置进行测试 API: post http://127.0.0.1/api/ci/kubernetes/cluster/connectiontest' 测试一下集群是不是可用的, 测试的网络权限等 Param: kubectlVersion => qr/^v\\d+\\.\\d+\\.\\d+$/, 1, proxyAddr => qr/^[a-zA-Z0-9:\\.@]*$/, 0, kubeconfig => qr/.+/, 1, 编辑 K8S/集群/集群的链接测试/指定测试已经存在的集群 API: post http://127.0.0.1/api/ci/kubernetes/cluster/connectiontest/:ticketid' 测试一下集群是不是可用的, 测试的网络权限等 Param: ticketid => qr/^\\d+$/, 1, 编辑 SLAVE/获取任务日志HTML页面 API: get http://127.0.0.1/api/job/tasklog/:uuid' 编辑 SLAVE/通过任务UUID停止任务 API: del http://127.0.0.1/api/job/killtask/:uuid' 编辑 SLAVE/获取自身监控状态 API: any http://127.0.0.1/api/job/mon' 编辑 SLAVE/reload服务 API: any http://127.0.0.1/api/job/reload' 编辑 业务管理/变量查看/信息查询 API: get http://127.0.0.1/api/job/vv/:projectid' Param: projectid => qr/^\\d+$/, 1, node => [ 'mismatch', qr/'/ ], 0, name => [ 'mismatch', qr/'/ ], 0, time_start => qr/^\\d{4}\\-\\d{2}\\-\\d{2}$/, 0, time_end => qr/^\\d{4}\\-\\d{2}\\-\\d{2}$/, 0, 编辑 业务管理/变量查看/获取表格数据 API: get http://127.0.0.1/api/job/vv/:projectid/table' Param: projectid => qr/^\\d+$/, 1, node => [ 'mismatch', qr/'/ ], 0, name => [ 'mismatch', qr/'/ ], 0, time_start => qr/^\\d{4}\\-\\d{2}\\-\\d{2}$/, 0, time_end => qr/^\\d{4}\\-\\d{2}\\-\\d{2}$/, 0, 编辑 业务管理/变量查看/获取列表数据 API: get http://127.0.0.1/api/job/vv/:projectid/list' Param: projectid => qr/^\\d+$/, 1, appname => [ 'mismatch', qr/'/ ], 0, 编辑 业务管理/变量查看/按照node进行删除 API: del http://127.0.0.1/api/job/vv/:projectid/:node' Param: projectid => qr/^\\d+$/, 1, node => [ 'mismatch', qr/'/ ], 1, 编辑 业务管理/变量查看/获取版本比例分布 API: get http://127.0.0.1/api/job/vv/:projectid/analysis/version' Param: projectid => qr/^\\d+$/, 1, 编辑 业务管理/报警通知/获取列表 API: get http://127.0.0.1/api/job/notify/:projectid' 编辑 业务管理/报警通知/添加用户 API: post http://127.0.0.1/api/job/notify/:projectid' Param: projectid => qr/^\\d+$/, 1, user => qr/^[a-zA-Z0-9\\.\\@_\\-]+$/, 1, 编辑 业务管理/报警通知/删除用户 API: del http://127.0.0.1/api/job/notify/:projectid/:id' Param: projectid => qr/^\\d+$/, 1, id => qr/^\\d+$/, 1, 编辑 业务管理/账号管理/列表查询 API: get http://127.0.0.1/api/job/userlist/:projectid' Param: projectid => qr/^\\d+$/, 1, name => [ 'mismatch', qr/'/ ], 0, create_user => [ 'mismatch', qr/'/ ], 0, edit_user => [ 'mismatch', qr/'/ ], 0, create_time_start => qr/^\\d{4}\\-\\d{2}\\-\\d{2}$/, 0, create_time_end => qr/^\\d{4}\\-\\d{2}\\-\\d{2}$/, 0, 编辑 业务管理/账号管理/添加账号 API: post http://127.0.0.1/api/job/userlist/:projectid' Param: projectid => qr/^\\d+$/, 1, username => qr/^[a-zA-Z0-9\\-_]+$/, 1, 编辑 业务管理/账号管理/删除账号 API: del http://127.0.0.1/api/job/userlist/:projectid/:id' Param: projectid => qr/^\\d+$/, 1, id => qr/^\\d+$/, 1, 编辑 云监控/获取支持的exporter列表 API: get http://127.0.0.1/api/agent/cloudmon/exporter' 编辑 云监控/获取当前已经配置的云监控列表 API: get http://127.0.0.1/api/agent/cloudmon' 编辑 云监控/获取单个云监控配置 API: get http://127.0.0.1/api/agent/cloudmon/:id' Param: id => qr/^\\d+$/, 1, 编辑 云监控/创建或编辑云监控配置 API: post http://127.0.0.1/api/agent/cloudmon' Param: id => qr/^\\d+$/, 0, name => [ 'mismatch', qr/'/ ], 1, type => [ 'mismatch', qr/'/ ], 1, #TODO describe => [ 'mismatch', qr/'/ ], 1, 编辑 云监控/删除云监控配置 API: del http://127.0.0.1/api/agent/cloudmon/:id' Param: id => qr/^\\d+$/, 1, 编辑 云资源/控制/Redis/降级规格 API: get http://127.0.0.1/api/ci/c3mc/cloud/control/redis_manage/downgrade/:type/:subtype/:uuid' Param: type => qr/^[a-zA-Z0-9][a-zA-Z0-9\\-]+$/, 1, subtype => qr/^[a-zA-Z0-9][a-zA-Z0-9\\-]+$/, 1, uuid => qr/^[a-zA-Z\\d\\-_\\.:]+$/, 1, 编辑 云资源/控制/Redis/升级规格 API: get http://127.0.0.1/api/ci/c3mc/cloud/control/redis_manage/upgrade/:type/:subtype/:uuid' Param: type => qr/^[a-zA-Z0-9][a-zA-Z0-9\\-]+$/, 1, subtype => qr/^[a-zA-Z0-9][a-zA-Z0-9\\-]+$/, 1, uuid => qr/^[a-zA-Z\\d\\-_\\.:]+$/, 1, 编辑 云资源/控制/Tags/获取资源tag API: get http://127.0.0.1/api/ci/c3mc/cloud/control/tags/get/:type/:subtype/:uuid' Param: type => qr/^[a-zA-Z0-9][a-zA-Z0-9\\-]+$/, 1, subtype => qr/^[a-zA-Z0-9][a-zA-Z0-9\\-]+$/, 1, uuid => qr/^[a-zA-Z\\d\\-_\\.:]+$/, 1, 编辑 云资源/控制/Tags/添加或者编辑资源tag API: post http://127.0.0.1/api/ci/c3mc/cloud/control/tags/add/:type/:subtype/:uuid' Param: type => qr/^[a-zA-Z0-9][a-zA-Z0-9\\-]+$/, 1, subtype => qr/^[a-zA-Z0-9][a-zA-Z0-9\\-]+$/, 1, uuid => qr/^[a-zA-Z\\d\\-_\\.:]+$/, 1, tagkey => qr/^[a-zA-Z0-9][a-zA-Z0-9\\-_]+$/, 1, tagvalue => qr/^[a-zA-Z0-9][a-zA-Z0-9\\-_@\\.]+$/, 1, 编辑 云资源/控制/Tags/删除资源tag API: post http://127.0.0.1/api/ci/c3mc/cloud/control/tags/del/:type/:subtype/:uuid' Param: type => qr/^[a-zA-Z0-9][a-zA-Z0-9\\-]+$/, 1, subtype => qr/^[a-zA-Z0-9][a-zA-Z0-9\\-]+$/, 1, uuid => qr/^[a-zA-Z\\d\\-_\\.:]+$/, 1, tagkey => qr/^[a-zA-Z0-9][a-zA-Z0-9\\-_]+$/, 1, tagvalue => qr/^[a-zA-Z0-9][a-zA-Z0-9\\-_@\\.]+$/, 1, 编辑 云资源/控制/lb信息/获取资源lb后端信息 API: get http://127.0.0.1/api/ci/c3mc/cloud/control/lbinfo/get/:type/:subtype/:uuid' Param: type => qr/^[a-zA-Z0-9][a-zA-Z0-9\\-]+$/, 1, subtype => qr/^[a-zA-Z0-9][a-zA-Z0-9\\-]+$/, 1, uuid => qr/^[a-zA-Z0-9][a-zA-Z0-9\\-_\\.]+$/, 1, table => qr/^\\d+$/, 0, 编辑 作业/任务/获取任务信息 API: get http://127.0.0.1/api/job/subtask/:projectid/:taskuuid' Param: projectid => qr/^\\d+$/, 1, taskuuid => qr/^[a-zA-Z0-9]+$/, 1, 编辑 作业/任务/获取任务单个步骤信息 API: get http://127.0.0.1/api/job/subtask/:projectid/:taskuuid/:subtaskuuid' Param: projectid => qr/^\\d+$/, 1, taskuuid => qr/^[a-zA-Z0-9]+$/, 1, subtaskuuid => qr/^[a-zA-Z0-9]+$/, 1, 编辑 作业/任务/操作子任务 API: post http://127.0.0.1/api/job/subtask/:projectid' Param: projectid => qr/^\\d+$/, 1, taskuuid => qr/^[a-zA-Z0-9]+$/, 1, subtaskuuid => qr/^[a-zA-Z0-9]+$/, 1, subtasktype => qr/^[a-zA-Z0-9]+$/, 1, control => [ 'in', 'next', 'fail', 'running', 'ignore' ], 1, 编辑 作业/任务/操作子任务 API: put http://127.0.0.1/api/job/subtask/:projectid' 同上，区别是只能操作next Param: projectid => qr/^\\d+$/, 1, taskuuid => qr/^[a-zA-Z0-9]+$/, 1, subtaskuuid => qr/^[a-zA-Z0-9]+$/, 1, subtasktype => qr/^[a-zA-Z0-9]+$/, 1, control => [ 'in', 'next', 'running' ], 1, 编辑 作业/变量/获取变量token API: get http://127.0.0.1/api/job/variable/:projectid/:jobuuid/token' 在需要自动更新变量内容时，需要创建一个token Param: projectid => qr/^\\d+$/, 1, jobuuid => qr/^[a-zA-Z0-9]+$/, 1, name => qr/^[a-zA-Z0-9,_]+$/, 0, 编辑 作业/变量/更新变量的下拉框列表 API: any http://127.0.0.1/api/job/variable/update/:projectid/:jobuuid/:token/:name/:option' Param: projectid => qr/^\\d+$/, 1, jobuuid => qr/^[a-zA-Z0-9]+$/, 1, token => qr/^[a-zA-Z0-9]+$/, 1, name => qr/^[a-zA-Z0-9,_]+$/, 1, option => qr/^[a-zA-Z0-9,_\\.\\-@]+$/, 1, updatevalue => qr/^\\d+$/, 0, 编辑 作业/变量/获取作业变量 API: get http://127.0.0.1/api/job/variable/:projectid/:jobuuid' Param: projectid => qr/^\\d+$/, 1, jobuuid => qr/^[a-zA-Z0-9]+$/, 1, empty => qr/^\\d+$/, 0, exclude => qr/^[a-zA-Z0-9,_]+$/, 0, env => [ 'in', 'test', 'online' ], 0, 编辑 作业/变量/提交作业变量 API: post http://127.0.0.1/api/job/variable/:projectid' Param: projectid => qr/^\\d+$/, 1, jobuuid => qr/^[a-zA-Z0-9]+$/, 1, name => qr/^[a-zA-Z0-9_]+$/, 1, value => qr/^[a-zA-Z0-9_\\.\\/\\-,@]*$/, 0, describe => [ 'mismatch', qr/'/ ], 1, option => qr/^[a-zA-Z0-9_\\.\\/\\-,@]*$/, 0, 编辑 作业/变量/更新作业变量 API: post http://127.0.0.1/api/job/variable/:projectid/update' data [ +{ name => '', value => '', describe => '', option => '' } ] Param: projectid => qr/^\\d+$/, 1, jobuuid => qr/^[a-zA-Z0-9]+$/, 1, 编辑 作业/变量/删除变量 API: del http://127.0.0.1/api/job/variable/:projectid' Param: projectid => qr/^\\d+$/, 1, jobuuid => qr/^[a-zA-Z0-9]+$/, 1, name => qr/^[a-zA-Z0-9_]+$/, 1, 编辑 作业/变量/通过变量id删除变量 API: del http://127.0.0.1/api/job/variable/byid/:jobid' Param: jobid => qr/^\\d+$/, 1, name => qr/^[a-zA-Z0-9_]+$/, 1, 编辑 作业/获取作业列表 API: get http://127.0.0.1/api/job/jobs/:projectid' Param: projectid => qr/^\\d+$/, 1, name => [ 'mismatch', qr/'/ ], 0, create_user => [ 'mismatch', qr/'/ ], 0, edit_user => [ 'mismatch', qr/'/ ], 0, create_time_start => qr/^\\d{4}\\-\\d{2}\\-\\d{2}$/, 0, create_time_end => qr/^\\d{4}\\-\\d{2}\\-\\d{2}$/, 0, edit_time_start => qr/^\\d{4}\\-\\d{2}\\-\\d{2}$/, 0, edit_time_end => qr/^\\d{4}\\-\\d{2}\\-\\d{2}$/, 0, 编辑 作业/获取作业数量 API: get http://127.0.0.1/api/job/jobs/:projectid/count' 编辑 作业/获取单个作业详情 API: get http://127.0.0.1/api/job/jobs/:projectid/:jobuuid' Param: projectid => qr/^\\d+$/, 1, jobuuid => qr/^[a-zA-Z0-9]+$/, 1, name => [ 'mismatch', qr/'/ ], 0, 编辑 作业/通过作业名称拷贝作业 API: post http://127.0.0.1/api/job/jobs/:projectid/copy/byname' Param: projectid => qr/^\\d+$/, 1, fromprojectid => qr/^\\d+$/, 0, toprojectid => qr/^\\d+$/, 0, fromname => [ 'mismatch', qr/'/ ], 1, toname => [ 'mismatch', qr/'/ ], 1, 编辑 作业/创建作业 API: post http://127.0.0.1/api/job/jobs/:projectid' Param: projectid => qr/^\\d+$/, 1, name => [ 'mismatch', qr/'/ ], 1, mon_ids => qr/^[a-zA-Z0-9_\\,\\.\\/]*$/, 0, mon_status => [ 'mismatch', qr/'/ ], 0, 编辑 作业/编辑作业 API: post http://127.0.0.1/api/job/jobs/:projectid/:jobuuid' Param: projectid => qr/^\\d+$/, 1, jobuuid => qr/^[a-zA-Z0-9]+$/, 1, mon_ids => qr/^[a-zA-Z0-9_\\,\\.\\/]*$/, 0, mon_status => [ 'mismatch', qr/'/ ], 0, name => [ 'mismatch', qr/'/ ], 1, 编辑 作业/删除作业 API: del http://127.0.0.1/api/job/jobs/:projectid/:jobuuid' Param: projectid => qr/^\\d+$/, 1, jobuuid => qr/^[a-zA-Z0-9]+$/, 1, 编辑 作业/通过作业名称删除作业 API: del http://127.0.0.1/api/job/jobs/:projectid/:name/byname' Param: projectid => qr/^\\d+$/, 1, name => [ 'mismatch', qr/'/ ], 1, 编辑 作业任务/获取任务列表 API: get http://127.0.0.1/api/job/task/:projectid' Param: projectid => qr/^\\d+$/, 1, name => [ 'mismatch', qr/'/ ], 0, user => [ 'mismatch', qr/'/ ], 0, status => qr/^[a-zA-Z0-9]+$/, 0, taskuuid => qr/^[a-zA-Z0-9]+$/, 0, time_start => qr/^\\d{4}\\-\\d{2}\\-\\d{2}$/, 0, time_end => qr/^\\d{4}\\-\\d{2}\\-\\d{2}$/, 0, myflow => [ 'mismatch', qr/'/ ], 0, #我发起的任务 mytask => [ 'mismatch', qr/'/ ], 0, #我的待办任务 mylink => [ 'mismatch', qr/'/ ], 0, #我处理过的任务 keyword => [ 'mismatch', qr/'/ ], 0, #根据bpm中的关键字进行查找，只对bpm流程生效 bpmuuid => qr/^[a-zA-Z0-9]+$/, 0, #查询bpm的uuid进行查找 编辑 作业任务/获取任务数量 API: get http://127.0.0.1/api/job/task/:projectid/count' 编辑 作业任务/获取任务统计信息 API: get http://127.0.0.1/api/job/task/:projectid/total_count' 按时间段统计 Param: projectid => qr/^\\d+$/, 1, time_start => qr/^\\d{4}\\-\\d{2}\\-\\d{2}$/, 0, time_end => qr/^\\d{4}\\-\\d{2}\\-\\d{2}$/, 0, 编辑 作业任务/获取任务详情 API: get http://127.0.0.1/api/job/task/:projectid/:uuid' Param: projectid => qr/^\\d+$/, 1, uuid => qr/^[a-zA-Z0-9]+$/, 1, 编辑 作业任务/任务重做 API: post http://127.0.0.1/api/job/task/:projectid/redo' Param: projectid => qr/^\\d+$/, 1, taskuuid => qr/^[a-zA-Z0-9]+$/, 1, 编辑 作业任务/任务权限查询 API: get http://127.0.0.1/api/job/task/:projectid/authorization/:group/:jobname' Param: projectid => qr/^\\d+$/, 1, jobname => [ 'mismatch', qr/'/ ], 1, group => [ 'mismatch', qr/'/ ], 1, 编辑 作业任务/提交任务 API: post http://127.0.0.1/api/job/task/:projectid/job' variable = { foo => 123 } Param: projectid => qr/^\\d+$/, 1, jobuuid => qr/^[a-zA-Z0-9]+$/, 1, 编辑 作业任务/监控调用作业 API: get http://127.0.0.1/api/job/task/:projectid/job/bymon' Param: projectid => qr/^\\d+$/, 1, jobname => [ 'mismatch', qr/'/ ], 1, endpoint => [ 'mismatch', qr/'/ ], 1, tpl_id => [ 'mismatch', qr/'/ ], 1, exp_id => [ 'mismatch', qr/'/ ], 1, 编辑 作业任务/通过作业名称调用作业 API: post http://127.0.0.1/api/job/task/:projectid/job/byname' /task/:projectid/job/byname?jobname=jobname1 variable = { foo => 123 } Param: projectid => qr/^\\d+$/, 1, jobname => [ 'mismatch', qr/'/ ], 1, uuid => qr/^[a-zA-Z0-9]{12}$/, 0, slave => qr/^[a-zA-Z0-9\\-\\.]+$/, 0, pointuser => [ 'mismatch', qr/'/ ], 0, 编辑 作业任务/启动一个命令任务 API: post http://127.0.0.1/api/job/task/:projectid/plugin_cmd' Param: projectid => qr/^\\d+$/, 1, name => [ 'mismatch', qr/'/ ], 1, user => qr/^[a-zA-Z0-9_]+$/, 1, node_type => [ 'in', 'builtin', 'group' ], 1, scripts_type => [ 'in', 'cite', 'shell', 'perl', 'python', 'php', 'buildin', 'auto' ], 1, timeout => qr/^\\d+$/, 0, 编辑 作业任务/启动一个文件同步任务 API: post http://127.0.0.1/api/job/task/:projectid/plugin_scp' Param: projectid => qr/^\\d+$/, 1, name => [ 'mismatch', qr/'/ ], 1, user => qr/^[a-zA-Z0-9_]+$/, 1, src_type => [qw( in builtin group fileserver ci )], 1, dst_type => [qw( in builtin group fileserver )], 1, chown => qr/^[a-zA-Z0-9\\-]+$/, 0, chmod => qr/^\\d+$/, 0, timeout => qr/^\\d+$/, 0, 编辑 作业任务/启动一个审批任务 API: post http://127.0.0.1/api/job/task/:projectid/plugin_approval' Param: projectid => qr/^\\d+$/, 1, name => [ 'mismatch', qr/'/ ], 1, cont => [ 'mismatch', qr/'/ ], 1, approver => qr/^[a-zA-Z0-9,\\@_\\-\\.%]+$/, 1, deployenv => [ 'in', 'test', 'online', 'always' ], 1, action => [ 'in', 'deploy', 'rollback', 'always' ], 1, batches => [ 'in', 'firsttime', 'thelasttime', 'notfirsttime', 'notthelasttime', 'always' ], 1, everyone => [ 'in', 'on', 'off' ], 1, timeout => qr/^\\d+$/, 0, 编辑 作业任务/任务统计/最近几条 API: get http://127.0.0.1/api/job/task/:projectid/analysis/last' Param: projectid => qr/^\\d+$/, 1, count => qr/^\\d+$/, 0, 编辑 作业任务/任务统计/按日期 API: get http://127.0.0.1/api/job/task/:projectid/analysis/date' Param: projectid => qr/^\\d+$/, 1, 编辑 作业任务/任务统计/按小时 API: get http://127.0.0.1/api/job/task/:projectid/analysis/hour' Param: projectid => qr/^\\d+$/, 1, 编辑 作业任务/任务统计/运行时间 API: get http://127.0.0.1/api/job/task/:projectid/analysis/runtime' Param: projectid => qr/^\\d+$/, 1, 编辑 作业任务/任务统计/概要 API: get http://127.0.0.1/api/job/task/:projectid/analysis/statistics' 编辑 其它工具/页面跳转 API: get http://127.0.0.1/api/agent/thirdparty/gotopage/:app/:page' C3会把其它第三方工具进行统一管理。 工具的调整地址是配置系统参数中的，有的变量需要进行转换。 需要调用该接口获取到准确的第三方工具地址。 Param: app => qr/^[a-zA-Z0-9\\.]+$/, 1, page => qr/^[a-zA-Z0-9\\.]+$/, 1, 编辑 内置接口/邮件/获取邮件列表 API: get http://127.0.0.1/api/connector/default/mail' 编辑 内置接口/邮件/发送邮件 API: post http://127.0.0.1/api/connector/default/mail' 注：属于内置接口，只有后端模块可能会调用。 Param: user => qr/^[a-zA-Z0-9\\.\\@_\\-]+$/, 1, title => qr/.+/, 1, content => qr/.+/, 1, 编辑 凭据/获取凭据列表 API: get http://127.0.0.1/api/ci/ticket' Param: type => [ 'in', 'SSHKey', 'UsernamePassword', 'JobBuildin', 'KubeConfig', 'Harbor' ], 0, projectid => qr/^\\d+$/, 0, ticketid => qr/^\\d+$/, 0, 编辑 凭据/获取凭据列表 API: get http://127.0.0.1/api/ci/ticket/KubeConfig' 只返回K8S的部分 Param: treeid => qr/^\\d+$/, 0, 编辑 凭据/获取单个凭据详情 API: get http://127.0.0.1/api/ci/ticket/:ticketid' Param: ticketid => qr/^\\d+$/, 1, 编辑 凭据/创建 API: post http://127.0.0.1/api/ci/ticket' Param: name => [ 'mismatch', qr/'/ ], 1, type => [ 'in', 'SSHKey', 'UsernamePassword', 'JobBuildin', 'KubeConfig', 'Harbor' ], 1, subtype => [ 'mismatch', qr/'/ ], 0, describe => [ 'mismatch', qr/'/ ], 1, pod_shell_relaxed => qr/^\\d+$/, 0, edit_share => [ 'mismatch', qr/'/ ], 0, 编辑 凭据/编辑 API: post http://127.0.0.1/api/ci/ticket/:ticketid' Param: ticketid => qr/^\\d+$/, 1, name => [ 'mismatch', qr/'/ ], 1, type => [ 'in', 'SSHKey', 'UsernamePassword', 'JobBuildin', 'KubeConfig', 'Harbor' ], 1, subtype => [ 'mismatch', qr/'/ ], 0, describe => [ 'mismatch', qr/'/ ], 1, pod_shell_relaxed => qr/^\\d+$/, 0, edit_share => [ 'mismatch', qr/'/ ], 0, 编辑 凭据/删除 API: del http://127.0.0.1/api/ci/ticket/:ticketid' Param: ticketid => qr/^\\d+$/, 1, 编辑 分组作业/获取任务列表 API: get http://127.0.0.1/api/jobx/task/:projectid' Param: projectid => qr/^\\d[\\d,]*$/, 1, allowslavenull => qr/^\\d$/, 0, name => [ 'mismatch', qr/'/ ], 0, user => [ 'mismatch', qr/'/ ], 0, status => qr/^[a-zA-Z0-9]+$/, 0, taskuuid => qr/^[a-zA-Z0-9]+$/, 0, time_start => qr/^\\d{4}\\-\\d{2}\\-\\d{2}$/, 0, time_end => qr/^\\d{4}\\-\\d{2}\\-\\d{2}$/, 0, 编辑 分组作业/获取任务数量 API: get http://127.0.0.1/api/jobx/task/:projectid/count' 编辑 分组作业/任务统计/按照时间段统计 API: get http://127.0.0.1/api/jobx/task/:projectid/total_count' Param: projectid => qr/^\\d+$/, 1, time_start => qr/^\\d{4}\\-\\d{2}\\-\\d{2}$/, 0, time_end => qr/^\\d{4}\\-\\d{2}\\-\\d{2}$/, 0, 编辑 分组作业/任务统计/获取任务详情 API: get http://127.0.0.1/api/jobx/task/:projectid/:uuid' Param: projectid => qr/^\\d+$/, 1, uuid => qr/^[a-zA-Z0-9]+$/, 1, 编辑 分组作业/通过作业名称启动任务 API: post http://127.0.0.1/api/jobx/task/:projectid/job/byname' /task/:projectid/job/byname?jobname=jobname1 group = groupname1 variable = { foo: 123 } Param: projectid => qr/^\\d+$/, 1, jobname => [ 'mismatch', qr/'/ ], 1, group => [ 'mismatch', qr/'/ ], 1, 编辑 分组作业/任务统计/最后几条记录 API: get http://127.0.0.1/api/jobx/task/:projectid/analysis/last' Param: projectid => qr/^\\d+$/, 1, count => qr/^\\d+$/, 0, 编辑 分组作业/任务统计/按照日期统计 API: get http://127.0.0.1/api/jobx/task/:projectid/analysis/date' Param: projectid => qr/^\\d+$/, 1, 编辑 分组作业/任务统计/按照小时统计 API: get http://127.0.0.1/api/jobx/task/:projectid/analysis/hour' Param: projectid => qr/^\\d+$/, 1, 编辑 分组作业/任务统计/按照运行时长统计 API: get http://127.0.0.1/api/jobx/task/:projectid/analysis/runtime' Param: projectid => qr/^\\d+$/, 1, 编辑 分组作业/获取CD发布的版本状态 API: get http://127.0.0.1/api/jobx/task/flowline/status/:flowlineid/:version' 一个CI可能会对应多个CD，本接口返回第一个发布的状态 Param: flowlineid => qr/^\\d[\\d,]*$/, 1, version => qr/^[a-zA-Z0-9][a-zA-Z0-9\\-\\._]+$/, 1, 编辑 分组作业任务/获取任务详情 API: get http://127.0.0.1/api/jobx/subtask/:projectid/:taskuuid' Param: projectid => qr/^\\d+$/, 1, taskuuid => qr/^[a-zA-Z0-9]+$/, 1, 编辑 分组作业任务/获取任务状态 API: get http://127.0.0.1/api/jobx/subtask/:projectid/:subtaskuuid/mystatus' Param: projectid => qr/^\\d+$/, 1, subtaskuuid => qr/^[a-zA-Z0-9]+$/, 1, 编辑 分组作业任务/操作任务 API: put http://127.0.0.1/api/jobx/subtask/:projectid/:subtaskuuid/confirm' 对卡住的任务进行确认 Param: projectid => qr/^\\d+$/, 1, subtaskuuid => qr/^[a-zA-Z0-9]+$/, 1, 编辑 协助操作/获取我的协助操作列表 API: get http://127.0.0.1/api/ci/assignment/byme' 编辑 协助操作/获取需要我协助操作的列表 API: get http://127.0.0.1/api/ci/assignment/tome' 编辑 协助操作/获取一个操作的详情 API: get http://127.0.0.1/api/ci/assignment/:id' Param: id => qr/^\\d+$/, 1, 编辑 协助操作/提交一个协助操作 API: post http://127.0.0.1/api/ci/assignment' Param: type => [ 'in', 'kubernetes' ], 1, name => [ 'mismatch', qr/'/ ], 1, handler => [ 'mismatch', qr/'/ ], 1, url => [ 'mismatch', qr/'/ ], 1, method => [ 'in', 'POST' ], 1, submit_reason => [ 'mismatch', qr/'/ ], 1, remarks => [ 'mismatch', qr/'/ ], 1, 编辑 协助操作/操作一个需要我协助的操作 API: post http://127.0.0.1/api/ci/assignment/:id' Param: id => qr/^\\d+$/, 1, status => [ 'in', 'fail', 'success', 'refuse', 'cancel', 'close' ], 1, handle_reason => [ 'mismatch', qr/'/ ], 0, 编辑 堡垒机/提供数据给堡垒机 API: get http://127.0.0.1/api/ci/c3mc/jumpserver' 查询全量数据的时需要root权限 查询单个数据只需要read权限 其中ip查询的时会把内外网ip都查询一遍。 有过滤条件的情况下返回数据的data字段是HASH cache: 为1时返回缓存数据，更快。 ips、uuids: 一次查询多个，用逗号分隔，返回数组 Param: uuid => qr/^[a-zA-Z0-9][a-zA-Z0-9\\-_]+$/, 0, ip => qr/^\\d+\\.\\d+\\.\\d+\\.\\d+$/, 0, uuids => qr/^[a-zA-Z0-9][a-zA-Z0-9\\-_,]+$/, 0, ips => qr/^[\\.\\d,]+$/, 0, cache => qr/^\\d+$/, 0, 编辑 多语言/多语言数据 API: get http://127.0.0.1/api/connector/common/i18n' 编辑 定时任务/获取定时任务列表 API: get http://127.0.0.1/api/job/crontab/:projectid' Param: projectid => qr/^\\d+$/, 1, name => [ 'mismatch', qr/'/ ], 0, create_user => [ 'mismatch', qr/'/ ], 0, edit_user => [ 'mismatch', qr/'/ ], 0, create_time_start => qr/^\\d{4}\\-\\d{2}\\-\\d{2}$/, 0, create_time_end => qr/^\\d{4}\\-\\d{2}\\-\\d{2}$/, 0, edit_time_start => qr/^\\d{4}\\-\\d{2}\\-\\d{2}$/, 0, create_time_end => qr/^\\d{4}\\-\\d{2}\\-\\d{2}$/, 0, 编辑 定时任务/获取定时任务数量 API: get http://127.0.0.1/api/job/crontab/:projectid/count' 通过服务树id获取定时任务数量 返回数据 +{ available => 0, # 开启的数量 unavailable => 0, # 暂停的数量 } 编辑 定时任务/获取定时任务详情 API: get http://127.0.0.1/api/job/crontab/:projectid/:crontabid' Param: projectid => qr/^\\d+$/, 1, crontabid => qr/^\\d+$/, 1, 编辑 定时任务/创建定时任务 API: post http://127.0.0.1/api/job/crontab/:projectid' Param: projectid => qr/^\\d+$/, 1, name => [ 'mismatch', qr/'/ ], 1, jobuuid => qr/^[a-zA-Z0-9]+$/, 1, cron => qr/^[\\*0-9\\-,\\/]+\\s+[\\*0-9\\-,\\/]+\\s+[\\*0-9\\-,\\/]+\\s+[\\*0-9\\-,\\/]+\\s+[\\*0-9\\-,\\/]+$/, 1, mutex => qr/^[a-zA-Z0-9]*$/, 1, 编辑 定时任务/编辑定时任务 API: post http://127.0.0.1/api/job/crontab/:projectid/:crontabid' Param: projectid => qr/^\\d+$/, 1, crontabid => qr/^\\d+$/, 1, name => [ 'mismatch', qr/'/ ], 1, jobuuid => qr/^[a-zA-Z0-9]+$/, 1, cron => qr/^[\\*0-9\\-,\\/]+\\s+[\\*0-9\\-,\\/]+\\s+[\\*0-9\\-,\\/]+\\s+[\\*0-9\\-,\\/]+\\s+[\\*0-9\\-,\\/]+$/, 1, mutex => qr/^[a-zA-Z0-9]*$/, 1, 编辑 定时任务/修改定时任务状态 API: post http://127.0.0.1/api/job/crontab/:projectid/:crontabid/status' Param: projectid => qr/^\\d+$/, 1, crontabid => qr/^\\d+$/, 1, status => [ 'in', 'available', 'unavailable' ], 1, 编辑 定时任务/删除定时任务 API: del http://127.0.0.1/api/job/crontab/:projectid/:crontabid' Param: projectid => qr/^\\d+$/, 1, crontabid => qr/^\\d+$/, 1, 编辑 审批/获取审批列表 API: get http://127.0.0.1/api/job/approval' 只返回最近100条 编辑 审批/提交审批意见 API: post http://127.0.0.1/api/job/approval' Param: opinion => [ 'in', 'agree', 'refuse' ], 1, uuid => qr/^[a-zA-Z0-9]{12}$/, 1, 编辑 审批/获取单个审批详情 API: get http://127.0.0.1/api/job/approval/:uuid' 登陆后可以查询 Param: uuid => qr/^[a-zA-Z0-9]{12}$/, 1, 编辑 审批/获取单个审批详情 API: get http://127.0.0.1/api/job/approval/control/:uuid' 不用登录也可以查询 Param: uuid => qr/^[a-zA-Z0-9]{12}$/, 1, 编辑 审批/获取审批状态 API: get http://127.0.0.1/api/job/approval/control/status/:uuid' Param: uuid => qr/^[a-zA-Z0-9]{12}$/, 1, 编辑 审批/提交审批意见 API: post http://127.0.0.1/api/job/approval/control' Param: opinion => [ 'in', 'agree', 'refuse' ], 1, uuid => qr/^[a-zA-Z0-9]{12}$/, 1, 编辑 审批/快速审批 API: any http://127.0.0.1/api/job/approval/fast/:uuid' Param: uuid => qr/^[a-zA-Z0-9]{12}$/, 1, opinion => [ 'in', 'agree', 'refuse' ], 0, 编辑 导航栏/收藏夹 API: any http://127.0.0.1/api/connector/menufavorites' Param: stat => qr/^\\d+$/, 1, menu => [ 'mismatch', qr/'/ ], 1, 编辑 导航栏/获取导航栏列表,全局菜单 API: get http://127.0.0.1/api/connector/navigation/menu' 编辑 导航栏/获取导航栏列表 API: get http://127.0.0.1/api/connector/navigation/config' 编辑 导航栏/获取导航栏详情 API: get http://127.0.0.1/api/connector/navigation/config/:navigationid' Param: navigationid => qr/^\\d+$/, 1, 编辑 导航栏/创建导航栏 API: post http://127.0.0.1/api/connector/navigation/config' Param: name => [ 'mismatch', qr/'/ ], 1, describe => [ 'mismatch', qr/'/ ], 1, show => qr/^\\d+$/, 1, 编辑 导航栏/编辑导航栏 API: post http://127.0.0.1/api/connector/navigation/config/:navigationid' Param: navigationid => qr/^\\d+$/, 1, name => [ 'mismatch', qr/'/ ], 1, describe => [ 'mismatch', qr/'/ ], 1, show => qr/^\\d+$/, 1, 编辑 导航栏/删除导航栏 API: del http://127.0.0.1/api/connector/navigation/config/:navigationid' Param: navigationid => qr/^\\d+$/, 1, 编辑 手机审批/获取列表 API: get http://127.0.0.1/api/job/approve/approval' 只返回最近100条 编辑 手机审批/提交审批意见 API: post http://127.0.0.1/api/job/approve/approval' Param: opinion => [ 'in', 'agree', 'refuse' ], 1, uuid => qr/^[a-zA-Z0-9]{12}$/, 1, 编辑 手机审批/获取审批详情 API: get http://127.0.0.1/api/job/approve/approval/:uuid' Param: uuid => qr/^[a-zA-Z0-9]{12}$/, 1, 编辑 扩展监控/接收华为监控数据 API: any http://127.0.0.1/api/ci/exalarm/huawei' 编辑 扩展监控/接收扩展的告警数据 API: any http://127.0.0.1/api/ci/exmesg/:type' 编辑 报告/监控报告/获取报告详情 API: get http://127.0.0.1/api/ci/monreport/:groupid/report' Param: groupid => qr/^\\d+$/, 1, data => qr/^[a-zA-Z0-9_\\.\\-]*$/, 0, 编辑 报告/监控报告/获取数据列表 API: get http://127.0.0.1/api/ci/monreport/:groupid/datalist' Param: groupid => qr/^\\d+$/, 1, 编辑 报告/获取git代码报告 API: get http://127.0.0.1/api/ci/gitreport/:groupid/report' Param: groupid => qr/^\\d+$/, 1, user => qr/^[\\w@\\.\\-]*$/, 0, project => qr/^[\\w@\\.\\-]*$/, 0, data => qr/^[a-zA-Z0-9_\\.\\-]+$/, 1, 编辑 报告/获取git代码报告数据源列表 API: get http://127.0.0.1/api/ci/gitreport/:groupid/datalist' Param: groupid => qr/^\\d+$/, 1, 编辑 报告/获取流水线报告 API: get http://127.0.0.1/api/ci/flowreport/:groupid/report' Param: groupid => qr/^\\d+$/, 1, user => qr/^[\\w@\\.]*$/, 0, data => qr/^[a-zA-Z0-9_\\.\\-]+$/, 1, 编辑 报告/获取流水线报告数据源列表 API: get http://127.0.0.1/api/ci/flowreport/:groupid/datalist' Param: groupid => qr/^\\d+$/, 1, 编辑 收藏夹/添加收藏 API: post http://127.0.0.1/api/ci/favorites/:groupid' Param: ciid => qr/^\\d+$/, 1, name => [ 'mismatch', qr/'/ ], 1, 编辑 收藏夹/删除收藏 API: del http://127.0.0.1/api/ci/favorites/:groupid' Param: ciid => qr/^\\d+$/, 1, 编辑 故障愈合/获取配置列表 API: get http://127.0.0.1/api/agent/selfhealing/config' 编辑 故障愈合/获取详情 API: get http://127.0.0.1/api/agent/selfhealing/config/:id' Param: id => qr/^\\d+$/, 1, 编辑 故障愈合/添加或编辑自愈套餐 API: post http://127.0.0.1/api/agent/selfhealing/config' Param: id => qr/^\\d+$/, 0, name => [ 'mismatch', qr/'/ ], 1, altername => [ 'mismatch', qr/'/ ], 1, jobname => [ 'mismatch', qr/'/ ], 1, eips => [ 'mismatch', qr/'/ ], 0, 编辑 故障愈合/删除自愈套餐 API: del http://127.0.0.1/api/agent/selfhealing/config/:id' Param: id => qr/^\\d+$/, 1, 编辑 故障自愈/获取自愈套餐 API: get http://127.0.0.1/api/agent/selfhealing/task' 编辑 文件分发/获取目录下文件列表 API: get http://127.0.0.1/api/job/sendfile/list/:projectid' Param: projectid => qr/^\\d+$/, 1, path => qr/^[a-zA-Z0-9:_\\/ @\\.\\-]+$/, 1, sudo => qr/^[a-zA-Z0-9:_\\/@\\.\\-]+$/, 1, 编辑 文件分发/删除文件 API: post http://127.0.0.1/api/job/sendfile/unlink/:projectid' Param: projectid => qr/^\\d+$/, 1, path => qr/^[a-zA-Z0-9:_\\/ @\\.\\-\\(\\)]+$/, 1, sudo => qr/^[a-zA-Z0-9:_\\/@\\.\\-]+$/, 1, 编辑 文件管理/Token管理/列表查询 API: any http://127.0.0.1/api/job/token/:projectid/info' Param: projectid => qr/^\\d+$/, 1, create_user => [ 'mismatch', qr/'/ ], 0, edit_user => [ 'mismatch', qr/'/ ], 0, create_time_start => qr/^\\d{4}\\-\\d{2}\\-\\d{2}$/, 0, create_time_end => qr/^\\d{4}\\-\\d{2}\\-\\d{2}$/, 0, 编辑 文件管理/Token管理/创建Token API: post http://127.0.0.1/api/job/token/:projectid' Param: projectid => qr/^\\d+$/, 1, token => qr/^[a-zA-Z0-9\\-_\\.]+$/, 1, describe => [ 'mismatch', qr/'/ ], 1, isjob => [ 'mismatch', qr/'/ ], 1, jobname => [ 'mismatch', qr/'/ ], 1, 编辑 文件管理/Token管理/删除Token API: del http://127.0.0.1/api/job/token/:projectid/:id' Param: projectid => qr/^\\d+$/, 1, id => qr/^\\d+$/, 1, 编辑 文件管理/获取列表 API: get http://127.0.0.1/api/job/fileserver/:projectid' 编辑 文件管理/上传文件 API: post http://127.0.0.1/api/job/fileserver/:projectid' 编辑 文件管理/下载文件 API: get http://127.0.0.1/api/job/fileserver/:projectid/download' Param: projectid => qr/^\\d+$/, 1, name => [ 'mismatch', qr/'/ ], 1, 编辑 文件管理/通过命令行上传文件 API: post http://127.0.0.1/api/job/fileserver/:projectid/upload' 编辑 文件管理/删除文件 API: del http://127.0.0.1/api/job/fileserver/:projectid/:fileserverid' Param: projectid => qr/^\\d+$/, 1, fileserverid => qr/^\\d+$/, 1, 编辑 服务树/节点资源/获取资源列表 API: get http://127.0.0.1/api/agent/nodeinfo/:projectid' 编辑 服务树/节点资源/检查节点合法性 API: get http://127.0.0.1/api/agent/nodeinfo/:projectid/check' 检查节点是否是该服务树下资源的一个子集 node=node1,node2,node3 Param: projectid => qr/^\\d+$/, 1, node => qr/^[a-zA-Z0-9_\\-\\.,]+$/, 1, 编辑 服务树/节点资源/获取数量 API: get http://127.0.0.1/api/agent/nodeinfo/:projectid/count' 编辑 服务树/获取子树列表 API: get http://127.0.0.1/api/ci/c3mc/tree/subtreemap/:treeid' Param: treeid => qr/^\\d+$/, 1, 编辑 服务树/获取服务树继承关系 API: get http://127.0.0.1/api/agent/inherit/:projectid' 编辑 服务树机器/获取列表 API: get http://127.0.0.1/api/job/nodeinfo/:projectid' 编辑 服务树机器/权限检查 API: get http://127.0.0.1/api/job/nodeinfo/:projectid/check' node=node1,node2,node3 Param: projectid => qr/^\\d+$/, 1, node => qr/^[a-zA-Z0-9_\\-\\.,]+$/, 1, 编辑 服务树机器/总数获取 API: get http://127.0.0.1/api/job/nodeinfo/:projectid/count' 编辑 服务树节点状态/获取状态 API: get http://127.0.0.1/api/job/project/:projectid' 编辑 服务树节点状态/修改状态 API: post http://127.0.0.1/api/job/project/:projectid' Param: projectid => qr/^\\d+$/, 1, status => [ 'in', 'active', 'inactive' ], 1, 编辑 机器分批/获取分批列表 API: get http://127.0.0.1/api/job/nodegroup/:projectid' Param: projectid => qr/^\\d+$/, 1, name => [ 'mismatch', qr/'/ ], 0, plugin => qr/[a-zA-Z0-9]+/, 0, create_user => [ 'mismatch', qr/'/ ], 0, edit_user => [ 'mismatch', qr/'/ ], 0, create_time_start => qr/^\\d{4}\\-\\d{2}\\-\\d{2}$/, 0, create_time_end => qr/^\\d{4}\\-\\d{2}\\-\\d{2}$/, 0, edit_time_start => qr/^\\d{4}\\-\\d{2}\\-\\d{2}$/, 0, edit_time_end => qr/^\\d{4}\\-\\d{2}\\-\\d{2}$/, 0, 编辑 机器分批/获取单个分批的配置 API: get http://127.0.0.1/api/job/nodegroup/:projectid/:id' Param: projectid => qr/^\\d+$/, 1, id => qr/^\\d+$/, 1, 编辑 机器分批/获取的机器列表 API: get http://127.0.0.1/api/job/nodegroup/:projectid/:id/nodelist' Param: projectid => qr/^\\d+$/, 1, id => qr/^\\d+$/, 1, 编辑 机器分批/创建分批 API: post http://127.0.0.1/api/job/nodegroup/:projectid' Param: projectid => qr/^\\d+$/, 1, name => [ 'mismatch', qr/'/ ], 1, plugin => qr/[a-zA-Z0-9]+/, 1, 编辑 机器分批/编辑分批 API: post http://127.0.0.1/api/job/nodegroup/:projectid/:id' Param: projectid => qr/^\\d+$/, 1, id => qr/^\\d+$/, 1, name => [ 'mismatch', qr/'/ ], 1, plugin => qr/[a-zA-Z0-9]+/, 1, 编辑 机器分批/删除分批 API: del http://127.0.0.1/api/job/nodegroup/:projectid/:id' Param: projectid => qr/^\\d+$/, 1, id => qr/^\\d+$/, 1, 编辑 机器分批/获取列表 API: get http://127.0.0.1/api/jobx/group/:projectid' 编辑 机器分批/复制机器分批 API: post http://127.0.0.1/api/jobx/group/:projectid/copy/byname' Param: projectid => qr/^\\d+$/, 1, fromprojectid => qr/^\\d+$/, 0, toprojectid => qr/^\\d+$/, 0, fromname => [ 'mismatch', qr/'/ ], 1, toname => [ 'mismatch', qr/'/ ], 1, 编辑 机器分批/机器分批详情 API: get http://127.0.0.1/api/jobx/group/:projectid/:id' Param: projectid => qr/^\\d+$/, 1, id => qr/^\\d+$/, 1, 编辑 机器分批/获取机器分组内容 API: get http://127.0.0.1/api/jobx/group/:projectid/:id/node' Param: projectid => qr/^\\d+$/, 1, id => qr/^\\d+$/, 1, 编辑 机器分批/获取机器分组内容/通过分组名查询 API: get http://127.0.0.1/api/jobx/group/:projectid/:name/node/byname' Param: projectid => qr/^\\d+$/, 1, name => [ 'mismatch', qr/'/ ], 1, 编辑 机器分批/创建 API: post http://127.0.0.1/api/jobx/group/:projectid' Param: projectid => qr/^\\d+$/, 1, name => [ 'mismatch', qr/'/ ], 1, note => [ 'mismatch', qr/'/ ], 0, group_type => qr/[a-zA-Z0-9]+/, 1, node => qr/[a-zA-Z0-9_\\-\\.:;]+/, 0, percent => qr/[a-zA-Z0-9%:]+/, 0, 编辑 机器分批/编辑 API: post http://127.0.0.1/api/jobx/group/:projectid/:id' Param: projectid => qr/^\\d+$/, 1, id => qr/^\\d+$/, 1, name => [ 'mismatch', qr/'/ ], 1, note => [ 'mismatch', qr/'/ ], 0, group_type => qr/[a-zA-Z0-9]+/, 1, node => qr/[a-zA-Z0-9_\\-\\.:;]+/, 0, percent => qr/[a-zA-Z0-9%:]+/, 0, 编辑 机器分批/删除 API: del http://127.0.0.1/api/jobx/group/:projectid/:id' Param: projectid => qr/^\\d+$/, 1, id => qr/^\\d+$/, 1, 编辑 机器分批/删除/通过名称删除 API: del http://127.0.0.1/api/jobx/group/:projectid/:name/byname' Param: projectid => qr/^\\d+$/, 1, name => [ 'mismatch', qr/'/ ], 1, 编辑 机器管理/获取列表 API: get http://127.0.0.1/api/job/nodelist/:projectid' Param: projectid => qr/^\\d+$/, 1, name => [ 'mismatch', qr/'/ ], 0, create_user => [ 'mismatch', qr/'/ ], 0, edit_user => [ 'mismatch', qr/'/ ], 0, create_time_start => qr/^\\d{4}\\-\\d{2}\\-\\d{2}$/, 0, create_time_end => qr/^\\d{4}\\-\\d{2}\\-\\d{2}$/, 0, 编辑 机器管理/添加机器 API: post http://127.0.0.1/api/job/nodelist/:projectid' 只有管理员可以操作 Param: projectid => qr/^\\d+$/, 1, name => qr/^\\d+\\.\\d+\\.\\d+\\.\\d+|[a-zA-Z0-9\\.\\-_]+::\\d+\\.\\d+\\.\\d+\\.\\d+|[a-zA-Z0-9\\.\\-_]+::\\d+\\.\\d+\\.\\d+\\.\\d+::\\d+\\.\\d+\\.\\d+\\.\\d+$/, 1, 编辑 机器管理/删除机器 API: del http://127.0.0.1/api/job/nodelist/:projectid/:id' Param: projectid => qr/^\\d+$/, 1, id => qr/^\\d+$/, 1, 编辑 权限/获取用户角色列表 API: any http://127.0.0.1/api/connector/default/auth/userauth' 编辑 权限/删除权限 API: del http://127.0.0.1/api/connector/default/auth/delauth' Param: user => qr/^[a-zA-Z0-9\\@_\\.\\-]+$/, 1, 编辑 权限/添加权限 API: post http://127.0.0.1/api/connector/default/auth/addauth' Param: user => qr/^[a-zA-Z0-9\\@_\\.\\-]+$/, 1, level => qr/^\\d+$/, 1, 编辑 权限/通过权限点检查用户权限 API: get http://127.0.0.1/api/connector/default/auth/point' 该接口是系统内置的权限系统权限验证的接口。 如果C3启动使用的内置的权限系统，使用的就是该接口。 其它位置不要主动的调用它，/connectorx/point 接口会找到它进行调用。 属于后端模块使用的接口。 Param: point => qr/^[a-z0-9_]+$/, 1, treeid => qr/^\\d+$/, 0, 编辑 流水线/CI/获取CI任务日志页 API: get http://127.0.0.1/api/ci/cilog/:uuid' HTML页面 编辑 流水线/CI/停止CI任务 API: put http://127.0.0.1/api/ci/killbuild/:uuid' 编辑 流水线/webhook API: any http://127.0.0.1/api/ci/webhooks' git的回调地址 编辑 流水线/代码依赖/获取依赖列表 API: get http://127.0.0.1/api/ci/rely/:projectid' 编辑 流水线/代码依赖/添加依赖配置 API: post http://127.0.0.1/api/ci/rely/:projectid' Param: projectid => qr/^\\d+$/, 1, path => qr/^[a-zA-Z0-9]([a-zA-Z0-9_\\-\\/]|\\.(?!\\.))*$/, 0, addr => [ 'mismatch', qr/'/ ], 1, ticketid => qr/^[a-zA-Z0-9_]+$/, 0, tags => qr/^[a-zA-Z0-9_\\-\\.]+$/, 0, 编辑 流水线/代码依赖/删除依赖 API: del http://127.0.0.1/api/ci/rely/:projectid/:relyid' Param: projectid => qr/^\\d+$/, 1, relyid => qr/^\\d+$/, 1, 编辑 流水线/回滚确认/是否回滚任务 API: put http://127.0.0.1/api/jobx/task/:projectid/:uuid/:control' Param: projectid => qr/^\\d+$/, 1, uuid => qr/^[a-zA-Z0-9]+$/, 1, control => [ 'in', 'rollback', 'norollback' ], 1, 编辑 流水线/流水线线上环境最后发布成功的版本 API: get http://127.0.0.1/api/jobx/flowline_version/:flowlineid' 编辑 流水线/获取单个流水线CI配置详情 API: get http://127.0.0.1/api/ci/project/:groupid/:projectid' 编辑 流水线/编辑CI配置 API: post http://127.0.0.1/api/ci/project/:groupid/:projectid' Param: projectid => qr/^\\d+$/, 1, status => qr/^\\d+$/, 1, audit_level => qr/^\\d+$/, 1, autobuild => qr/^\\d+$/, 1, name => [ 'mismatch', qr/'/ ], 0, excuteflow => [ 'mismatch', qr/'/ ], 0, calljobx => [ 'mismatch', qr/'/ ], 0, calljob => [ 'mismatch', qr/'/ ], 0, webhook => qr/^\\d+$/, 1, webhook_password => [ 'mismatch', qr/'/ ], 0, webhook_release => [ 'mismatch', qr/'/ ], 0, rely => qr/^\\d+$/, 1, buildimage => [ 'mismatch', qr/'/ ], 0, buildcachepath => qr/^[a-zA-Z0-9_\\-\\.]*$/, 0, follow_up => [ 'mismatch', qr/'/ ], 0, follow_ucallback => [ 'mismatch', qr/'/ ], 0, groupid => qr/^\\d+$/, 1, addr => [ 'mismatch', qr/'/ ], 1, username => [ 'mismatch', qr/'/ ], 0, password => [ 'mismatch', qr/'/ ], 0, notify => [ 'mismatch', qr/'/ ], 0, notifyci => [ 'mismatch', qr/'/ ], 0, notifycd => [ 'mismatch', qr/'/ ], 0, cislave => [ 'mismatch', qr/'/ ], 0, tag_regex => [ 'mismatch', qr/'/ ], 0, autofindtags => qr/^\\d+$/, 1, callonlineenv => qr/^\\d+$/, 1, calltestenv => qr/^\\d+$/, 1, ticketid => qr/^\\d*$/, 0, follow_up_ticketid => qr/^\\d*$/, 0, cpulimit => qr/^\\d*\\.?\\d*$/, 1, memlimit => qr/^\\d*$/, 1, saveasdir => qr/^\\d*$/, 0, gitclonebycache => qr/^\\d*$/, 0, nomail => qr/^\\d*$/, 0, nomesg => qr/^\\d*$/, 0, ci_type => [ 'in', 'default', 'kubernetes' ], 1, ci_type_ticketid => [ 'mismatch', qr/'/ ], 0, ci_type_kind => [ 'mismatch', qr/'/ ], 0, ci_type_namespace => [ 'mismatch', qr/'/ ], 0, ci_type_name => [ 'mismatch', qr/'/ ], 0, ci_type_container => [ 'mismatch', qr/'/ ], 0, ci_type_repository => [ 'mismatch', qr/'/ ], 0, ci_type_dockerfile => [ 'mismatch', qr/'/ ], 0, ci_type_dockerfile_content => [ 'mismatch', qr/'/ ], 0, ci_type_open => [ 'mismatch', qr/'/ ], 0, ci_type_concurrent => [ 'mismatch', qr/'/ ], 0, ci_type_approver1 => [ 'mismatch', qr/'/ ], 0, ci_type_approver2 => [ 'mismatch', qr/'/ ], 0, 编辑 流水线/删除CI配置 API: del http://127.0.0.1/api/ci/project/:groupid/:projectid' Param: groupid => qr/^\\d+$/, 1, projectid => qr/^\\d+$/, 1, 编辑 流水线/流水线改名 API: post http://127.0.0.1/api/ci/project/:groupid/:projectid/rename' Param: groupid => qr/^\\d+$/, 1, projectid => qr/^\\d+$/, 1, name => [ 'mismatch', qr/'/ ], 1, 编辑 流水线/触发一次找tag操作 API: put http://127.0.0.1/api/ci/project/:groupid/:projectid/findtags_at_once' Param: projectid => qr/^\\d+$/, 1, 编辑 流水线/获取单个流水线的版本列表/简单列表 API: get http://127.0.0.1/api/ci/v/:groupid/:projectid' 编辑 流水线/获取单个流水线的版本列表/详细数据 API: get http://127.0.0.1/api/ci/version/:groupid/:projectid' 编辑 流水线/获取单个版本的详情 API: get http://127.0.0.1/api/ci/versiondetail/:projectid/:version' Param: projectid => qr/^\\d+$/, 1, version => [ 'mismatch', qr/'/ ], 1 编辑 流水线/一次获取多个流水线下的版本信息 API: get http://127.0.0.1/api/ci/versions' 编辑 流水线/终止流水线下所有待运行的构建 API: put http://127.0.0.1/api/ci/version/:groupid/:projectid/stop_project' Param: projectid => qr/^\\d+$/, 1, 编辑 流水线/触发某个版本的构建 API: put http://127.0.0.1/api/ci/version/:groupid/:projectid/:uuid/build' Param: projectid => qr/^\\d+$/, 1, 编辑 流水线/CI调用统计/调用类型 API: get http://127.0.0.1/api/ci/version/:groupid/:projectid/count/calltype' 按照调用类型进行统计 编辑 流水线/CI调用统计/任务状态 API: get http://127.0.0.1/api/ci/version/:groupid/:projectid/count/status' 按照任务状态进行统计 编辑 流水线/CI调用统计/运行时长 API: get http://127.0.0.1/api/ci/version/:groupid/:projectid/analysis/runtime' 按照运行时长进行统计 Param: projectid => qr/^\\d+$/, 1, 编辑 流水线/CI调用统计/按天统计 API: get http://127.0.0.1/api/ci/version/:groupid/:projectid/analysis/date' 按照每天执行次数进行统计 Param: projectid => qr/^\\d+$/, 1, 编辑 流水线/CI调用统计/最后几条 API: get http://127.0.0.1/api/ci/version/:groupid/:projectid/analysis/last' 默认显示最后10条 Param: projectid => qr/^\\d+$/, 1, count => qr/^\\d+$/, 0, 编辑 流水线/手动提交版本 API: post http://127.0.0.1/api/ci/version/:groupid/:projectid/record' Param: groupid => qr/^\\d+$/, 1, projectid => qr/^\\d+$/, 1, version => qr/[a-zA-Z][a-zA-Z0-9\\.\\-_@]*/, 1, describe => [ 'mismatch', qr/'/ ], 1, 编辑 流水线/获取某个服务树下流水线列表 API: get http://127.0.0.1/api/ci/group/:groupid' 编辑 流水线/获取某个服务树下收藏的流水线 API: get http://127.0.0.1/api/ci/group/favorites/:groupid' 编辑 流水线/获取用户所有可见的流水线 API: get http://127.0.0.1/api/ci/group/all/:groupid' 编辑 流水线/创建流水线 API: post http://127.0.0.1/api/ci/group/:groupid' Param: groupid => qr/^\\d+$/, 1, sourceid => qr/^\\d+$/, 0, status => qr/^\\d+$/, 0, name => [ 'mismatch', qr/'/ ], 1, ci_type => [ 'mismatch', qr/'/ ], 0, ci_type_ticketid => [ 'mismatch', qr/'/ ], 0, ci_type_kind => [ 'mismatch', qr/'/ ], 0, ci_type_namespace => [ 'mismatch', qr/'/ ], 0, ci_type_name => [ 'mismatch', qr/'/ ], 0, ci_type_container => [ 'mismatch', qr/'/ ], 0, ci_type_repository => [ 'mismatch', qr/'/ ], 0, ci_type_dockerfile => [ 'mismatch', qr/'/ ], 0, ci_type_dockerfile_content => [ 'mismatch', qr/'/ ], 0, 编辑 流水线/K8S集群和流水线关联 API: post http://127.0.0.1/api/ci/group/connectk8s/:groupid/:flowid' 在K8S应用列表中可以直接把应用关联到某个发布流水线中。 Param: groupid => qr/^\\d+$/, 1, flowid => qr/^\\d+$/, 0, ci_type => [ 'mismatch', qr/'/ ], 0, ci_type_ticketid => [ 'mismatch', qr/'/ ], 0, ci_type_kind => [ 'mismatch', qr/'/ ], 0, ci_type_namespace => [ 'mismatch', qr/'/ ], 0, ci_type_name => [ 'mismatch', qr/'/ ], 0, ci_type_container => [ 'mismatch', qr/'/ ], 0, ci_type_repository => [ 'mismatch', qr/'/ ], 0, ci_type_dockerfile => [ 'mismatch', qr/'/ ], 0, ci_type_dockerfile_content => [ 'mismatch', qr/'/ ], 0, 编辑 登录扩展/google登录 API: post http://127.0.0.1/api/connector/loginext/google' Param: credential => qr/^[a-zA-Z0-9\\@_\\.\\-_]+$/, 1, callback => qr/./, 0, 编辑 登录扩展/获取概览 API: get http://127.0.0.1/api/connector/loginext' 编辑 监控/服务分析/获取数据 API: any http://127.0.0.1/api/ci/c3mc/serviceanalysis/tree' Param: timemachine => qr/^[a-z0-9][a-z0-9\\-]+[a-z0-9]$/, 1, search => qr/^[a-zA-Z0-9\\.\\-_:]*$/, 0, search2 => qr/^[a-zA-Z0-9\\.\\-_:]*$/, 0, limit => qr/^\\d*$/, 0, 编辑 监控/获取所有异常的主机ip API: get http://127.0.0.1/api/ci/to3part/errnode' 编辑 监控系统/ACK/个人ACK/通过cookie方式获取 API: get http://127.0.0.1/api/agent/monitor/ack/myack/bycookie' 编辑 监控系统/ACK/个人ACK/状态提交 API: post http://127.0.0.1/api/agent/monitor/ack/myack/bycookie' Param: uuid => qr/^[a-zA-Z0-9]+$/, 1, type => [ 'in', 'P', 'G' ], 1, mt => [ 'in', 'Strategy', 'Case' ], 1, 编辑 监控系统/ACK/全部ACK/通过cookie方式获取 API: get http://127.0.0.1/api/agent/monitor/ack/allack/bycookie' 编辑 监控系统/ACK/全局ACK/状态提交 API: post http://127.0.0.1/api/agent/monitor/ack/allack/bycookie' Param: uuid => qr/^[a-zA-Z0-9]+$/, 1, type => [ 'in', 'P', 'G' ], 1, mt => [ 'in', 'Strategy', 'Case' ], 1, 编辑 监控系统/ACK/获取详情 API: get http://127.0.0.1/api/agent/monitor/ack/:uuid' Param: uuid => qr/^[a-zA-Z0-9]+$/, 1, 编辑 监控系统/ACK/编辑状态 API: post http://127.0.0.1/api/agent/monitor/ack/:uuid' Param: uuid => qr/^[a-zA-Z0-9]+$/, 1, ctrl => [ 'in', 'ack', 'ackcase', 'ackam', 'ackscA', 'ackscP', 'ackscC', 'ackdeal' ], 1, 编辑 监控系统/ACK/监控转工单 API: post http://127.0.0.1/api/agent/monitor/ack/tott/:uuid' Param: uuid => qr/^[a-zA-Z0-9]+$/, 1, 编辑 监控系统/ACK/获取告警的处理人信息 API: get http://127.0.0.1/api/agent/monitor/ack/deal/info' 编辑 监控系统/ACK/告警认领 API: post http://127.0.0.1/api/agent/monitor/ack/deal/info' Param: uuid => qr/^[a-zA-Z0-9:\\.T\\-,]+$/, 1, 编辑 监控系统/case/获取我的事件列表 API: get http://127.0.0.1/api/agent/monitor/caseinfo/mycase' 编辑 监控系统/case/获取全局事件列表 API: get http://127.0.0.1/api/agent/monitor/caseinfo/allcase' 编辑 监控系统/值班组/获取列表 API: get http://127.0.0.1/api/agent/monitor/config/oncall' 编辑 监控系统/值班组/获取值班组配置 API: get http://127.0.0.1/api/agent/monitor/config/oncall/:id' Param: id => qr/^\\d+$/, 1, 编辑 监控系统/值班组/获取日历 API: get http://127.0.0.1/api/agent/monitor/config/oncall/cal/:name' Param: name => qr/^[a-zA-Z][a-zA-Z0-9\\.\\-_]+$/, 1, user => qr/^[a-zA-Z][a-zA-Z0-9\\.\\-_\\@]+$/, 0, 编辑 监控系统/值班组/获取值班表 API: get http://127.0.0.1/api/agent/monitor/config/oncall/list/:name' Param: name => qr/^[a-zA-Z][a-zA-Z0-9\\.\\-_]+$/, 1, 编辑 监控系统/值班组/修改值班组配置 API: post http://127.0.0.1/api/agent/monitor/config/oncall' Param: id => qr/^\\d+$/, 0, name => qr/^[a-zA-Z][a-zA-Z0-9\\.\\-_]*$/, 1, description => [ 'mismatch', qr/'/ ], 0, 编辑 监控系统/值班组/删除值班组配置 API: del http://127.0.0.1/api/agent/monitor/config/oncall/:id' Param: id => qr/^\\d+$/, 1, 编辑 监控系统/告警接收人/获取列表 API: get http://127.0.0.1/api/agent/monitor/config/user/:projectid' 编辑 监控系统/告警接收人/获取详情 API: get http://127.0.0.1/api/agent/monitor/config/user/:projectid/:id' Param: projectid => qr/^\\d+$/, 1, id => qr/^\\d+$/, 1, 编辑 监控系统/告警接收人/创建或编辑接收人 API: post http://127.0.0.1/api/agent/monitor/config/user/:projectid' Param: projectid => qr/^\\d+$/, 1, id => qr/^\\d+$/, 0, user => [ 'mismatch', qr/'/ ], 1, subgroup => qr/^[a-zA-Z0-9]*$/, 0, 编辑 监控系统/告警接收人/删除接收人 API: del http://127.0.0.1/api/agent/monitor/config/user/:projectid/:id' Param: projectid => qr/^\\d+$/, 1, id => qr/^\\d+$/, 1, 编辑 监控系统/告警接收人/测试消息通道 API: post http://127.0.0.1/api/agent/monitor/config/usertest' 回给接收人发送消息，测试一下接收人是否可以正常收到告警消息。 消息包括邮件、短信、电话。 Param: user => [ 'mismatch', qr/'/ ], 1, projectid => qr/^\\d+$/, 1, 编辑 监控系统/告警组/获取列表 API: get http://127.0.0.1/api/agent/monitor/config/group' 编辑 监控系统/告警组/获取详情 API: get http://127.0.0.1/api/agent/monitor/config/group/:id' Param: id => qr/^\\d+$/, 1, 编辑 监控系统/告警组/创建或编辑告警组 API: post http://127.0.0.1/api/agent/monitor/config/group' Param: id => qr/^\\d+$/, 0, name => [ 'mismatch', qr/'/ ], 1, description => [ 'mismatch', qr/'/ ], 0, share => [ 'mismatch', qr/'/ ], 0, 编辑 监控系统/告警组/删除告警组 API: del http://127.0.0.1/api/agent/monitor/config/group/:id' Param: id => qr/^\\d+$/, 1, 编辑 监控系统/告警组/获取组内成员 API: get http://127.0.0.1/api/agent/monitor/config/groupuser/:groupid' Param: groupid => qr/^\\d+$/, 1, 编辑 监控系统/告警组/添加成员 API: post http://127.0.0.1/api/agent/monitor/config/groupuser' Param: groupid => qr/^\\d+$/, 0, user => [ 'mismatch', qr/'/ ], 1, 编辑 监控系统/告警组/删除成员 API: del http://127.0.0.1/api/agent/monitor/config/groupuser/:id' Param: id => qr/^\\d+$/, 1, 编辑 监控系统/接收告警消息 API: any http://127.0.0.1/api/agent/monitor/sender' 系统内部接口，altermanager会调用该接口发送消息。 编辑 监控系统/服务树解绑/获取列表 API: get http://127.0.0.1/api/agent/monitor/config/treeunbind' 管理页面中会使用到。 编辑 监控系统/服务树解绑/获取状态 API: get http://127.0.0.1/api/agent/monitor/config/treeunbind/:treeid' 管理页面中会使用到。 Param: treeid => qr/^\\d+$/, 1, 编辑 监控系统/服务树解绑/修改状态 API: post http://127.0.0.1/api/agent/monitor/config/treeunbind/:treeid' 管理页面中会使用到。 Param: treeid => qr/^\\d+$/, 1, status => qr/^\\d+$/, 0, 编辑 监控系统/监控策略/获取列表 API: get http://127.0.0.1/api/agent/monitor/config/rule/:projectid' 编辑 监控系统/监控策略/获取单个策略的配置 API: get http://127.0.0.1/api/agent/monitor/config/rule/:projectid/:id' Param: projectid => qr/^\\d+$/, 1, id => qr/^\\d+$/, 1, 编辑 监控系统/监控策略/创建或编辑策略 API: post http://127.0.0.1/api/agent/monitor/config/rule/:projectid' Param: projectid => qr/^\\d+$/, 1, id => qr/^\\d+$/, 0, alert => [ 'mismatch', qr/'/ ], 1, expr => [ 'mismatch', qr/'/ ], 0, for => qr/^[a-zA-Z0-9]*$/, 0, severity => qr/^[a-zA-Z0-9]+$/, 1, summary => [ 'mismatch', qr/'/ ], 0, description => [ 'mismatch', qr/'/ ], 0, value => [ 'mismatch', qr/'/ ], 0, model => [ 'in', 'simple', 'custom', 'bindtree', 'bindetree' ], 1, metrics => [ 'mismatch', qr/'/ ], 0, method => [ 'mismatch', qr/'/ ], 0, threshold => [ 'mismatch', qr/'/ ], 0, bindtreesql => [ 'mismatch', qr/'/ ], 0, job => [ 'mismatch', qr/'/ ], 0, subgroup => qr/^[a-zA-Z0-9]*$/, 0, nocall => qr/^\\d*$/, 0, nomesg => qr/^\\d*$/, 0, nomail => qr/^\\d*$/, 0, serialcall => qr/^\\d*$/, 0, vtreeid => qr/^[a-zA-Z0-9]*$/, 0, 编辑 监控系统/监控策略/删除策略 API: del http://127.0.0.1/api/agent/monitor/config/rule/:projectid/:id' Param: projectid => qr/^\\d+$/, 1, id => qr/^\\d+$/, 1, 编辑 监控系统/监控策略/清空服务树节点的策略 API: del http://127.0.0.1/api/agent/monitor/config/rule/:projectid' Param: projectid => qr/^\\d+$/, 1, 编辑 监控系统/监控策略/根据服务树复制策略 API: post http://127.0.0.1/api/agent/monitor/config/rule/copy/:fromid/:toid' Param: fromid => qr/^\\d+$/, 1, toid => qr/^\\d+$/, 1, 编辑 监控系统/监控策略/获取模版列表 API: get http://127.0.0.1/api/agent/monitor/config/ruletpl/:projectid' 编辑 监控系统/监控策略/同步模版 API: post http://127.0.0.1/api/agent/monitor/config/ruletpl/sync/:projectid/:tplname' Param: projectid => qr/^\\d+$/, 1, tplname => qr/^[a-zA-Z0-9][a-zA-Z0-9_\\-\\@\\.]+$/, 1, 编辑 监控系统/监控策略/保存模版 API: post http://127.0.0.1/api/agent/monitor/config/ruletpl/save/:projectid/:tplname' Param: projectid => qr/^\\d+$/, 1, tplname => qr/^[a-zA-Z0-9][a-zA-Z0-9_\\-\\@\\.]+$/, 1, 编辑 监控系统/获取告警列表 API: get http://127.0.0.1/api/agent/monitor/alert/:projectid' 编辑 监控系统/告警转工单 API: post http://127.0.0.1/api/agent/monitor/alert/tott/:projectid' 编辑 监控系统/获取告警和工单的绑定关系 API: get http://127.0.0.1/api/agent/monitor/alert/tottbind/:projectid' 编辑 监控系统/获取监控的工单url地址 API: get http://127.0.0.1/api/agent/monitor/alert/gotocase/:projectid' Param: uuid => qr/^[a-zA-Z0-9\\.\\-:]+$/, 1, caseuuid => qr/^[a-zA-Z0-9\\.\\-:]+$/, 1, 编辑 监控系统/获取告警知晓 API: get http://127.0.0.1/api/agent/monitor/alarm_well_noted' 编辑 监控系统/提交告警知晓 API: post http://127.0.0.1/api/agent/monitor/alarm_well_noted' Param: uuid => qr/^[a-zA-Z0-9:\\.T\\-,]+$/, 1, 编辑 监控系统/获取告警知晓告警值班人 API: get http://127.0.0.1/api/agent/monitor/alarm_well_noted_oncall' 编辑 监控系统/获取服务树下绑定的看板 API: get http://127.0.0.1/api/agent/monitor/config/kanban/:projectid' 编辑 监控系统/获取看板详情 API: get http://127.0.0.1/api/agent/monitor/config/kanban/:projectid/:id' Param: projectid => qr/^\\d+$/, 1, id => qr/^\\d+$/, 1, 编辑 监控系统/添加看板 API: post http://127.0.0.1/api/agent/monitor/config/kanban/:projectid' Param: projectid => qr/^\\d+$/, 1, name => [ 'mismatch', qr/'/ ], 1, url => [ 'mismatch', qr/'/ ], 1, 编辑 监控系统/设置缺省看板 API: post http://127.0.0.1/api/agent/monitor/config/kanban/setdefault/:projectid/:kanbanid' Param: projectid => qr/^\\d+$/, 1, kanbanid => qr/^\\d+$/, 1, stat => qr/^\\d+$/, 1, 编辑 监控系统/删除看板 API: del http://127.0.0.1/api/agent/monitor/config/kanban/:projectid/:id' Param: projectid => qr/^\\d+$/, 1, id => qr/^\\d+$/, 1, 编辑 监控系统/资源低负载/获取概要 API: get http://127.0.0.1/api/agent/nodelow/:projectid' Param: projectid => qr/^\\d+$/, 1, owner => [ 'mismatch', qr/'/ ], 0, 编辑 监控系统/资源低负载/获取单个资源详情 API: get http://127.0.0.1/api/agent/nodelow/detail/:projectid/:ip' Param: projectid => qr/^\\d+$/, 1, ip => qr/^[\\d\\.]+$/, 1, 编辑 监控系统/资源低负载/标记单个资源 API: any http://127.0.0.1/api/agent/nodelow/mark/:projectid/:ip' Param: projectid => qr/^\\d+$/, 1, ip => qr/^[\\d\\.]+$/, 1, 编辑 监控系统/资源低负载/获取标记MAP API: get http://127.0.0.1/api/agent/nodelow/mark/:projectid' 编辑 监控系统/通用资源低负载/获取类型 API: get http://127.0.0.1/api/agent/resourcelow/type' 编辑 监控系统/通用资源低负载/获取状态 API: get http://127.0.0.1/api/agent/resourcelow/status' 编辑 监控系统/通用资源低负载/获取表格信息 API: get http://127.0.0.1/api/agent/resourcelow/data/:type/:projectid' Param: type => qr/^[a-z][a-z\\d\\-]*[a-z\\d]$/, 1, projectid => qr/^\\d+$/, 1, owner => [ 'mismatch', qr/'/ ], 0, 编辑 监控系统/通用资源低负载/对资源进行标记 API: post http://127.0.0.1/api/agent/resourcelow/mark/:type/:projectid' Param: projectid => qr/^\\d+$/, 1, uuids => [ 'mismatch', qr/'/ ], 1, type => [ 'mismatch', qr/'/ ], 1, status => [ 'mismatch', qr/'/ ], 1, mark => [ 'mismatch', qr/'/ ], 0, 编辑 监控系统/通用资源低负载/获取标记MAP API: get http://127.0.0.1/api/agent/resourcelow/mark/:type/:projectid' Param: type => [ 'mismatch', qr/'/ ], 1, projectid => qr/^\\d+$/, 1, 编辑 监控系统/邮件监控/获取列表 API: get http://127.0.0.1/api/agent/monitor/config/mailmon' 编辑 监控系统/邮件监控/获取历史 API: get http://127.0.0.1/api/agent/monitor/config/mailmon/history' 编辑 监控系统/邮件监控/获取某个邮件监控的配置 API: get http://127.0.0.1/api/agent/monitor/config/mailmon/:id' Param: id => qr/^\\d+$/, 1, 编辑 监控系统/邮件监控/创建邮件监控 API: post http://127.0.0.1/api/agent/monitor/config/mailmon' Param: id => qr/^\\d+$/, 0, name => qr/^[a-zA-Z][a-zA-Z0-9\\.\\-_]*$/, 1, description => [ 'mismatch', qr/'/ ], 0, 编辑 监控系统/邮件监控/删除邮件监控 API: del http://127.0.0.1/api/agent/monitor/config/mailmon/:id' Param: id => qr/^\\d+$/, 1, 编辑 监控系统/采集配置/获取列表 API: get http://127.0.0.1/api/agent/monitor/config/collector/:projectid' 编辑 监控系统/采集配置/获取单个采集配置详情 API: get http://127.0.0.1/api/agent/monitor/config/collector/:projectid/:id' Param: projectid => qr/^\\d+$/, 1, id => qr/^\\d+$/, 1, 编辑 监控系统/采集配置/添加或编辑采集配置 API: post http://127.0.0.1/api/agent/monitor/config/collector/:projectid' Param: projectid => qr/^\\d+$/, 1, id => qr/^\\d+$/, 0, type => qr/^[a-zA-Z0-9]+$/, 1, subtype => qr/^[a-zA-Z0-9]+$/, 1, content1 => [ 'mismatch', qr/'/ ], 1, content2 => [ 'mismatch', qr/'/ ], 0, vtreeid => qr/^[a-zA-Z0-9]*$/, 0, 编辑 监控系统/采集配置/删除采集配置 API: del http://127.0.0.1/api/agent/monitor/config/collector/:projectid/:id' Param: projectid => qr/^\\d+$/, 1, id => qr/^\\d+$/, 1, 编辑 私有节点/获取私有节点列表 API: get http://127.0.0.1/api/connector/private' 编辑 私有节点/添加私有节点 API: post http://127.0.0.1/api/connector/private' Param: user => qr/^[a-zA-Z0-9\\.\\@_\\-]+$/, 1, 编辑 第三方接口/提交审批 API: post http://127.0.0.1/api/job/to3part/v1/approval' Param: user_id => [ 'mismatch', qr/'/ ], 0, special_approver => [ 'mismatch', qr/'/ ], 1, title => [ 'mismatch', qr/'/ ], 1, apply_note => [ 'mismatch', qr/'/ ], 1, 编辑 第三方接口/查询审批的状态 API: get http://127.0.0.1/api/job/to3part/v1/approval' Param: djbh => qr/^[a-zA-Z0-9\\.\\-_@]+$/, 1, 编辑 第三方接口/获取所有需要安全检测的资源信息 API: get http://127.0.0.1/api/ci/to3part/safetytesting' 编辑 第三方接口/获取用户部门信息 API: get http://127.0.0.1/api/connector/to3part/v1/user/department' Param: email => qr/^[a-zA-Z0-9\\.\\-_@]+$/, 1, 编辑 第三方接口/获取用户信息 API: get http://127.0.0.1/api/connector/to3part/v1/user/userinfo' 编辑 第三方调用/获取作业列表 API: post http://127.0.0.1/api/job/third/option/jobname' Param: project_id => qr/^\\d+$/, 1, 编辑 第三方调用/获取作业变量信息 API: post http://127.0.0.1/api/job/third/option/variable' Param: project_id => qr/^\\d+$/, 1, jobname => [ 'mismatch', qr/'/ ], 1, exclude => qr/^[a-zA-Z0-9,_]+$/, 0, 编辑 第三方调用/检查执行参数 API: post http://127.0.0.1/api/job/third/interface/dry-run' Param: project_id => qr/^\\d+$/, 1, uuid => qr/^[a-zA-Z0-9]{12}$/, 1, retry_count => qr/^\\d+$/,0 编辑 第三方调用/执行作业 API: post http://127.0.0.1/api/job/third/interface/invoke' Param: project_id => qr/^\\d+$/, 1, uuid => qr/^[a-zA-Z0-9]{12}$/, 1, retry_count => qr/^\\d+$/,0 编辑 第三方调用/查询作业状态 API: post http://127.0.0.1/api/job/third/interface/query' Param: uuid => qr/^[a-zA-Z0-9]+$/, 1, retry_count => qr/^\\d+$/,0 编辑 第三方调用/停止作业 API: post http://127.0.0.1/api/job/third/interface/stop' Param: uuid => qr/^[a-zA-Z0-9]+$/, 1, retry_count => qr/^\\d+$/,0 编辑 第三方调用/获取机器分批列表 API: post http://127.0.0.1/api/jobx/third/option/groupname' Param: project_id => qr/^\\d+$/, 1, 编辑 第三方调用/检查执行参数 API: post http://127.0.0.1/api/jobx/third/interface/dry-run' Param: project_id => qr/^\\d+$/, 1, uuid => qr/^[a-zA-Z0-9]{12}$/, 1, retry_count => qr/^\\d+$/,0 编辑 第三方调用/执行作业 API: post http://127.0.0.1/api/jobx/third/interface/invoke' Param: project_id => qr/^\\d+$/, 1, uuid => qr/^[a-zA-Z0-9]{12}$/, 1, retry_count => qr/^\\d+$/,0 编辑 第三方调用/查询分组作业状态 API: post http://127.0.0.1/api/jobx/third/interface/query' Param: uuid => qr/^[a-zA-Z0-9]+$/, 1, retry_count => qr/^\\d+$/,0 编辑 第三方调用/停止分组作业 API: post http://127.0.0.1/api/jobx/third/interface/stop' Param: uuid => qr/^[a-zA-Z0-9]+$/, 1, retry_count => qr/^\\d+$/,0 编辑 管理/CI任务监视器/获取数据 API: get http://127.0.0.1/api/ci/watcher' 编辑 管理/CI任务监视器/插队 API: post http://127.0.0.1/api/ci/watcher/jump/:uuid' 任务排到队伍最前面 Param: uuid => qr/^[a-zA-Z0-9]+$/, 1, 编辑 管理/地址簿/获取地址簿列表 API: get http://127.0.0.1/api/connector/useraddr' 编辑 管理/地址簿/获取某个用户的地址簿 API: get http://127.0.0.1/api/connector/useraddr/:id' Param: id => qr/^\\d+$/, 0, 编辑 管理/地址簿/提交新地址簿 API: post http://127.0.0.1/api/connector/useraddr' Param: id => qr/^\\d+$/, 0, user => qr/^[a-zA-Z0-9\\.\\@_\\-]+$/, 1, email => qr/^[a-zA-Z0-9\\.\\@_\\-]+$/, 1, phone => qr/^[a-zA-Z0-9:\\.\\@_\\-\\/,]+$/, 1, voicemail => qr/^[a-zA-Z0-9\\.\\@_\\-]+$/, 0, 编辑 管理/地址簿/删除地址簿 API: del http://127.0.0.1/api/connector/useraddr/:id' 编辑 管理/审批/列表获取 API: get http://127.0.0.1/api/job/adminapproval' 默认返回最后1000条数据 编辑 管理/审批/提交审批 API: post http://127.0.0.1/api/job/adminapproval' Param: opinion => [ 'in', 'agree', 'refuse' ], 1, id => qr/^\\d+$/, 1, 编辑 管理/审批/获取单个审批详情 API: get http://127.0.0.1/api/job/adminapproval/:id' Param: id => qr/^\\d+$/, 1, 编辑 管理/审批/获取OA提交日志 API: get http://127.0.0.1/api/job/adminapproval/oalog/:id' Param: id => qr/^\\d+$/, 1, 编辑 管理/审批/OA重新发起 API: post http://127.0.0.1/api/job/adminapproval/oaredo/:id' Param: id => qr/^\\d+$/, 1, 编辑 管理/审批/消息通知重新发起 API: post http://127.0.0.1/api/job/adminapproval/notifyredo/:id' Param: id => qr/^\\d+$/, 1, 编辑 管理/网络监视器 API: get http://127.0.0.1/api/agent/networkmonitor' 编辑 管理/部门/获取用户和部门的关系表 API: get http://127.0.0.1/api/connector/userdepartment' 编辑 管理/部门/绑定用户和部门的关系 API: post http://127.0.0.1/api/connector/userdepartment' Param: user => qr/^[a-zA-Z0-9\\.\\@_\\-]+$/, 1, department => qr/^[a-zA-Z0-9\\.\\@_\\-]+$/, 1, 编辑 管理/部门/删除用户和部门的绑定关系 API: del http://127.0.0.1/api/connector/userdepartment/:id' 编辑 系统/接口释放/全局判断服务树节点释放可以释放 API: get http://127.0.0.1/api/connector/release' 该接口会查询job、ci模块的release接口，都可以释放是才会返回释放 Param: id => qr/^\\d[\\d,]*$/, 1, 编辑 系统内置/判断服务树是否能释放/CI相关 API: get http://127.0.0.1/api/ci/release' Param: id => qr/^\\d[\\d,]*$/, 1, 编辑 系统内置/数据库监控状态 API: get http://127.0.0.1/api/agent/monitor/metrics/mysql' 编辑 系统内置/模块监控状态 API: get http://127.0.0.1/api/agent/monitor/metrics/app' 编辑 系统内置/服务树资源/获取服务树下资源列表 API: get http://127.0.0.1/api/connector/default/node/:projectid' Param: projectid => qr/^\\d+$/, 1, name => [ 'mismatch', qr/'/ ], 0, create_user => [ 'mismatch', qr/'/ ], 0, edit_user => [ 'mismatch', qr/'/ ], 0, create_time_start => qr/^\\d{4}\\-\\d{2}\\-\\d{2}$/, 0, create_time_end => qr/^\\d{4}\\-\\d{2}\\-\\d{2}$/, 0, edit_time_start => qr/^\\d{4}\\-\\d{2}\\-\\d{2}$/, 0, create_time_end => qr/^\\d{4}\\-\\d{2}\\-\\d{2}$/, 0, 编辑 系统内置/服务树资源/添加资源 API: post http://127.0.0.1/api/connector/default/node/:projectid' Param: projectid => qr/^\\d+$/, 1, name => qr/^\\d+\\.\\d+\\.\\d+\\.\\d+$/, 1, 编辑 系统内置/服务树资源/删除资源 API: del http://127.0.0.1/api/connector/default/node/:projectid/:id' Param: projectid => qr/^\\d+$/, 1, id => qr/^\\d+$/, 1, 编辑 系统内置/服务树资源/获取资源列表 API: get http://127.0.0.1/api/connector/default/node/api/:projectid' 前端不要调用，该地址配置在连接器配置文件中用于获取资源 Param: projectid => qr/^\\d+$/, 1, 编辑 系统内置/用户/获取用户列表 API: any http://127.0.0.1/api/connector/default/user/userlist' 编辑 系统内置/用户/添加用户 API: post http://127.0.0.1/api/connector/default/user/adduser' Param: user => qr/^[a-zA-Z0-9\\@_\\.\\-]+$/, 1, 编辑 系统内置/用户/删除用户 API: del http://127.0.0.1/api/connector/default/user/deluser' Param: user => qr/^[a-zA-Z0-9\\@_\\.\\-]+$/, 1, 编辑 系统内置/用户/修改自己的密码 API: post http://127.0.0.1/api/connector/default/user/chpasswd' Param: old => qr/^.+$/, 1, new1 => qr/^.+$/, 1, new2 => qr/^.+$/, 1, 编辑 系统内置/用户/修改自己的密码/给审批前端使用 API: post http://127.0.0.1/api/connector/default/approve/user/chpasswd' Param: old => qr/^.+$/, 1, new1 => qr/^.+$/, 1, new2 => qr/^.+$/, 1, 编辑 系统内置/用户/获取用户基本信息 API: get http://127.0.0.1/api/connector/internal/user/username' 编辑 系统内置/用户/用户登出 API: any http://127.0.0.1/api/connector/default/user/logout' 编辑 系统内置/用户/用户登录 API: any http://127.0.0.1/api/connector/default/user/login' Param: user => qr/^[a-zA-Z0-9\\@_\\.\\-]+$/, 1, 编辑 系统内置/用户/二次验证 API: any http://127.0.0.1/api/connector/default/user/mfa' Param: keys => qr/^[a-zA-Z0-9\\@_\\.\\-]+$/, 1, code => qr/^[a-zA-Z0-9\\@_\\.\\-]+$/, 1, 编辑 系统内置/用户服务树权限/获取列表 API: any http://127.0.0.1/api/connector/default/auth/tree/userauth' 编辑 系统内置/用户服务树权限/删除权限 API: del http://127.0.0.1/api/connector/default/auth/tree/delauth' Param: id => qr/^\\d+$/, 1, 编辑 系统内置/用户服务树权限/添加权限 API: post http://127.0.0.1/api/connector/default/auth/tree/addauth' Param: user => qr/^[a-zA-Z0-9\\@_\\.\\-]+$/, 1, tree => qr/^\\d+$/, 1, level => qr/^\\d+$/, 1, 编辑 系统内置/用户领导/获取列表 API: get http://127.0.0.1/api/connector/default/leader' 编辑 系统内置/用户领导/添加用户 API: post http://127.0.0.1/api/connector/default/leader' Param: user => qr/^[a-zA-Z0-9\\@_\\.\\-]+$/, 1, leader1 => qr/^[a-zA-Z0-9\\@_\\.\\-]+$/, 1, leader2 => qr/^[a-zA-Z0-9\\@_\\.\\-]+$/, 0, 编辑 系统内置/用户领导/删除用户 API: del http://127.0.0.1/api/connector/default/leader' Param: user => qr/^[a-zA-Z0-9\\@_\\.\\-]+$/, 1, 编辑 系统内置/监控指标/数据库 API: get http://127.0.0.1/api/ci/monitor/metrics/mysql' 编辑 系统内置/监控指标/模块 API: get http://127.0.0.1/api/ci/monitor/metrics/app' 编辑 系统内置/短信/获取短信列表 API: get http://127.0.0.1/api/connector/default/mesg' 编辑 系统内置/短信/发送短信 API: post http://127.0.0.1/api/connector/default/mesg' 注：属于内置接口，只有后端模块可能会调用。 Param: user => qr/^[a-zA-Z0-9\\.\\@_\\:\\-]+$/, 1, mesg => qr/.+/, 1, 编辑 系统内置/自监控 API: any http://127.0.0.1/api/ci/mon' 编辑 系统内置/模块reload API: any http://127.0.0.1/api/ci/reload' 编辑 系统内置/自监控/C3监控指标 API: get http://127.0.0.1/api/jobx/monitor/metrics' 系统自监控，普罗米修斯的数据格式 编辑 系统内置/自监控/数据库指标监控 API: get http://127.0.0.1/api/jobx/monitor/metrics/mysql' 编辑 系统内置/自监控/模块指标监控 API: get http://127.0.0.1/api/jobx/monitor/metrics/app' 编辑 系统内置/获取服务树map信息 API: get http://127.0.0.1/api/connector/default/tree/map' 编辑 系统内置/获取服务树结构 API: get http://127.0.0.1/api/connector/default/tree' 编辑 系统内置/在跟节点上创建服务树节点 API: post http://127.0.0.1/api/connector/default/tree' Param: name => qr/^[a-zA-Z][a-zA-Z0-9_\\-]*$/, 1, 编辑 系统内置/在普通节点上创建服务树节点 API: post http://127.0.0.1/api/connector/default/tree/:projectid' Param: projectid => qr/^\\d+$/, 1, name => qr/^[a-zA-Z][a-zA-Z0-9_\\-]*$/, 1, 编辑 系统内置/删除服务树节点 API: del http://127.0.0.1/api/connector/default/tree/:treeid' Param: treeid => qr/^\\d+$/, 1, 编辑 系统版本/获取更新内容 API: get http://127.0.0.1/api/connector/version/log' 编辑 系统版本/获取当前版本号 API: get http://127.0.0.1/api/connector/version/name' 编辑 系统管理/网络监控 API: get http://127.0.0.1/api/ci/networkmonitor' 监控代理的网络情况 编辑 系统自监控/获取数据库监控指标 API: get http://127.0.0.1/api/job/monitor/metrics/mysql' 编辑 系统自监控/获取模块状态 API: get http://127.0.0.1/api/job/monitor/metrics/app' 编辑 系统设置/获取设置信息 API: get http://127.0.0.1/api/connector/sysctl' 编辑 系统设置/获取节点名称 API: get http://127.0.0.1/api/connector/sysctl/hostname' 集群中的每台机器都有一个唯一的名称，这个接口可以查询当前相应请求的节点的名称。 编辑 系统设置/编辑设置 API: post http://127.0.0.1/api/connector/sysctl' 编辑 脚本管理/获取脚本列表 API: get http://127.0.0.1/api/job/scripts/:projectid' Param: projectid => qr/^\\d+$/, 1, name => [ 'mismatch', qr/'/ ], 0, create_user => [ 'mismatch', qr/'/ ], 0, edit_user => [ 'mismatch', qr/'/ ], 0, create_time_start => qr/^\\d{4}\\-\\d{2}\\-\\d{2}$/, 0, create_time_end => qr/^\\d{4}\\-\\d{2}\\-\\d{2}$/, 0, edit_time_start => qr/^\\d{4}\\-\\d{2}\\-\\d{2}$/, 0, edit_time_end => qr/^\\d{4}\\-\\d{2}\\-\\d{2}$/, 0, 编辑 脚本管理/获取单个脚本详细信息 API: get http://127.0.0.1/api/job/scripts/:projectid/:scriptsid' Param: projectid => qr/^\\d+$/, 1, scriptsid => qr/^\\d+$/, 1, 编辑 脚本管理/创建脚本 API: post http://127.0.0.1/api/job/scripts/:projectid' Param: projectid => qr/^\\d+$/, 1, name => [ 'mismatch', qr/'/ ], 1, type => [ 'in', 'shell', 'perl', 'python', 'php', 'buildin', 'auto' ], 1, 编辑 脚本管理/编辑脚本 API: post http://127.0.0.1/api/job/scripts/:projectid/:scriptsid' Param: projectid => qr/^\\d+$/, 1, scriptsid => qr/^\\d+$/, 1, name => [ 'mismatch', qr/'/ ], 1, type => [ 'in', 'shell', 'perl', 'python', 'php', 'buildin', 'auto' ], 1, 编辑 脚本管理/删除脚本 API: del http://127.0.0.1/api/job/scripts/:projectid/:scriptsid' Param: projectid => qr/^\\d+$/, 1, scriptsid => qr/^\\d+$/, 1, 编辑 节点管理/主机节点健康检查 API: get http://127.0.0.1/api/ci/kubernetes/nodecheck' 检查一个节点是否能连上或者是否能同步文件。 注: 该接口不应该放到kubernetes的url下，临时借用的v2版本的接口特性。 可以迁移到c3mc接口中。 Param: treeid => qr/^\\d+$/, 1, node => qr/^[\\d\\.,]+$/, 1, type => [ 'in', 'call', 'sync' ], 1, 编辑 虚拟服务树/服务树主机管理/获取主机列表 API: get http://127.0.0.1/api/connector/vnode/:vtreeid' Param: vtreeid => qr/^\\d+$/, 1, 编辑 虚拟服务树/服务树主机管理/添加主机 API: post http://127.0.0.1/api/connector/vnode/:vtreeid' Param: name => qr/^[a-zA-Z0-9][a-zA-Z0-9_\\-\\.,]*[a-zA-Z0-9]$/, 1, 编辑 虚拟服务树/服务树主机管理/删除主机 API: del http://127.0.0.1/api/connector/vnode/:vtreeid' Param: name => qr/^[a-zA-Z0-9][a-zA-Z0-9_\\-\\.,]*[a-zA-Z0-9]$/, 1, 编辑 虚拟服务树/服务树管理/获取虚拟服务树列表 API: get http://127.0.0.1/api/connector/vtree/:projectid' Param: projectid => qr/^\\d+$/, 1, 编辑 虚拟服务树/服务树管理/创建虚拟服务树节点 API: post http://127.0.0.1/api/connector/vtree/:projectid' Param: projectid => qr/^\\d+$/, 1, name => qr/^[a-zA-Z][a-zA-Z0-9_\\-]*[a-zA-Z0-9]$/, 1, 编辑 虚拟服务树/服务树管理/删除虚拟服务树节点 API: del http://127.0.0.1/api/connector/vtree/:projectid/:id' Param: projectid => qr/^\\d+$/, 1, id => qr/^\\d+$/, 1, 编辑 虚拟终端/打开虚拟终端 API: any http://127.0.0.1/api/job/cmd/:projectid' 编辑 虚拟终端/打开Mysql终端 API: any http://127.0.0.1/api/job/cmd/ext/mysql/:projectid' 编辑 虚拟终端/打开Redis终端 API: any http://127.0.0.1/api/job/cmd/ext/redis/:projectid' 编辑 虚拟终端/查看操作日志 API: get http://127.0.0.1/api/job/cmd/:projectid/log' Param: projectid => qr/^\\d+$/, 1, user => [ 'mismatch', qr/'/ ], 0, node => [ 'mismatch', qr/'/ ], 0, usr => [ 'mismatch', qr/'/ ], 0, cmd => [ 'mismatch', qr/'/ ], 0, time_start => qr/^\\d{4}\\-\\d{2}\\-\\d{2}$/, 0, time_end => qr/^\\d{4}\\-\\d{2}\\-\\d{2}$/, 0, 编辑 轻应用/获取列表 API: get http://127.0.0.1/api/job/smallapplication/bytreeid/:treeid' Param: treeid => qr/^\\d+$/, 1, 编辑 轻应用/获取详情 API: get http://127.0.0.1/api/job/smallapplication/:id' 编辑 轻应用/创建轻应用 API: post http://127.0.0.1/api/job/smallapplication' Param: jobid => qr/^\\d+$/, 1, treeid => qr/^\\d+$/, 1, type => [ 'mismatch', qr/'/ ], 1, title => [ 'mismatch', qr/'/ ], 1, describe => [ 'mismatch', qr/'/ ], 1, parameter => [ 'mismatch', qr/'/ ], 1, 编辑 轻应用/编辑轻应用 API: post http://127.0.0.1/api/job/smallapplication/:id' Param: id => qr/^\\d+$/, 1, jobid => qr/^\\d+$/, 1, treeid => qr/^\\d+$/, 1, type => [ 'mismatch', qr/'/ ], 1, title => [ 'mismatch', qr/'/ ], 1, describe => [ 'mismatch', qr/'/ ], 1, parameter => [ 'mismatch', qr/'/ ], 1, 编辑 轻应用/删除轻应用 API: del http://127.0.0.1/api/job/smallapplication/:id' 编辑 连接器/获取服务树节点资源列表 API: get http://127.0.0.1/api/connector/connectorx/nodeinfo/:projectid' 编辑 连接器/获取用户服务树 API: get http://127.0.0.1/api/connector/connectorx/usertree' 编辑 连接器/获取用户服务树/map格式 API: get http://127.0.0.1/api/connector/connectorx/usertree/treemap' 编辑 连接器/获取全量服务树map API: get http://127.0.0.1/api/connector/connectorx/treemap' 编辑 连接器/内部权限对接 API: get http://127.0.0.1/api/connector/connectorx/point' Param: point => qr/^[a-z0-9_]+$/, 1, treeid => qr/^\\d+$/, 0, 编辑 连接器/内部连接器查询用户名称 API: get http://127.0.0.1/api/connector/connectorx/username' 编辑 连接器/获取cookie的key名称 API: get http://127.0.0.1/api/connector/connectorx/cookiekey' 编辑 连接器/获取用户信息 API: get http://127.0.0.1/api/connector/connectorx/sso/userinfo' 前端使用 编辑 连接器/获取用户信息 API: get http://127.0.0.1/api/connector/connectorx/approve/sso/userinfo' 给审批插件用 编辑 连接器/查询用户名称 API: get http://127.0.0.1/api/connector/connectorx/approve/username' 给审批插件用 编辑 连接器/用户登出 API: any http://127.0.0.1/api/connector/connectorx/approve/ssologout' 给审批插件用 编辑 连接器/前端跳转登录 API: any http://127.0.0.1/api/connector/connectorx/sso/loginredirect' 编辑 连接器/前端跳转修改密码 API: any http://127.0.0.1/api/connector/connectorx/sso/chpasswdredirect' 编辑 连接器/登出 API: any http://127.0.0.1/api/connector/connectorx/ssologout' 编辑 连接器/消息通知 API: any http://127.0.0.1/api/connector/connectorx/notify' 通过这个接口发送消息通知。 其它模块要发送邮件短信等消息，通过这个接口进行统一处理。 该接口会把消息发送到连接器配置中的出口。 编辑 连接器/发起审批 API: post http://127.0.0.1/api/connector/connectorx/approval' 外部审批接口, 审批发起到该接口。 接口会把请求打到外部审批接口。 Param: content => qr/.+/, 1, submitter => qr/^[a-zA-Z0-9\\@_\\.\\-]+$/, 1, approver => qr/^[a-zA-Z0-9\\@_\\.\\-]+$/, 1, 编辑 连接器/获取审批状态 API: get http://127.0.0.1/api/connector/connectorx/approval' Param: uuid => qr/^[a-zA-Z0-9]+$/, 1, 编辑 连接器/审计日志/添加 API: post http://127.0.0.1/api/connector/connectorx/auditlog' Param: user => qr/^[a-zA-Z0-9\\@_\\.\\-]+$/, 1, title => [ 'mismatch', qr/'/ ], 1, content => [ 'mismatch', qr/'/ ], 1, 编辑 连接器/审计日志/获取 API: get http://127.0.0.1/api/connector/connectorx/auditlog' Param: time => qr/^[0-9: \\-]+$/, 0, user => qr/^[a-zA-Z0-9\\@_\\.\\-]+$/, 0, title => [ 'mismatch', qr/'/ ], 0, content => [ 'mismatch', qr/'/ ], 0, 编辑 连接器/登录登出日志/获取 API: get http://127.0.0.1/api/connector/connectorx/loginaudit' Param: time => qr/^[0-9: \\-]+$/, 0, user => qr/^[a-zA-Z0-9\\@_\\.\\-]+$/, 0, action => [ 'mismatch', qr/'/ ], 0, ip => [ 'mismatch', qr/'/ ], 0, 编辑 连接器/设置cookie API: any http://127.0.0.1/api/connector/connectorx/setcookie' 编辑 连接器/获取mfa状态 API: get http://127.0.0.1/api/connector/connectorx/mfa' 编辑 连接器/设置mfa API: post http://127.0.0.1/api/connector/connectorx/mfa' Param: type => qr/^[a-zA-Z0-9]+$/, 1, 编辑 连接器/获取部门服务树 API: get http://127.0.0.1/api/connector/connectorx/depttree' 编辑 连接器配置/获取配置内容 API: get http://127.0.0.1/api/connector/config' Param: name => qr/^[a-zA-Z0-9]+$/, 1, 编辑 连接器配置/修改配置 API: post http://127.0.0.1/api/connector/config' 注: 配置修改后系统会自动reload 编辑 连接器配置/获取历史版本列表 API: get http://127.0.0.1/api/connector/config/list' 编辑 通知管理/获取所以环境变量 API: get http://127.0.0.1/api/job/environment' 编辑 通知管理/提交变量状态 API: post http://127.0.0.1/api/job/environment' isApiFailEmail:false isApiFailSms:false isApiSuccessEmail:false isApiSuccessSms:false isApiWaitingEmail:false isApiWaitingSms:false isCrontabFailEmail:false isCrontabFailSms:false isCrontabSuccessEmail:false isCrontabSuccessSms:false isCrontabWaitingEmail:false isCrontabWaitingSms:false isPageFailEmail:false isPageFailSms:false isPageSuccessEmail:false isPageSuccessSms:false isPageWaitingEmail:false isPageWaitingSms:false notifyTemplateEmailTitle notifyTemplateEmailContent notifyTemplateSmsContent 编辑 通知管理/删除变量 API: del http://127.0.0.1/api/job/environment' 参数: deletename1=1 deletename2=1 编辑 Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/Connector/pp/tt/":{"url":"open-c3-code/Connector/pp/tt/","title":" BPM工单流程通知 ","keywords":"","body":"BPM工单流程通知 部分BPM流程会转成工单进行处理。 工单创建后，默认会通知用户 bpm_notify 和 用户组 @bpm_notify 以此同时不同的流程中配置了额外的通知人。如 DBA相关的流程通知 @bpm_notify_dba Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/Connector/pp/bpm/action/approval/":{"url":"open-c3-code/Connector/pp/bpm/action/approval/","title":" BPM/插件说明/approval ","keywords":"","body":"BPM/插件说明/approval 例子 如下是一个常规的审批插件配置 --- name: 运维审批 option: - describe: 运维审批人 name: approver type: selectx value: \"\" command: \"c3mc-bpm-optionx-opapprover\" template_argv: approver: ${approver} title: \"BPM/${_bpmuuid_}/资源申请/腾讯云/CVM\" content: \"\\n申请人:${_user_}\\nBPM单号:${_bpmuuid_}\\n申请理由:${x.note}\" 其中template_argv下的approver是审批人 字段描述 template_argv字段描述: approver: 审批人 title: 审批的标题 content: 审批的内容 everyone: 1 # 可选，为1时说明每个人都需要审批，没有配置或者为0时，说明只要审批列表中的一个人进行审批即可。 relaxed: 1 # 可选，如果发起人和审批人是同一个人时，跳过这个人的审批。 submitter: sys@app # 可选，默认不写的情况下发起人是sys@app timeout: 86400 # 可选，默认是86400秒 record: 1 # 可选，默认为0， 当为1是，说明该审批人是当前流程的处理人 upgradeto: 'user1' # 可选，如果发起人(submitter)和审批人是同一个人的时候升级为这个人审批 扩展 为了满足不同的需求，对approver进行了扩展，扩展函数如下: leader 领导审批 如下是资源审批时，提交人领导审批的例子 --- name: '提交人的领导审批' option: - describe: 申请理由 name: note type: text value: \"\" template_argv: approver: \"leader(${_user_})\" title: \"BPM/${_bpmuuid_}/资源申请/腾讯云/CVM\" content: \"\\n申请人:${_user_}\\nBPM单号:${_bpmuuid_}\\n申请理由:${x.note}\" boss 老板审批 如下是资源审批时，提交人老板审批的例子 --- name: '提交人的领导审批' option: - describe: 申请理由 name: note type: text value: \"\" template_argv: approver: \"boss(${_user_})\" title: \"BPM/${_bpmuuid_}/资源申请/腾讯云/CVM\" content: \"\\n申请人:${_user_}\\nBPM单号:${_bpmuuid_}\\n申请理由:${x.note}\" accountowner 云账号归属人审批 和boss类似 sudoer & ipowner & or sudoer人审批 资源的ip查找owner，该owner审批 or 关键字，会按照顺序查找，如果找不到前面的审批人就往下找，例子中找不到sudo审批人，就找资源owner审批。 --- name: 领导审批或者资源owner审批 option: - describe: 申请理由 name: note type: text value: template_argv: approver: \"sudoer(${x.auth_type},${_user_}) or ipowner(${x.ip_list})\" title: \"BPM/${_bpmuuid_}/申请服务器权限\" content: \"\\n申请人:${_user_}\\n权限类型:${x.auth_type__alias}\\n服务器ip列表:${x.ip_list}\\nBPM单号:${_bpmuuid_}\\n申请理由:${x.note}\" 注：sudo审批人 在某些企业中，申请资源sudo权限有一个特殊的映射关系，如果存在下面两个文件，说明有sudo审批人的映射关系. 其中sudo0是普通的机器权限，sudo1是申请机器的sudo权限。 [root@bogon approval]# cat /data/open-c3-data/bpm/sudoer0.conf open-c3: user001 [root@bogon approval]# cat /data/open-c3-data/bpm/sudoer1.conf open-c3: user002 k8sowner k8s集群的owner审批。 --- name: kubernetes集群owner审批 option: - describe: 申请理由 name: note type: text value: template_argv: approver: \"k8sowner(${x.cluster})\" title: \"BPM/${_bpmuuid_}/申请在K8S集群中创建应用\" content: \"\\n申请人:${_user_}\\n集群ID:${x.cluster}\\n集群名称:${x.cluster__alias}\\n应用模版:${x.template}\\nBPM单号:${_bpmuuid_}\\n申请理由:${x.note}\" vuuidowner 和ipowner的用法类似，区别在于这里是vuuid的资源owner进行审批。 mongroup 审批人指定监控告警组 --- name: kubernetes集群owner审批 option: - describe: 申请理由 name: note type: text value: template_argv: approver: \"mongroup(your-group-name)\" title: \"title...\" content: \"content...\" Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/JOB/bpm/plugin.html":{"url":"open-c3-code/JOB/bpm/plugin.html","title":" BPM/插件配置说明 ","keywords":"","body":"BPM/插件配置说明 概述 关键字: name 、option 、template_argv 每个插件都会包含如下配置，name为插件的名称， option数组最终会显示在bpm前端的表单上。 template_argv中的数据，经过变量替换后，在bpm执行阶段，会转换成一个json数据从标准输入传递给插件代码进行执行。 name: 插件名称 option: - name: domain describe: 域名 type: input template_argv: domain: ${domain} 配置详情 普通输入框 关键字: input 说明: 普通输入框是一种最简单的格式，type类型为input。 例子: name: 插件名称 option: - name: domain describe: 域名 type: input template_argv: domain: ${domain} 下拉框/列表固定 关键字: select 、option 说明: 下拉列表是一个固定的内容, type 为select， option为一个数组，数组的内容就是下拉列表的内容. 例子: name: 插件名称 option: - name: domain describe: 域名 type: select option: [\"HTTP\", \"HTTPS\", \"TRPC\"] - name: domain2 describe: 另一种格式有别名 type: select option: - name: HTTP alias: 名字1 - name: HTTPS alias: 名字2 template_argv: domain: ${domain} 下拉框/列表通过命令获取/单选 说明: 下拉列表通过命令可以获取到的内容, type 为selectx. command为在c3容器中可以执行的命令。 命令从标准输入获取到rely中依赖的字段，会已json的格式从标准输入传递给command。 命令输出内容为下拉框的内容，有两种格式，一列或者两列，中间用“;”号分隔。 两列的情况下，第二列为下拉框内容的别名。 关键字: selectx 、 command 、rely 例子: name: 插件名称 option: - name: data1 describe: 数据1 type: input - name: domain describe: 域名 rely: - data1 type: selectx command: c3mc-qcloud-clb-describe-cvm-list | c3mc-bpm-display-field-values InstanceId,InstanceName,PrivateIp,PublicIp,VirtualPrivateCloud[VpcId] template_argv: domain: ${domain} 下拉框内建命令 关键词: command为数组格式 说明: 上述描述中，通过command字段，通过执行命令获取到下拉框的内容。 但是有的下拉框内容的数据是需要解析当前表单的数据来实现的，所以这里设置了几个内置的命令。 当command为数组形式时，为内建命令的方式。 当前存在的内置命令： list: 获取表单中某个名字的列表，该名字在表单中多次出现，或者它是运行多个执行. 如果已经选择的字段的内容变化了，前端上会自动清空当前数据项。 point: 把自己当前的下拉框的内容，去获取本插件同名的“参数1”，然后在那个插件上找到“参数2”的值作为自己下拉框的内容。 如果已经选定的数据项的值发生变化，前端也会自动清空当前数据项。 例子: name: 插件名称 option: - name: listener_name describe: 监听器名字 type: selectx command: [ 'list', 'listener_name' ] - name: protocol describe: 协议 rely: - listener_name - x.protocol command: [\"point\", \"listener_name\", \"protocol\" ] type: selectx value: \"\" template_argv: domain: ${domain} 下拉框/列表通过命令获取/多选 关键字: selectxm 说明: 和单选的情况一样，只是把单选中的selectx修改成selectxm。 注: 多选的情况下，后端插件获取到的选项的值是逗号分隔。 默认选项 关键字: value 说明: 输入框或者下拉框等，如果在页面展示的时候想要一个默认的值，可以配置上value字段。 例子: name: 插件名称 option: - name: domain describe: 域名 type: input value: \"按权重轮询\" template_argv: domain: ${domain} 控制隐藏或者展示/简单 关键字: show 说明: 默认情况下所有的选项都是展示在bpm的表单中的。 如果需要做选项依赖的时候，可以通过show字段开进行控制。 比如A和B两个选项，当A是某些值的时候，B才展示出来。 例子: name: 插件名称 option: - name: dataA describe: 描述A type: select option: [\"abc\", \"foo\", \"bar\", \"123\" ] - name: dataB describe: 描述B type: input value: \"按权重轮询\" show: [\"dataA\", \"foo\", \"bar\"] template_argv: domain: ${domain} 控制隐藏或者展示/复杂 关键字: show 说明: 和简单形式一样，都是用show进行控制，复杂情况下，show为数组形式，每个数组是一个HASH的内容。 数组内是“与”的关系，数组之间是“或”的关系。 如下例子中，show数组有两个元素，满足其中一个它就会显示出来。 （（ dataA 为 foo 或者 bar ）&& （dataB 为 789 ））|| ( dataD 为 456 ) 例子: name: 插件名称 option: - name: dataA describe: 描述A type: select option: [\"abc\", \"foo\", \"bar\", \"123\" ] - name: dataB describe: 描述B type: input value: \"按权重轮询\" show: - dataA: [ \"foo\", \"bar\"] dataC: [ \"789\" ] - dataD: [ \"456\" ] template_argv: domain: ${domain} 运维代填 关键字: fromops 说明: bpm流程中有的信息是比较复杂的，提交人可能不知道怎么填写， 插件可以通过定义fromops来控制是不是允许运维代填。 流程中所有的插件，只要有一个插件有fromops为1的情况，前端会展示“运维代填”的按钮，点击该按钮后，fromops为1的插件的所有选项框会隐藏。 例子: name: 插件名称 fromops: 1 option: - name: dataA describe: 描述A type: select option: [\"abc\", \"foo\", \"bar\", \"123\" ] template_argv: domain: ${domain} 插件步骤多选 关键字: multi 说明: 有的插件可能需要进行多选，比如创建负载均衡器的时候，监听器的插件是可以多选的。 在监听器的插件上配置 multi 为1. 当multi为1时，前端在插件的步骤下面会显示添加和删除按钮， 例子: name: 插件名称 multi: 1 option: - name: dataA describe: 描述A type: select option: [\"abc\", \"foo\", \"bar\", \"123\" ] template_argv: domain: ${domain} 插件步骤多选/一次性全部调用 关键字: sys_multi 说明: 当插件是可以多选的情况下，默认情况下，在bpm流程启动后，插件是多次进行接收和调用数据的， 如上一步描述的内容，如果监听器是多个的情况下，会多次进行监听器插件的调用。 但是在某些情况下，你的插件如果想一次接收所有的数据，那就在template_argv数据中添加上_sys_multi_为1 例子: name: 插件名称 multi: 1 option: - name: dataA describe: 描述A type: select option: [\"abc\", \"foo\", \"bar\", \"123\" ] template_argv: domain: ${domain} _sys_multi_: 1 获取其它插件内容 说明: template_argv中的内容，在插件执行时，系统会把格式为“${变量名}”的用本插件option中的内容进行替换。替换完后在调用插件， 这样插件就可以获取到表单中真实选择的内容。 但是某些情况下，可能需要获取其它插件的内容，比如申请服务器权限的流程是先审批后通过插件添加权限。 如果在审批的时候，希望审批内容中显示申请的机器的ip列表，那么通过“{x.变量名}”的方式获取到其它插件的参数。 如果名字重复,系统会随机找出一个。 特别说明： 插件中每个变量都有一个唯一的名字，也可以通过唯一名字来指定变量的名 通过“x.”是为了让系统自己找到变量。 比如插件1中有变量abc，在系统内部，其实该变量的准确名字是 \"1.abc\" 例子: name: 插件名称 multi: 1 option: - name: dataA describe: 描述A type: select option: [\"abc\", \"foo\", \"bar\", \"123\" ] template_argv: domain: ${domain} foo: ${x.abc} 获取前面已运行插件的结果 关键值: LOG.xxx VAR.key:value 说明: 有的情况下，后一步的插件需要获取到前一步插件的执行结果。 比如某个流程中需要同时创建负载均衡器和服务器。创建完成后，负载均衡器下面自动配置上了该服务器。 这时候是需要先创建服务器，服务器创建出来后会得到ip。负载均衡器的插件需要得到上一步服务器创建的时候的ip。 就可以在创建负载均衡器的插件中的template_argv字段，通过var.xxx的格式获取到上一步的ip。 特别说明: 插件在执行的过程中，可能会输出很多内容，插件可以通过两种特殊的格式，把数据反馈给流程。 格式1: LOG.要显示的内容 ，插件如果以“LOG.”开头输出内容，bpm流程执行时会把这个内容显示在前端 格式2: VAR.变量名:变量的值 ， 插件如果以该格式输出内容，该信息会反馈到bpm流程中，其它后续插件可以通过${var.key的名称}获取到对应的内容. 当输出的变量名重复时候，通过${var.xxx}获取时，得到的是一个用逗号分隔的字符串。 例子: name: 插件名称 multi: 1 option: - name: dataA describe: 描述A type: select option: [\"abc\", \"foo\", \"bar\", \"123\" ] template_argv: domain: ${domain} ip: ${var.ip} 依赖说明 关键值: rely 说明: 在文档的上半部分我们描述过rely，用来控制下拉框插件的。 除了这个功能之外，在前端上，如果做了依赖的配置，依赖的选项变动后自己的选项空会被清空。 同时如果依赖的选项如果还没有值，点击当前选项的时候，会进行红色提醒，也不会发起请求到后端，因为依赖还没有赋值完成。 注: 当前清空操作不识别 x.xxx 的格式 例子: name: 插件名称 multi: 1 option: - name: dataA describe: 描述A type: select option: [\"abc\", \"foo\", \"bar\", \"123\" ] template_argv: domain: ${domain} 其他字段说明 source_type_list: 如果下拉框选项中添加了这个字段为true，那边页面上会允许切换成手动写入 Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/Connector/pp/bpm/special_encoding.html":{"url":"open-c3-code/Connector/pp/bpm/special_encoding.html","title":" BPM/特殊编码说明 ","keywords":"","body":"BPM/特殊编码说明 调用某些云接口创建资源时，可能标签值不允许某些特殊字符，比如 \"@\" 符号，导致无法在标签值中配置邮箱地址。针对这种不支持特殊符号的情况，我们使用如下编码格式对标签值中出现的特殊符号进行转码。 转码的格式如下: E\\d+E 表示以 \"E\" 开头，以 \"E\" 结尾，中间的数字是要转码的特殊字符的ascii编码的十进制表示。 比如 \"@\" 符号的ascii十进制为64，则编码格式为 \"E64E\"。 Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/c3mcdoc.html":{"url":"open-c3-code/c3mcdoc.html","title":" C3MC/文档 ","keywords":"","body":"C3MC/文档 c3mc-mon-agent-falconmigrate/bash 编辑 c3mc-mon-agent-install/bash 编辑 c3mc-mon-agent-install-allnode/perl $0 编辑 c3mc-mon-agent-install-errfalconmigrate/perl $0 编辑 c3mc-mon-agent-install-errnode/perl $0 编辑 c3mc-mon-agent-install-errver/perl $0 编辑 c3mc-mon-agent-install-goodver/perl $0 编辑 c3mc-mon-agent-update/bash 编辑 c3mc-mon-ip2uexip/perl echo 10.10.10.10| $0 编辑 c3mc-app-awscli-get/perl $0 -id ticketid 编辑 c3mc-app-findtags/perl $0 id1 id2 .. idn 编辑 c3mc-app-ipfill/perl $0 ip1 ip2 ... ipn 编辑 c3mc-app-ipsearch/perl $0 ip 编辑 c3mc-app-merge-report/perl $0 [--path '/path/foo'] 编辑 c3mc-app-okfill/perl $0 ip1 ip2 ... ipn 编辑 c3mc-app-online/perl $0 $0 [--set online|offline] [--name slave-name-001] $0 --module [ci|job|jobx|agent|monitor] $0 --module [ci|job|jobx|agent|monitor] [--set online|offline] 编辑 c3mc-app-port-checkok/perl $0 编辑 c3mc-app-supervisormin/perl 编辑 c3mc-app-usrext/perl $0 usr1 usr2 usr3 .. usrn $0 user # username $0 @monitorgroup # user from monitor group $0 %oncallgroup # oncall user level 1 $0 %oncallgroup:1 # oncall user level 1 $0 %oncallgroup:level # oncall user level $level $0 :departmentname # user from department 编辑 c3mc-base-adduser/perl $0 --user foo $0 --user foo@openc3.com $0 --user foo --password 123456 编辑 c3mc-base-approval-create/perl $0 --submitter user1 --approver user2 编辑 c3mc-base-approval-query/perl $0 --uuid uuid 编辑 c3mc-base-approval-sync/perl $0 --uuid uuid --status agree,refuse 编辑 c3mc-base-audit/perl $0 'user1;title1;content1' 'user2;title2;content2' ... 'usern;titlen;contentn' 编辑 c3mc-base-configx/perl $0 datakey 编辑 c3mc-base-count-limit/perl $0 id1 id2 ... idn --limit 1 $0 id1;abc id2;foo ... idn;bar --limit number 编辑 c3mc-base-crypt/perl $0 mesg --encode || --decode cat mesg.file| $0 --encode || --decode # 如果要处理的数据是用分号分隔的多个列，可以通过--col指定要处理的列 # 比如要处理第一和第二列，可以添加参数 --col 1,2 $0 mesg --col 1,2 --encode || --decode cat mesg.file| $0 --col 1,2 --encode || --decode 编辑 c3mc-base-db-dump/perl $0 --table foo $0 --table foo --output out.sql 编辑 c3mc-base-db-exe/perl $0 sql1 sql2 ... sqln --table foo cat foo.sql | ./$0 --table foo 编辑 c3mc-base-db-get/perl $0 col1 col2 ... coln --table foo $0 col1 col2 ... coln --table foo [--filter status=1] $0 col1 col2 ... coln --table foo [--yaml] 编辑 c3mc-base-db-ins/perl $0 --table foo k1 v1 k2 v2 .. kn vn 编辑 c3mc-base-db-load/perl $0 --table foo --file out.sql 编辑 c3mc-base-db-set/perl $0 dat1 dat2 ... datn --table foo --set 'foo=123' $0 dat1 dat2 ... datn --table foo --set 'foo=123' [--col colname] $0 dat1 dat2 ... datn --table foo --set 'foo=123' [--col colname] [--filter] 编辑 c3mc-base-dumpfile/perl $0 --file /path/foo 编辑 c3mc-base-fullnodeinfo/perl $0 col1 col2 .. col2 [ --col name,inip [id|name|type|inip|exip|projectid] ] --force_ingestion_cmdb --skip_ingestion_api 编辑 c3mc-base-git/perl 编辑 c3mc-base-grepv/perl $0 --col 2 --file /path/name 编辑 c3mc-base-hostexip/perl $0 编辑 c3mc-base-hostname/perl $0 $0 newhostname 编辑 c3mc-base-ipfilter/perl prefix match $0 ip1 ip2 ... ipn --filter 10.10,12,122, 编辑 c3mc-base-json2tab/perl $0 name1 alias1 name2 alias2 .. namen aliasn 编辑 c3mc-base-log-addtime/perl 编辑 c3mc-base-log-addtimemin/perl 编辑 c3mc-base-log-formattime/perl 编辑 c3mc-base-monitorsubscribe-load/perl $0 'treeid;user1@xx.com' $0 'treeid;user1@xx.com' --user foo@xx.com echo 'treeid;user1@xx.com' | ./$0 --user foo@xx.com 编辑 c3mc-base-nodeinfo/perl $0 col1 col2 .. col2 [ --col name,inip [id|name|type|inip|exip|projectid] ] 编辑 c3mc-base-role/perl $0 --module [ci|job|jobx] 编辑 c3mc-base-savebind/perl $0 data1 data2 ... datan 编辑 c3mc-base-savetree/perl $0 treename1 treename2 ... treenamen 编辑 c3mc-base-subtreemap/perl $0 treeid $0 treeid cache 编辑 c3mc-base-tab2json/perl echo table | $0 编辑 c3mc-base-task-grep/perl $0 id1 id2 ... idn --module [ci|job|jobx|agent|monitor] 编辑 c3mc-base-tree-dump/bash 编辑 c3mc-base-tree-dump-bind/perl $0 $0 --showtree $0 --showuuid $0 --compresstree # 压缩服务树，子树覆盖父树的情况下删除父树 编辑 c3mc-base-tree-inherit-limit-check/perl $0 --parent Parent_Node_ID --child Child_Node_ID 编辑 c3mc-base-tree-load/perl $0 'id;treename' 'id;foo.bar' echo 'id;treename' |./$0 编辑 c3mc-base-treemap/perl $0 $0 cache 编辑 c3mc-base-tree-switch/perl $0 tree.prefix.foo treeid 编辑 c3mc-base-uexip/perl $0 ip1 ip2 ... ipn $0 ip1 ip2 ... ipn --output /path/foo.yaml 编辑 c3mc-base-useraddr-load/perl $0 'user;user1@xx.com;137xxx;137xxx' $0 'user;user1@xx.com;137xxx;137xxx' --user foo@xx.com echo 'user;user1@xx.com;137xxx;137xxx' | ./$0 --user foo@xx.com 编辑 c3mc-base-userinfo/perl $0 --user user1 编辑 c3mc-base-userleader/perl $0 --user user1 编辑 c3mc-base-user-temp-token/perl $0 --set user001 $0 --set user002/email $0 --set user003/phone $0 --get token.uuid 编辑 c3mc-base-vtreemap/perl $0 $0 cache 编辑 c3mc-nginx-reload/perl $0 $0 --off 8080 $0 --on 8080 $0 --reload $0 --before $0 --after 编辑 c3mc-parse-tsv-tag-file/python3 编辑 c3mc-base-bastion/python3 编辑 c3mc-base-bastion-addauth-qizhi/python3 编辑 c3mc-base-bastion-adduser-qizhi/python3 编辑 c3mc-base-bastion-getlist-qizhi/python3 编辑 c3mc-bl-sync/python3 编辑 c3mc-base-bastion-add-server-auth/python3 编辑 c3mc-base-bastion-copy-user-auth/python3 编辑 c3mc-base-bastion-send-new-user-email/python3 编辑 c3mc-bpm-action-acl-operation-baseinfo/python3 编辑 c3mc-bpm-action-acl-operation-iteminfo/python3 编辑 c3mc-bpm-action-aliyun-update-ecs-tag/python3 编辑 c3mc-bpm-action-approval/perl 编辑 c3mc-bpm-action-aws-alb-recycle/python3 编辑 c3mc-bpm-action-aws-ec2/python3 编辑 c3mc-bpm-action-aws-ec2-modify-instance-type/python3 编辑 c3mc-ec2modify-describe-ec2-instances/python3 编辑 c3mc-ec2modify-describe-ec2-instance-types/python3 编辑 c3mc-bpm-action-aws-ec2-operation/python3 编辑 c3mc-ec2create-add-role-to-instance-profile/python3 编辑 c3mc-ec2create-describe-availability-zones/python3 编辑 c3mc-ec2create-describe-ebs-volume-max-iops/python3 编辑 c3mc-ec2create-describe-ebs-volume-size-range/python3 编辑 c3mc-ec2create-describe-image-get/python3 编辑 c3mc-ec2create-describe-images-all/python3 编辑 c3mc-ec2create-describe-instance-type-offerings/python3 编辑 c3mc-ec2create-describe-role-list/python3 编辑 c3mc-ec2create-describe-security-groups/python3 编辑 c3mc-ec2create-describe-subnets/python3 编辑 c3mc-ec2create-describe-vpcs/python3 编辑 c3mc-ec2create-instance-profile-create/python3 编辑 c3mc-ec2create-role-create/python3 编辑 c3mc-bpm-action-aws-ec2-recycle/python3 编辑 c3mc-bpm-action-aws-elb-recycle/python3 编辑 c3mc-bpm-action-aws-nlb-recycle/python3 编辑 c3mc-bpm-action-aws-rds-recycle/python3 编辑 c3mc-recycleawsrds-describe-rds-clusters/python3 编辑 c3mc-recycleawsrds-describe-rds-instances/python3 编辑 c3mc-cloudcertificate-display-apply-type-list/python3 编辑 c3mc-cloudcertificate-display-certificate-type-list/python3 编辑 c3mc-cloudcertificate-display-complay-list/python3 编辑 c3mc-cloudcertificate-display-target-list/python3 编辑 c3mc-bpm-action-deal/perl 编辑 c3mc-domain-display-apply-type-list/python3 编辑 c3mc-domain-display-use-list/python3 编辑 c3mc-ec2-modify/python3 编辑 c3mc-ec2modify-display-instance-list/python3 编辑 c3mc-bpm-action-google-lb-1/python3 编辑 c3mc-bpm-action-google-lb-2-frontend/python3 编辑 c3mc-bpm-option-google-list-global-elastic-ips/python3 编辑 c3mc-bpm-option-google-list-ports/python3 编辑 c3mc-bpm-option-google-list-ssl-certificate/python3 编辑 c3mc-bpm-action-google-lb-3-backend/python3 编辑 c3mc-bpm-option-google-list-healthchecks/python3 编辑 c3mc-bpm-option-google-list-intance-groups/python3 编辑 c3mc-bpm-action-google-lb-4-routing-rules/python3 编辑 c3mc-bpm-action-google-lb-5-routing-rules-default-backend/python3 编辑 c3mc-bpm-action-google-lb-6-create/python3 编辑 c3mc-bpm-action-google-lb-recycle/python3 编辑 c3mc-bpm-action-google-vm/python3 编辑 c3mc-bpm-action-google-vm-modify-instance-type/python3 编辑 c3mc-googlemodify-describe-vm-instances/python3 编辑 c3mc-googlemodify-describe-vm-instance-types/python3 编辑 c3mc-bpm-option-google-compute-list-custom-images/python3 编辑 c3mc-bpm-option-google-compute-list-disk-types/python3 编辑 c3mc-bpm-option-google-compute-list-machine-types/python3 编辑 c3mc-bpm-option-google-compute-list-networks/python3 编辑 c3mc-bpm-option-google-compute-list-public-images/python3 编辑 c3mc-bpm-option-google-compute-list-subnetworks/python3 编辑 c3mc-bpm-action-google-vm-recycle/python3 编辑 c3mc-bpm-action-kubernetes-apply/perl 编辑 c3mc-bpm-kubernetes-apply-cluster/bash 编辑 c3mc-bpm-kubernetes-apply-namespace/perl 编辑 c3mc-bpm-kubernetes-apply-template/perl 编辑 c3mc-bpm-action-manage-ec2-instance-groups-add/python3 编辑 c3mc-bo-manage-ec2-instance-groups-list-actions/python3 编辑 c3mc-bo-manage-ec2-instance-groups-list-ec2/python3 编辑 c3mc-bpm-action-manage-ec2-instance-groups-config-special/python3 编辑 c3mc-bpm-action-manage-ec2-instance-groups-remove/python3 编辑 c3mc-bo-manage-ec2-instance-groups-list-current-managed-ec2/python3 编辑 c3mc-bpm-action-mount-tree/python3 编辑 c3mc-bpm-action-qcloud-clb/python3 编辑 c3mc-bpm-action-qcloud-clb-listener/python3 编辑 c3mc-qcloud-clb-describe-cert-list/python3 编辑 c3mc-bpm-action-qcloud-clb-recycle/python3 编辑 c3mc-bpm-action-qcloud-clb-rule/python3 编辑 c3mc-qcloud-clb-describe-check-type/python3 编辑 c3mc-qcloud-clb-describe-cvms/python3 编辑 c3mc-bpm-action-qcloud-cvm/python3 编辑 c3mc-bpm-action-qcloud-cvm-modify-instance-type/python3 编辑 c3mc-qcloud-cvm-describe-instance-configs-v2/python3 编辑 c3mc-qcloud-cvm-describe-instances/python3 编辑 c3mc-qcloud-cvm-describe-data-disk-type-list/python3 编辑 c3mc-qcloud-cvm-describe-images/python3 编辑 c3mc-qcloud-cvm-describe-instance-configs/python3 编辑 c3mc-qcloud-cvm-describe-network-charge-types/python3 编辑 c3mc-qcloud-cvm-describe-security-groups/python3 编辑 c3mc-qcloud-cvm-describe-system-disk-type-list/python3 编辑 c3mc-qcloud-cvm-list-instances-by-keyword/python3 编辑 c3mc-bpm-action-qcloud-cvm-recycle/python3 编辑 c3mc-bpm-action-qcloud-mysql/python3 编辑 c3mc-bpm-action-qcloud-mysql-operate/python3 编辑 c3mc-bpm-option-qcloud-mysql-describe-alarm-policies-list/python3 编辑 c3mc-bpm-option-qcloud-mysql-describe-available-collation/python3 编辑 c3mc-bpm-option-qcloud-mysql-describe-backup-zones/python3 编辑 c3mc-bpm-option-qcloud-mysql-describe-cdb-sell-type-list/python3 编辑 c3mc-bpm-option-qcloud-mysql-describe-describe-default-params/python3 编辑 c3mc-bpm-option-qcloud-mysql-describe-engine-type-list/python3 编辑 c3mc-bpm-option-qcloud-mysql-describe-engine-version-list/python3 编辑 c3mc-bpm-option-qcloud-mysql-describe-instance-config-list/python3 编辑 c3mc-bpm-option-qcloud-mysql-describe-instance-nodes-set/python3 编辑 c3mc-bpm-option-qcloud-mysql-describe-param-templates/python3 编辑 c3mc-bpm-option-qcloud-mysql-describe-protect-mode-list/python3 编辑 c3mc-bpm-option-qcloud-mysql-describe-regions/python3 编辑 c3mc-bpm-option-qcloud-mysql-describe-zones/python3 编辑 c3mc-bpm-action-server-auth-audit/python3 编辑 c3mc-bpm-action-server-auth/python3 编辑 c3mc-bpm-action-server-auth-for-prod-without-sudo/python3 编辑 c3mc-bpm-action-server-auth-for-prod-with-sudo/python3 编辑 c3mc-bpm-action-server-auth-for-test-ips/python3 编辑 c3mc-bpm-action-tt/python3 编辑 c3mc-bpm-action-update-resource-tags/python3 编辑 c3mc-bpm-get-var/perl $0 --bpmuuid xxx $0 --bpmuuid xxx --json $0 --bpmuuid xxx stepid1 stepid2 .. $0 --bpmuuid xxx stepname1 stepname2 .. 编辑 c3mc-bpm-optchk/perl cat param.yml| $0 编辑 c3mc-bpm-optionx/perl cat param.yml| $0 编辑 c3mc-bpm-protect/perl $0 --eventname google-vm-recycle vuuid1 vuuid2 vuuid3 # bpmuuid in ENV{C3BPMUUID} $0 --eventname google-vm-recycle --bpmuuid xxx vuuid1 vuuid2 vuuid3 编辑 c3mc-bpm-statistics/perl $0 --start 2023-07-01 --end 2023-08-01 编辑 c3mc-bpm-user-record/perl $0 user1 user2 user3 # bpmuuid in ENV{C3BPMUUID} $0 --bpmuuid xxx user1 user2 user3 编辑 c3mc-bpm-display-field-values/python3 编辑 c3mc-bpm-read-config-file/python3 编辑 c3mc-get-account-info/python3 编辑 c3mc-yes-and-no/python3 编辑 c3mc-aws-list-s3-bucket-names/python3 编辑 c3mc-bpm-get-aws-name-tag-list/python3 编辑 c3mc-bpm-get-department-tag-list/python3 编辑 c3mc-bpm-get-product-tag-list/python3 编辑 c3mc-bpm-get-project-tag-list/python3 编辑 c3mc-bpm-get-tree-tag-list/python3 编辑 c3mc-bpm-option-google-compute-list-regions/python3 编辑 c3mc-bpm-option-google-compute-list-region-zones/python3 编辑 c3mc-bpm-option-server-auth-check-audit-ip/python3 编辑 c3mc-bpm-option-server-auth-check-if-all-test-ips/python3 编辑 c3mc-bpm-option-server-auth-check-if-no-test-ips/python3 编辑 c3mc-bpm-option-server-auth-check-if-params-valid/python3 编辑 c3mc-bpm-optionx-opapprover/bash 编辑 c3mc-display-business-node-list/python3 编辑 c3mc-display-cloud-account-list/python3 编辑 c3mc-ec2-describe-instance-types/python3 编辑 c3mc-ec2-describe-regions/python3 编辑 c3mc-qcloud-cvm-describe-projects/python3 编辑 c3mc-qcloud-cvm-describe-regions/python3 编辑 c3mc-qcloud-cvm-describe-subnets/python3 编辑 c3mc-qcloud-cvm-describe-vpcs/python3 编辑 c3mc-qcloud-cvm-describe-zones/python3 编辑 c3mc-qcloud-health-check-http-code/python3 编辑 c3mc-bash-help/bash bash脚本统一添加帮助 请在您的bash脚本的头部添加类似如下信息 ============================================================ ### ### 脚本描述 ### ### Usage: ### ### $0 ### ### Options: ### -h 获取帮助信息 . /usr/bin/c3mc-bash-help || exit 1 ============================================================ 编辑 c3mc-install/bash 编辑 c3mc-job-dump/perl $0 --treeid id --jobname name 编辑 c3mc-job-load/perl $0 --treeid id --jobname name 编辑 c3mc-sys-backup/bash 编辑 c3mc-sys-ctl/perl $0 # dump $0 datakey 编辑 c3mc-sys-dup/perl $0 version #default v2.5.12 编辑 c3mc-sys-sup/bash 编辑 c3mc-cloud-aliyun-ecs-by-id/python3 编辑 c3mc-cloud-aws-ec2-by-id/python3 编辑 c3mc-cloud-aws-elb-by-name/python3 编辑 c3mc-cloud-account/perl $0 --plugin c3mc-cloud-huawei-rds --account huawei $0 --plugin c3mc-cloud-huawei-rds --account huawei --raw # use account line $0 --plugin c3mc-cloud-huawei-rds --account huawei --aksk $0 --plugin c3mc-cloud-huawei-rds --account huawei --cloudaccount huawei-acount-name-001 编辑 c3mc-cloud-account-list/perl $0 --type huawei-rds 编辑 c3mc-cloud-attach-department-info/python3 编辑 c3mc-cloud-control/perl $0 --uuid uuid $0 --uuid uuid --ctrl tag_add $0 --uuid uuid --ctrl tag_add --file /your/contrl/conf.yml $0 --uuid uuid --ctrl tag_add argv1 argv2 ... argvn $0 --type xx --subtype xx --uuid uuid --ctrl tag_add argv1 argv2 ... argvn 编辑 c3mc-cloud-keep-fields/python3 编辑 c3mc-cloud-tag-v2/python3 编辑 c3mc-cloud-control-add/perl echo data| $0 --file /debug/control/file.yml 编辑 c3mc-cloud-control-demo/perl $0 编辑 c3mc-cloud-control-list-supported-types-for-tagging/python3 编辑 c3mc-cloud-openstack-host/python3 编辑 c3mc-cloud-ucloud-disk/python3 编辑 c3mc-cloud-ucloud-eip/python3 编辑 c3mc-cloud-ucloud-host/python3 编辑 c3mc-cloud-ucloud-mysql/python3 编辑 c3mc-cloud-ucloud-s3/python3 编辑 c3mc-cloud-ucloud-vpn/python3 编辑 c3mc-cloud-huawei-elb-by-id/python3 编辑 c3mc-query-aws-rds-instance-type-info/python3 编辑 c3mc-price-fetch/python3 编辑 c3mc-price-load/python3 编辑 c3mc-query-aws-ebs-price/python3 编辑 c3mc-query-aws-ec2-price/python3 编辑 c3mc-query-aws-rds-price/python3 编辑 c3mc-query-aws-redis-price/python3 编辑 c3mc-query-huawei-ecs-price/python3 编辑 c3mc-query-huawei-rds-price/python3 编辑 c3mc-query-huawei-redis-price/python3 编辑 c3mc-query-qcloud-cbs-price/python3 编辑 c3mc-query-qcloud-cdb-price/python3 编辑 c3mc-query-qcloud-cvm-price/python3 编辑 c3mc-query-qcloud-mongodb-price/python3 编辑 c3mc-query-qcloud-redis-price/python3 编辑 c3mc-cloud-qcloud-clb-by-name/python3 编辑 c3mc-cloud-qcloud-get-cvm/python3 编辑 c3mc-cloud-aliyun-ecs/python3 编辑 c3mc-cloud-aliyun-ecs-volume/python3 编辑 c3mc-cloud-aliyun-fs/python3 编辑 c3mc-cloud-aliyun-oss/python3 编辑 c3mc-cloud-aliyun-rds/python3 编辑 c3mc-cloud-aliyun-redis/python3 编辑 c3mc-cloud-aliyun-slb/python3 编辑 c3mc-cloud-aliyun-vpc/python3 编辑 c3mc-cloud-aws-alb/python3 编辑 c3mc-cloud-aws-dynamodb/python3 编辑 c3mc-cloud-aws-ec2/python3 编辑 c3mc-cloud-aws-ec2-event/python3 编辑 c3mc-cloud-aws-ec2-volume/python3 编辑 c3mc-cloud-aws-eip/python3 编辑 c3mc-cloud-aws-elb/python3 编辑 c3mc-cloud-aws-globalaccelerator/python3 编辑 c3mc-cloud-aws-hosts/python3 编辑 c3mc-cloud-aws-kafka/python3 编辑 c3mc-cloud-aws-lightsail-database/python3 编辑 c3mc-cloud-aws-lightsail-instance/python3 编辑 c3mc-cloud-aws-lightsail-loadbalancer/python3 编辑 c3mc-cloud-aws-memcached/python3 编辑 c3mc-cloud-aws-memorydb/python3 编辑 c3mc-cloud-aws-memorydb-node/python3 编辑 c3mc-cloud-aws-nlb/python3 编辑 c3mc-cloud-aws-rds/python3 编辑 c3mc-cloud-aws-rds-cluster/python3 编辑 c3mc-cloud-aws-rds-snapshot/python3 编辑 c3mc-cloud-aws-redis/python3 编辑 c3mc-cloud-aws-s3/python3 编辑 c3mc-cloud-aws-subdomain/python3 编辑 c3mc-cloud-google-lb/python3 编辑 c3mc-cloud-google-rds/python3 编辑 c3mc-cloud-google-redis/python3 编辑 c3mc-cloud-google-vm/python3 编辑 c3mc-cloud-google-vm-volume/python3 编辑 c3mc-cloud-huawei-dds/python3 编辑 c3mc-cloud-huawei-dns/python3 编辑 c3mc-cloud-huawei-ecs/python3 编辑 c3mc-cloud-huawei-ecs-volume/python3 编辑 c3mc-cloud-huawei-eip/python3 编辑 c3mc-cloud-huawei-elb/python3 编辑 c3mc-cloud-huawei-kafka/python3 编辑 c3mc-cloud-huawei-nosql/python3 编辑 c3mc-cloud-huawei-obs/python3 编辑 c3mc-cloud-huawei-rds/python3 编辑 c3mc-cloud-huawei-redis/python3 编辑 c3mc-cloud-huawei-sfs-turbo/python3 编辑 c3mc-cloud-ibm-bare-metal-server/python3 编辑 c3mc-cloud-ibm-virtual-server/python3 编辑 c3mc-cloud-k8s-pod/perl $0 id;name id2;name2 编辑 c3mc-cloud-k8s-service/perl $0 id;name id2;name2 编辑 c3mc-cloud-ksyun-epc/python3 编辑 c3mc-cloud-ksyun-kec/python3 编辑 c3mc-cloud-ksyun-kec-volume/python3 编辑 c3mc-cloud-ksyun-krds/python3 编辑 c3mc-cloud-ksyun-ks3/python3 编辑 c3mc-cloud-ksyun-redis/python3 编辑 c3mc-cloud-ksyun-slb/python3 编辑 c3mc-cloud-qcloud-cdb/python3 编辑 c3mc-cloud-qcloud-cfs/python3 编辑 c3mc-cloud-qcloud-ckafka/python3 编辑 c3mc-cloud-qcloud-clb/python3 编辑 c3mc-cloud-qcloud-cos/python3 编辑 c3mc-cloud-qcloud-cvm/python3 编辑 c3mc-cloud-qcloud-cvm-volume/python3 编辑 c3mc-cloud-qcloud-es/python3 编辑 c3mc-cloud-qcloud-mongodb/python3 编辑 c3mc-cloud-qcloud-postgres/python3 编辑 c3mc-cloud-qcloud-redis/python3 编辑 c3mc-cloud-qcloud-sqlserver/python3 编辑 c3mc-cloud-qcloud-subdomain/python3 编辑 c3mc-cloud-qcloud-subnet/python3 编辑 c3mc-cloud-qcloud-tdsql-c-mysql/python3 编辑 c3mc-cloud-qcloud-vpc/python3 编辑 c3mc-cloud-aliyun-region-list/python3 编辑 c3mc-cloud-aws-region-list/python3 编辑 c3mc-cloud-gen-md5-for-account/python3 编辑 c3mc-cloud-get-account-by-md5/python3 编辑 c3mc-cloud-get-resource-type-list/python3 编辑 c3mc-cloud-google-region-list/python3 编辑 c3mc-cloud-huawei-region-list/python3 编辑 c3mc-cloud-ksyun-region-list/python3 编辑 c3mc-cloud-qcloud-region-list/python3 编辑 c3mc-cloud-update-cloud-account/python3 编辑 c3mc-cloud-convert-array-to-obj/python3 编辑 c3mc-cloud-convert-obj-to-array/python3 编辑 c3mc-cloud-get-real-field/python3 编辑 c3mc-device-accountdb-dump/bash 编辑 c3mc-device-accountdb-dump-google/perl $0 编辑 c3mc-device-account-ext/python3 编辑 c3mc-device-account-proxy/perl $0 编辑 c3mc-device-account-proxyd/bash 编辑 c3mc-device-account-uuid/python3 编辑 c3mc-device-api-jumpserver/perl $0 --uuid x --uuids x --ip x --ips x $0 --cache $0 --json 编辑 c3mc-device-base-info/perl $0 编辑 c3mc-device-base-info-cache/perl $0 ctrl timemachine 编辑 c3mc-device-bind-info/perl $0 timemachine 编辑 c3mc-device-bind-info-cache/perl $0 ctrl timemachine 编辑 c3mc-device-cat/perl $0 time|curr type subtype $0 time|curr type subtype grepuuid 编辑 c3mc-device-cat-all/perl $0 $0 grepuuid $0 --col uuid,treename $0 --timemachine time 编辑 c3mc-device-cat-all-cache/perl $0 ctrl $0 ctrl --timemachine curr 编辑 c3mc-device-cat-all-cache-newremarks/perl $0 ctrl $0 ctrl --timemachine curr 编辑 c3mc-device-data-get/perl $0 $0 time|curr type subtype col1 ... coln 编辑 c3mc-device-data-get-csv/perl $0 $0 time|curr type subtype col1 ... coln 编辑 c3mc-device-dump-bind/perl $0 编辑 c3mc-device-dump-tree/perl $0 编辑 c3mc-device-dump-treeinfo/perl $0 编辑 c3mc-device-find-hostname/perl 编辑 c3mc-device-find-instancetype/perl 编辑 c3mc-device-find-name/perl 编辑 c3mc-device-find-opsowner/perl 编辑 c3mc-device-find-owner/perl 编辑 c3mc-device-find-tree/perl 编辑 c3mc-device-find-uuid/perl $0 $0 grepuuid $0 --timemachine time 编辑 c3mc-device-find-v2-alias/perl 编辑 c3mc-device-find-v2-opsowner/perl 编辑 c3mc-device-find-v2-owner/perl 编辑 c3mc-device-find-v2-status/perl 编辑 c3mc-device-find-v2-systeminfo/perl 编辑 c3mc-device-find-v2-tree/perl 编辑 c3mc-device-find-v3-alias/perl 编辑 c3mc-device-find-v3-os/perl 编辑 c3mc-device-ingestion-jumpserver/perl $0 编辑 c3mc-device-ingestion-mongodb/perl $0 treeid1 treeid2 .. treeidn [ --col addr,auth [id|addr|auth|type|projectid] ] 编辑 c3mc-device-ingestion-mongodb-search/perl $0 [ --col uuid,type,addr,auth [uuid|type|addr|auth] ] $0 --uuid uuid $0 --addr addr 编辑 c3mc-device-ingestion-mysql/perl $0 treeid1 treeid2 .. treeidn [ --col addr,auth [id|addr|auth|type|projectid] ] 编辑 c3mc-device-ingestion-mysql-search/perl $0 [ --col uuid,type,addr,auth [uuid|type|addr|auth] ] $0 --uuid uuid $0 --addr addr 编辑 c3mc-device-ingestion-redis/perl $0 treeid1 treeid2 .. treeidn [ --col addr,auth [id|addr|auth|type|projectid] ] 编辑 c3mc-device-ingestion-redis-search/perl $0 [ --col uuid,type,addr,auth [uuid|type|addr|auth] ] $0 --uuid uuid $0 --addr addr 编辑 c3mc-device-ingestion-safetytesting/perl $0 编辑 c3mc-device-load/bash 编辑 c3mc-device-load-extcol/perl 把数据导入到CMDB的扩展字段中。 有如下两种方式: 1.包含详细资源类型 $0 echo 'database;qcloud-cdb;cdb-flib88fj;remarks;sms' | ./$0 2.没有具体类型，只有uuid，脚本会在CMDB中查询资源的类型,补充成第一种情况后导入。 $0 echo 'cdb-flib88fj;remarks;sms' | ./$0 编辑 c3mc-device-loadpasswd-auth/perl $0 echo 'f28cfb10-93e8-4d1d-919c-cb8012ac;root/123456' | ./$0 编辑 c3mc-device-loadpasswd-auth-v2/python3 编辑 c3mc-device-loadpasswd-mongodb/perl $0 echo '10.10.10.10:27017;root;123456' | ./$0 编辑 c3mc-device-loadpasswd-mongodb-v2/perl $0 echo '10.10.10.10:27017;root;123456' | ./$0 编辑 c3mc-device-loadpasswd-mysql/perl $0 echo '10.10.10.10:3306;root;123456' | ./$0 编辑 c3mc-device-loadpasswd-mysql-v2/perl $0 echo '10.10.10.10:3306;root;123456' | ./$0 编辑 c3mc-device-loadpasswd-redis/perl $0 echo '10.10.10.10:6379;123456' | ./$0 编辑 c3mc-device-loadpasswd-redis-v2/perl $0 echo '10.10.10.10:6379;123456' | ./$0 编辑 c3mc-device-menu/perl $0 treeid timemachine 编辑 c3mc-device-menu-by-baseinfo/perl $0 treeid timemachine colid colval 编辑 c3mc-device-metrics/perl $0 编辑 c3mc-device-monitorbyexip/perl $0 $0 exipdump 编辑 c3mc-device-nodeinfo/perl $0 col1 col2 .. col2 [ --col name,inip [id|name|type|inip|exip|projectid] ] 编辑 c3mc-device-nodeinfo-allnode/perl $0 col1 col2 .. col2 [ --col name,inip [name|type|inip|exip] ] 编辑 c3mc-device-nodeinfo-allnode-cache/perl $0 ctrl timemachine 编辑 c3mc-device-nodeuuid/perl $0 编辑 c3mc-device-save-tree/bash 编辑 c3mc-device-timemachine/perl $0 编辑 c3mc-device-treeinfo/perl $0 type subtype 编辑 c3mc-device-unused-tree/perl $0 编辑 c3mc-device-fee/perl $0 --tree open-c3.ops --date 2024-05 $0 --uuid 1eb3bbdf-a5f6-42ce-bdde-9e9afbe1d311 --date 2024-05 $0 --tree open-c3.ops --date 2024-05 --exclude 编辑 c3mc-code-tree/perl $0 编辑 c3mc-dtool-apidoc-make/perl $0 grep 编辑 c3mc-dtool-apidoc-make-onece/perl $0 /api/file.pm 编辑 c3mc-dtool-apidoc-make-sort/bash 编辑 c3mc-dtool-audit-check/bash 编辑 c3mc-dtool-audit-check-onece/perl $0 /api/file.pm 编辑 c3mc-dtool-c3mcdoc-make/bash 生成c3mc所有工具的帮助文档 Usage: $0 Options: -h 获取帮助信息 编辑 c3mc-dtool-c3mcdoc-make-onece/perl 生成c3mc工具的帮助文档，处理单个文件 $0 /dir/c3mc-xxx 编辑 c3mc-dtool-todo-make/bash 生成c3 todo文档 Usage: $0 Options: -h 获取帮助信息 编辑 c3mc-dtool-todo-make-onece/perl 生成C3 TODO的帮助文档，处理单个文件 $0 /dir/c3mc-xxx 编辑 c3mc-base-exctl-copy-image/perl $0 --id imageid 编辑 c3mc-base-exctl-copy-ticket/perl $0 --id ticketid 编辑 c3mc-base-exctl-dump-image/perl $0 --id ticketid 编辑 c3mc-base-exctl-dump-ticket/perl $0 --id ticketid 编辑 c3mc-base-exctl-load-image/perl $0 --treeid id --flowid id 编辑 c3mc-base-exctl-load-ticket/perl $0 --treeid id --flowid id 编辑 c3mc-flow-exctl-copy/perl $0 --streeid id --sflowid id --dtreeid id 编辑 c3mc-flow-exctl-dump/perl $0 --treeid id --flowid id 编辑 c3mc-flow-exctl-dump-ci/perl $0 --treeid id --flowid id 编辑 c3mc-flow-exctl-dump-job/perl $0 --treeid id --flowid id 编辑 c3mc-flow-exctl-dump-jobv/perl $0 --treeid id --jobuuid uuid 编辑 c3mc-flow-exctl-dump-jobx/perl $0 --treeid id --flowid id 编辑 c3mc-flow-exctl-dump-jobx-grp/perl $0 --treeid id --groupid id 编辑 c3mc-flow-exctl-load/perl $0 --treeid id $0 --treeid id --flowid id # It can be used when CI already exists and CD does not exist 编辑 c3mc-flow-exctl-load-ci/perl $0 --treeid id --flowid id 编辑 c3mc-flow-exctl-load-ci-new/perl $0 --treeid id 编辑 c3mc-flow-exctl-load-job/perl $0 --treeid id --flowid id 编辑 c3mc-flow-exctl-load-jobv/perl $0 --treeid id --flowid id 编辑 c3mc-flow-exctl-load-jobx/perl $0 --treeid id 编辑 c3mc-googleplay-review-reply/perl cat param.yml| $0 编辑 c3mc-k8s-backup/bash 编辑 c3mc-k8s-backup-cron/bash 编辑 c3mc-k8s-backup-once/bash 编辑 c3mc-k8s-kubectl-get/perl $0 -id ticketid 编辑 c3mc-k8s-kubectl-getallresource/bash 编辑 c3mc-k8s-node-taint/perl $0 -id ticketid --node nodename 编辑 c3mc-k8s-nsctl-copy/bash 编辑 c3mc-k8s-nsctl-dump/bash 编辑 c3mc-login/perl $0 $0 --user user1 --pass password.base64 编辑 c3mc-login-ldap/perl $0 --user user1 --pass password.base64 编辑 c3mc-login-mysql/perl $0 --user user1 --pass password.base64 编辑 c3mc-mfa/perl $0 $0 --user user1 --code 123456 编辑 c3mc-mfa-google/perl $0 --user user1 --code 123456 编辑 c3mc-mfa-google-code/perl $0 --secret xt37ss4kjo3z4ipv 编辑 c3mc-mfa-google-make/perl $0 --user user1 $0 --user user1 --domain www.xx.com 编辑 c3mc-agent-authrotate-add/perl $0 编辑 c3mc-agent-authrotate-clear/perl $0 编辑 c3mc-agent-authrotate-data/perl $0 编辑 c3mc-agent-authrotate-del/perl $0 编辑 c3mc-agent-authrotate-make-key/perl $0 编辑 c3mc-agent-inherit/perl 编辑 c3mc-agent-network-check/perl $0 编辑 c3mc-agent-network-check-flow/perl 编辑 c3mc-agent-network-check-once/perl 编辑 c3mc-server-agent/perl $0 servername 编辑 c3mc-mai-bedrock/python3 编辑 c3mc-branch-list/perl $id 编辑 c3mc-branch-make-tags/perl $id $branch 编辑 c3mc-branch-uuid/perl $id $branch 编辑 c3mc-ci-branch-ls/perl echo 'project yaml' | $0 编辑 c3mc-ci-branch-ls-git/perl echo 'project yaml' | $0 编辑 c3mc-ci-bury/perl $0 编辑 c3mc-ci-cislave-task-grep/perl $0 id1 id2 ... idn 编辑 c3mc-ci-flowreport/perl $0 $0 number # n day ago 编辑 c3mc-ci-flowreport-cireport/perl $0 [--since '2022-03-24 00:00:00'] [--until '2022-03-24 23:59:59' ] 编辑 c3mc-ci-flowreport-jobxreport/perl $0 [--since '2022-03-24 00:00:00'] [--until '2022-03-24 23:59:59' ] 编辑 c3mc-ci-gitreport/perl 编辑 c3mc-ci-gitreport-cron/bash 编辑 c3mc-ci-gitreport-once/perl 编辑 c3mc-ci-gitreport-statistics/perl $0 [--path /path/foo ] $0 [--date 2022-03-24] [--path /path/foo ] 编辑 c3mc-ci-gitreport-sync/perl $0 flowid flowid2 .. flowidn $0 flowid .. [--path /path/foo ] 编辑 c3mc-ci-project-show/perl $0 id1 id2 ... idn 编辑 c3mc-ci-show-target/perl $flowid 编辑 c3mc-ci-status-up/perl $0 projectid version 编辑 c3mc-ci-tag-grep/perl $0 id;tagname id2;tagname2 .. idn;tagnamen 编辑 c3mc-ci-tag-ls/perl echo 'project yaml' | $0 编辑 c3mc-ci-tag-ls-git/perl echo 'project yaml' | $0 编辑 c3mc-ci-tag-ls-harbor/perl echo 'project yaml' | $0 编辑 c3mc-ci-tag-ls-svn/perl echo 'project yaml' | $0 编辑 c3mc-ci-tag-save/perl $0 projectid version 编辑 c3mc-docker-buildandsave/perl $0 dockerfile imageid 编辑 c3mc-docker-save/perl $0 image imageid 编辑 c3mc-jobx-task-run-to-master/perl $0 projectid name group --user user --variablekv 'foo=123,bar=567' 编辑 c3mc-jobx-task-stat-to-master/perl $0 uuid 编辑 c3mc-server-ci/perl $0 servername 编辑 c3mc-tags-list/perl $id 编辑 c3mc-tags-make-tags/perl $id $branch 编辑 c3mc-ci-code-merge/perl $flowid srcbranch dstbranch 编辑 c3mc-aws-ecs-describe/perl $0 -id ticketid --region xxx --cluster xxx --services xxx 编辑 c3mc-flow-feedback/perl $0 --uuid id 编辑 c3mc-flow-nsctl-copy/perl $0 --treeid id --srcns srcNamespace --dstns dstNamespace $0 --treeid id --srcns srcNamespace --dstns dstNamespace --dsttreeid treeid 编辑 c3mc-flow-nsctl-copy-job/perl $0 --treeid id --srcid id --dstid id $0 --treeid id --srcid id --dstid id --dsttreeid treeid 编辑 c3mc-flow-nsctl-copy-jobx/perl $0 --treeid id --srcid id --dstid id --env [online | test] $0 --treeid id --srcid id --dstid id --env [online | test] --dsttreeid treeid 编辑 c3mc-flow-nsctl-delete/perl $0 --treeid id --dstns dstNamespace 编辑 c3mc-flow-taskinfo/perl $0 --uuid taskuuid 编辑 c3mc-job-approval-create/perl $0 --id id 编辑 c3mc-job-approval-query/perl $0 --id id 编辑 c3mc-job-approval-sync/perl $0 --id id 编辑 c3mc-job-environment/perl $0 编辑 c3mc-job-slave-random/perl $0 编辑 c3mc-job-task-run/perl $0 projectid name $0 projectid name --uuid $0 projectid name --user user --slave slave1 --calltype calltype --variable variablebase64 $0 projectid name --user user --slave slave1 --calltype calltype --variablekv 'foo=123,bar=567' 编辑 c3mc-job-task-stat/perl $0 uuid1 uuid2 ... uuidn 编辑 c3mc-server-job/perl $0 servername 编辑 c3mc-jobx-slave-random/perl $0 编辑 c3mc-jobx-task-info-bysubuuid/perl $0 uuid 编辑 c3mc-jobx-task-run/perl $0 projectid name group $0 projectid name group --user user --slave slave1 --calltype calltype --variable variablebase64 $0 projectid name group --user user --slave slave1 --calltype calltype --variablekv 'foo=123,bar=567' 编辑 c3mc-jobx-task-stat/perl $0 uuid1 uuid2 ... uuidn 编辑 c3mc-server-jobx/perl $0 servername 编辑 c3mc-app-mon-proxy-show/perl $0 编辑 c3mc-cloudmon-make-promesd/perl $0 编辑 c3mc-cloudmon-make-task/perl $0 编辑 c3mc-mon-alarm-group-load/perl $0 'groupname;user1,user2..usern;remark' $0 'groupname;user1,user2..usern;remark' --user foo@xx.com echo 'groupname;user1,user2..usern;remark' | ./$0 --user foo@xx.com 编辑 c3mc-mon-alertmanager-silence/perl $0 --user open-c3/email labels1=123 label2=foo labels3=bar $0 --user open-c3/email --comment byc3labels1=123 label2=foo labels3=bar 编辑 c3mc-mon-avg-cpu/perl $0 --node 10.10.10.1 --date 2022-07-06 编辑 c3mc-mon-avg-mem/perl $0 --node 10.10.10.1 --date 2022-07-06 编辑 c3mc-mon-carry/perl $0 $0 --output /path/foo,yaml 编辑 c3mc-mon-carry-mongodb/perl $0 $0 --output /path/foo,yaml 编辑 c3mc-mon-carry-mysql/perl $0 $0 --output /path/foo,yaml 编辑 c3mc-mon-carry-redis/perl $0 $0 --output /path/foo,yaml 编辑 c3mc-mon-collector-dump/perl $0 --treeid id 编辑 c3mc-mon-collector-load/perl $0 --treeid id $0 --treeid id --user foo@xx.com 编辑 c3mc-mon-instancealias/perl $0 ip 编辑 c3mc-mon-mailmon-addcont/perl $0 编辑 c3mc-mon-mailmon-adduser/perl $0 编辑 c3mc-mon-mailmon-format/perl $0 编辑 c3mc-mon-mailmon-record/perl $0 编辑 c3mc-mon-mailmon-sender/bash 编辑 c3mc-mon-mailmon-syncer/perl $0 name 编辑 c3mc-mon-make-uexip/perl $0 编辑 c3mc-mon-max-net-in/perl $0 --node 10.10.10.1 --date 2022-07-06 编辑 c3mc-mon-max-net-out/perl $0 --node 10.10.10.1 --date 2022-07-06 编辑 c3mc-mon-mesg-addcont/perl $0 编辑 c3mc-mon-mesg-adduser/perl $0 编辑 c3mc-mon-mesg-caseinfo-record/perl $0 编辑 c3mc-mon-mesg-format/perl $0 编辑 c3mc-mon-mesg-grepvack/perl $0 编辑 c3mc-mon-mesg-merge/perl $0 编辑 c3mc-mon-mongodbsd-format/perl $0 $0 --output /path/foo.yaml 编辑 c3mc-mon-mongodb-v3-exportercheck/perl $0 编辑 c3mc-mon-mongodb-v3-exporterclean/perl $0 编辑 c3mc-mon-mongodb-v3-exportermaker/perl $0 编辑 c3mc-mon-monreport/perl 编辑 c3mc-mon-monreport-cron/bash 编辑 c3mc-mon-monreport-make/perl 编辑 c3mc-mon-mysql-exporterclean/perl $0 编辑 c3mc-mon-mysql-exportermaker/perl $0 编辑 c3mc-mon-mysql-sdformat/perl $0 $0 --output /path/foo.yaml 编辑 c3mc-mon-mysqlsd-format/perl $0 $0 --output /path/foo.yaml 编辑 c3mc-mon-mysql-v3-exportercheck/perl $0 编辑 c3mc-mon-mysql-v3-exporterclean/perl $0 编辑 c3mc-mon-mysql-v3-exportermaker/perl $0 编辑 c3mc-mon-nlow-cron/bash 编辑 c3mc-mon-nlow-data/perl $0 --node 10.10.10.1 --date 2022-07-06 编辑 c3mc-mon-nlow-fill/perl $0 --node 10.10.10.1 编辑 c3mc-mon-nlow-redo/perl $0 编辑 c3mc-mon-nodeextsd-format/perl $0 $0 --output /path/foo.yaml 编辑 c3mc-mon-nodename-get/perl $0 ip 编辑 c3mc-mon-nodesd-format/perl $0 $0 --output /path/foo.yaml 编辑 c3mc-mon-nodetree-get/perl $0 ip 编辑 c3mc-mon-prometheus-alerts-check/perl $0 编辑 c3mc-mon-proxy/perl $0 ip1 ip2 ... ipn $0 ip1 ip2 ... ipn --output /path/foo.yaml 编辑 c3mc-mon-proxy-metrics/perl $0 编辑 c3mc-mon-proxy-metricsd/perl 编辑 c3mc-mon-proxy-port/perl $0 ip1:port ip2:port ... ipn:port $0 ip1:port ip2:port ... ipn:port --output /path/foo.yaml 编辑 c3mc-mon-redis-exporterclean/perl $0 编辑 c3mc-mon-redis-exportermaker/perl $0 编辑 c3mc-mon-redis-sdformat/perl $0 $0 --output /path/foo.yaml 编辑 c3mc-mon-redissd-format/perl $0 $0 --output /path/foo.yaml 编辑 c3mc-mon-redis-v3-exportercheck/perl $0 编辑 c3mc-mon-redis-v3-exporterclean/perl $0 编辑 c3mc-mon-redis-v3-exportermaker/perl $0 编辑 c3mc-mon-rule/perl $0 $0 --output /path/foo,yaml 编辑 c3mc-mon-rule-dump/perl $0 --treeid id 编辑 c3mc-mon-rule-load/perl $0 --treeid id $0 --treeid id --user foo@xx.com 编辑 c3mc-mon-selfhealing-curralter/perl $0 $0 _ #ALL $0 altername1 altername2 .. alternamen $0 'altername1;foo1' 'altername2;foo2' .. alternamen 编辑 c3mc-mon-selfhealing-grepeips/perl $0 编辑 c3mc-mon-selfhealing-maketask/perl $0 echo 10.100.1.1;c125e5438273d8b0;2022-02-20T15:27:12.589Z;根盘/使用百分比大于85%;清理跟路径 |./$0 编辑 c3mc-mon-selfhealing-runtask/perl $0 $0 1;10.60.77.73;清理tmp日志 编辑 c3mc-mon-selfhealing-update/perl $0 $0 --close $0 id;taskuuid id instance fingerprint startsAt alertname 编辑 c3mc-mon-selfhealing-updatetask/perl $0 $0 id;taskuuid 编辑 c3mc-mon-sender/bash 编辑 c3mc-mon-sender-ctrl/perl 监控系统/告警消息操作/临时数据放回管道 从altermanager发送出来的告警信息，通过api接口转换后， 会先存储到目录/data/open-c3-data/monitor-sender 中。 在某些情况下，需要人为介入进行消息管理。 ./$0 --open # 打开临时通道 ./$0 --close # 关闭临时通道 ./$0 --stat # 查看状态 ./$0 --load # 把线上通道的数据加载到临时通道。待发送的消息太多情况下使用 ./$0 --list grep1 grep2 ... # 列出临时通道的消息 ./$0 --recover grep1 grep2 ... # 恢复消息需要携带过滤条件 ./$0 --delete grep1 grep2 ... # 删除消息需要携带过滤条件 注: grep1 grep2 ... 为“与”的关系，都满足才算匹配 编辑 c3mc-mon-treeinfo/perl $0 编辑 c3mc-prometheus-check-expr/perl $0 编辑 c3mc-mon-exalarm/perl $0 编辑 c3mc-mon-exalarm-cron/bash 编辑 c3mc-mon-exmesg-cron/perl $0 编辑 c3mc-mon-exmesg-maker/perl $0 编辑 c3mc-mon-exmesg-maker-cron/bash 编辑 c3mc-mon-exmesg-save/perl $0 编辑 c3mc-mon-aws-alb-avg-active-dump/perl $0 编辑 c3mc-mon-aws-alb-dump/perl $0 编辑 c3mc-mon-aws-alb-last-hostcount-dump/perl $0 编辑 c3mc-mon-aws-ec2-avg-cpu-dump/perl $0 编辑 c3mc-mon-aws-ec2-avg-mem-dump/perl $0 编辑 c3mc-mon-aws-ec2-dump/perl $0 编辑 c3mc-mon-aws-ec2-volume-dev-max-dump/perl $0 编辑 c3mc-mon-aws-ec2-volume-dump/perl $0 编辑 c3mc-mon-aws-elb-avg-active-dump/perl $0 编辑 c3mc-mon-aws-elb-dump/perl $0 编辑 c3mc-mon-aws-elb-last-hostcount-dump/perl $0 编辑 c3mc-mon-aws-nlb-avg-active-dump/perl $0 编辑 c3mc-mon-aws-nlb-dump/perl $0 编辑 c3mc-mon-aws-nlb-last-hostcount-dump/perl $0 编辑 c3mc-mon-aws-rds-avg-cpu-dump/perl $0 编辑 c3mc-mon-aws-rds-avg-disk-dump/perl $0 编辑 c3mc-mon-aws-rds-dump/perl $0 编辑 c3mc-mon-aws-rds-max-cpu-dump/perl $0 编辑 c3mc-mon-aws-rds-max-disk-dump/perl $0 编辑 c3mc-mon-aws-redis-avg-cpu-dump/perl $0 编辑 c3mc-mon-aws-redis-avg-mem-dump/perl $0 编辑 c3mc-mon-aws-redis-dump/perl $0 编辑 c3mc-mon-aws-redis-max-cpu-dump/perl $0 编辑 c3mc-mon-aws-redis-max-mem-dump/perl $0 编辑 c3mc-mon-host-disk-dump/perl $0 编辑 c3mc-mon-host-disk-size-dump/perl $0 编辑 c3mc-mon-host-disk-used-dump/perl $0 编辑 c3mc-mon-huawei-rds-avg-cpu-dump/perl $0 编辑 c3mc-mon-huawei-rds-avg-disk-dump/perl $0 编辑 c3mc-mon-huawei-rds-dump/perl $0 编辑 c3mc-mon-huawei-rds-max-cpu-dump/perl $0 编辑 c3mc-mon-huawei-rds-max-disk-dump/perl $0 编辑 c3mc-mon-huawei-redis-avg-cpu-dump/perl $0 编辑 c3mc-mon-huawei-redis-avg-mem-dump/perl $0 编辑 c3mc-mon-huawei-redis-dump/perl $0 编辑 c3mc-mon-huawei-redis-max-cpu-dump/perl $0 编辑 c3mc-mon-huawei-redis-max-mem-dump/perl $0 编辑 c3mc-mon-qcloud-cdb-avg-cpu-dump/perl $0 编辑 c3mc-mon-qcloud-cdb-avg-disk-dump/perl $0 编辑 c3mc-mon-qcloud-cdb-dump/perl $0 编辑 c3mc-mon-qcloud-cdb-max-cpu-dump/perl $0 编辑 c3mc-mon-qcloud-cdb-max-disk-dump/perl $0 编辑 c3mc-mon-qcloud-redis-avg-cpu-dump/perl $0 编辑 c3mc-mon-qcloud-redis-avg-mem-dump/perl $0 编辑 c3mc-mon-qcloud-redis-dump/perl $0 编辑 c3mc-mon-qcloud-redis-max-cpu-dump/perl $0 编辑 c3mc-mon-qcloud-redis-max-mem-dump/perl $0 编辑 c3mc-mon-serialcall-ctrl/perl $0 --write user1 user2 .. usern $0 --write user1 user2 .. usern --caseuuid xxx.xxx.xxx $0 --clean user1 user2 .. usern $0 --cleancase xxx.xxx.xxx1 xxx.xxx.xxx2 .. xxx.xxx.xxxn 编辑 c3mc-nett-agent/bash 编辑 c3mc-nett-git/perl $0 编辑 c3mc-nett-k8s/perl $0 编辑 c3mc-oncall-cal/perl $0 name [--zone timezone] [--level number] \\ [--year year] [--month month] [--grep regex] [--user name] 编辑 c3mc-oncall-list/perl $0 name [--begin date] [--days number] [--zone timezone] [--level number] 编辑 c3mc-oncall-make/perl $0 [ name ] 编辑 c3mc-oncall-now/perl $0 name --level number 编辑 c3mc-oncall-zone/perl $0 [--time] [--link] [date time zone] 编辑 c3mc-base-send/perl $0 编辑 c3mc-base-sendcall/perl $0 user1 user2 ... user3 编辑 c3mc-base-sendmail/perl $0 user1 user2 ... user3 --subject test 编辑 c3mc-base-sendmail-smtp/perl $0 user1 user2 user3 --subject test 编辑 c3mc-base-sendmesg/perl $0 user1 user2 ... user3 编辑 c3mc-base-sendmesg-dingding/perl $0 user1 user2 ... user3 编辑 c3mc-base-sendmesg-dingding-bot/perl $0 user1 user2 ... user3 编辑 c3mc-base-sendmesg-feishu/python3 编辑 c3mc-base-sendmesg-feishu-bot/perl $0 user1 user2 ... user3 编辑 c3mc-base-sendmesg-lark/python3 编辑 c3mc-base-map2tree/perl echo treemap | $0 编辑 c3mc-spotx-addlabel/perl 编辑 c3mc-spotx-affinity-add/perl 编辑 c3mc-spotx-affinity-check/perl 编辑 c3mc-spotx-affinity-del/perl 编辑 c3mc-spotx-affinity-newconf-json/perl 编辑 c3mc-spotx-affinity-newconf-yaml/bash 编辑 c3mc-spotx-affinity-oldconf-yaml/perl 编辑 c3mc-spotx-affinity-recconf-json/perl 编辑 c3mc-spotx-affinity-recconf-yaml/bash 编辑 c3mc-spotx-affinity-show/perl 编辑 c3mc-spotx-affinity-todo/bash 编辑 c3mc-spotx-clearlabel/perl 编辑 c3mc-spotx-dellabel-large/perl 编辑 c3mc-spotx-dellabel-small/perl 编辑 c3mc-spotx-run/perl 编辑 c3mc-spotx-show/perl 编辑 c3mc-spotx-util-deployment/perl 编辑 c3mc-spotx-util-node-clear/perl 编辑 c3mc-spotx-util-node-free/perl 编辑 c3mc-spotx-util-node-res/perl 编辑 c3mc-spotx-util-node-role/perl 编辑 c3mc-spotx-util-pods/perl 编辑 c3mc-statistics-tree-resource/python3 编辑 c3mc-create-ticket/python3 编辑 c3mc-upload-attach-for-ticket/python3 编辑 c3mc-wait-ticket-status-change/python3 编辑 Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/Installer/C3/pkg/":{"url":"open-c3-code/Installer/C3/pkg/","title":" C3的pkg打包说明 ","keywords":"","body":"C3的pkg打包说明 自动处理 # 系统升级后，可以进行自动打包处理，添加定时任务，定时的进行构建 # 系统会识别哪个模块需要构建 */3 * * * * flock -n /var/c3autopkg.lock /data/open-c3/Installer/C3/pkg/autopkg.sh > /tmp/autopkg.log 2> /tmp/autopkg.err 手动处理 全量构建 #对所有模块打包, 模块的范围在文件 \"module\"中有描述。 ./build.sh 版本号 #例: 对所有模块打包，版本为2301101 ./build.sh 2301101 单个构建 #对单个模块进行构建. ./build-module.sh 模块名 版本号 #例: 对perl模块进行构建，构建版本为2301101 ./build-module.sh perl 2301101 上传 ./upload.sh #上传脚本会把“module”中已经构建的模块都进行上传，上传后自动做了git commit。 #查看没问题后手动 git push 即可。 #注：上传脚本只会处理有重新构建过的模块，未被重新构建的模块不进行处理。 提取 #提取所有pkg中的文件，该命令在OpenC3安装和更新的时候都会自动调用。 ./extract.sh Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/docs/lotus.html":{"url":"open-c3-code/docs/lotus.html","title":" C3镜像 ","keywords":"","body":"C3镜像 在应用超市中，我们提供C3的镜像。 下面我们通过lotus来解决不同实例中key和uuid重复使用的问题。 我们安装镜像的过程是这样的，在一个机器上安装完C3服务。然后把这个机器做成一个镜像。 但是这样会有一个问题，每个用这个镜像创建出来的C3服务，里面的key和uuid都是一样的，这个是不安全的。 所以在我们打镜像之前，在机器上touch一个文件/data/open-c3-data/lotus/ooze 服务在启动过程中会检查这个文件，如果有这个文件，会重新生成key和uuid。 执行成功后会自动删除/data/open-c3-data/lotus/ooze文件，避免下次启动的时候再次替换。 TODO ` C3TODO 230406 体验版的lotus/ooze问题需要处理 体验版也要做lotus/ooze的判断 Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/CI/cislave/conf/":{"url":"open-c3-code/CI/cislave/conf/","title":" CI/cislave说明 ","keywords":"","body":"CI/cislave说明 说明 如果CI构建的时候，需要支持多个区域的CI slave。 可以根据下面的说明进行cislave配置。 slave上操作(重要,需要先操作) 在slave中配置如下文件，用于标识本slave是哪个ip。slave会根据这个信息获取要执行的任务列表。 如果没有对应标识，会被认为是master，会执行master的任务，所有这里一定要安装好slave首先要完成的操作。 cat myname 10.x.x.103 安装agent 在slave上安装master的发布agent。 master会通过agent给cislave推送数据。 修改cislave的登录，保持master和slave是一样的登录方式。修改如下部分. #ssousername: 'http://api.connector.open-c3.org/internal/user/username?cookie=' #ssologoutapi: 'http://api.connector.open-c3.org/default/user/logout?sid=' #ssocallback: '/#/login?callback=' #cookiekey: sid #ssochpasswd: '/#/connector/chpasswd' ssocallback: http://sso.cmcloud.org/login?callback= ssochpasswd: http://sso.cmcloud.org ssologoutapi: http://10.x.x.x:1808/v2/user/logout/ ssousername: http://10.x.x.x:1808/v2/user/userinfo/ cookiekey: u master上操作 在master机器上配置slave列表文件，用于标识可用的slave列表。c3集群本身用master进行标识。 其中里面的alias字段不是必须的，不配置的情况下和host等同。 # cat slave.yml - host: 10.60.77.103 alias: cislave.c3.x.org 在master上配置master信息文件，slave的ci构建结束后可能会触发cd，所以这里需要配置master的信息。 #cat master.yml addr: http://10.x.x.73 env: appname: jobx appkey: xxx master上会把信息sync给所有的slave，信息包括上面的配置文件和数据库中的相关数据。 Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/docs/ci-dns.html":{"url":"open-c3-code/docs/ci-dns.html","title":" CI/流水线构建过程使用自建DNS ","keywords":"","body":"CI/流水线构建过程使用自建DNS 使用场景 在实际使用中可能会遇到这样的情况，流水线通过docker容器构建项目的时候，会遇到dns解析错误的情况。 举个例子： 2025年1月8号 Open-C3所在区域的\"goproxy.cn\" 域名解析到了\"163.181.140.200\" 上，导致下载依赖文件失败。 在办公网解析goproxy.cn，指向的是106.60.64.105。办公网上是能正常下载依赖的。 这样就需要把Open-C3上的构建环境，把goproxy.cn指向106.60.64.105。 使用方式 # 1.在Open-C3上启动DNS服务。 docker run -d --name dns --restart=always --publish 53:53/udp andyshinn/dnsmasq # 2. 配置 DNS 服务器的域名解析规则。进入容器并编辑 /etc/dnsmasq.conf。 docker exec -it dns sh echo \"address=/goproxy.cn/106.60.64.105\" >> /etc/dnsmasq.conf kill -HUP $(cat /var/run/dnsmasq.pid) #如果kill -HUP $(cat /var/run/dnsmasq.pid)不生效可以重启一下容器 # Open-C3在检查到Open-C3的机器上有dns容器运行，在构建的时候会自动通过\"docker run --dns= ...\"来指定新的dns地址 # 注: Open-C3在对流水线中的项目进行构建的时候，每个流水线都会保留容器，避免下次构建的时候重新拉取依赖(为了减少网络流量和加快构建速度)。 # 建议尽早启动dns容器，这样需要解析域名的时候就可以方便的指定。 # 在没有dns容器的情况下启动了dns、或者在有dns的情况下想停止dns。都会影响已经生成的容器。如果需要做这样的切换，需要把旧容器删除。 # 比如流水线编号是 123, 可以在c3的机器上执行 docker ps -a|grep 123 看到这个流水线的容器。 Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/AGENT/device/conf/account.html":{"url":"open-c3-code/AGENT/device/conf/account.html","title":" CMDB/云账号导入 ","keywords":"","body":"CMDB/云账号导入 标准配置如下 阿里云 账号(或者别名, 这个信息将会在资源详情中展示) ak sk 区域编码(比如 cn-beijing) Aws 账号(或者别名, 这个信息将会在资源详情中展示) ak sk 区域编码(比如 us-east-1) 谷歌云 账号(或者别名, 这个信息将会在资源详情中展示) /absolute/path/to/credentials.json(该文件是从谷歌云导出的json格式的凭证文件) 区域编码(比如 europe-west4) 华为云 账号(或者别名, 这个信息将会在资源详情中展示) ak sk 项目ID 区域编码(比如 cn-east-2) iam_user_id(华为云iam用户id,询价的时候要用) 金山云 账号(或者别名, 这个信息将会在资源详情中展示) ak sk 区域编码(比如 cn-beijing-6) 腾讯云 账号(或者别名, 这个信息将会在资源详情中展示) ak sk 区域编码(比如 ap-hongkong) cloud_account_id(腾讯云主账号, 在腾讯云控制台的位置：账号中心 -> 账号信息 -> 账号权限 -> 所属主账号) IBM 账号(或者别名, 这个信息将会在资源详情中展示) username api_key vpc_name(可选) Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/AGENT/device/bin/protect.html":{"url":"open-c3-code/AGENT/device/bin/protect.html","title":" CMDB同步保护 ","keywords":"","body":"CMDB同步保护 使用说明 在极端情况下，可能由于程序出现bug，或者账号被误操作删除等原因。 会导致CMDB中的资源明显变少甚至变成0。 这时候可以通过cmdb中的protect程序进行控制。 这样确保资源数量在指定数量内才能同步到CMDB中。 比如执行 ./protect 80 , 这样资源的数量必须是当前数量的80%的情况下才允许本次同步是生效的。 protect中的比例是当protect程序执行当前的数量，这个数量不会实时改变。 比如当前aws-ec2是100台，执行 ./protect 80 后，以后同步的aws-ec2必须大于80台，否则同步不生效。 如果想重新调整数量，需要重新执行 ./protect 程序。 Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/Connector/pp/cloud/extend-sync/":{"url":"open-c3-code/Connector/pp/cloud/extend-sync/","title":" CMDB/扩展同步 ","keywords":"","body":"CMDB/扩展同步 用途 在那些我们需要快速同步的资源，那些资源可能没有那么流行或者不是很完善，我们可以临时加到扩展同步中，先临时同步使用，在后续使用量变大了在逐步完善。 openstack 支持同步openstack中的主机资源。 ucloud 支持ucloud资源的同步。 Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/Connector/pp/device/synctags/":{"url":"open-c3-code/Connector/pp/device/synctags/","title":" CMDB/把tags同步到云上 ","keywords":"","body":"CMDB/把tags同步到云上 ./syncDepartment 把部门信息同步到云上，服务树的第二层为部门。 ./syncProductOwner 把部门资源Owner信息同步到云上，执行前先在配置文件ProductOwner.yml中描述部门对应的Owner。 Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/Connector/pp/service-analysis/nginx/":{"url":"open-c3-code/Connector/pp/service-analysis/nginx/","title":" CMDB/服务分析/nginx ","keywords":"","body":"CMDB/服务分析/nginx 默认配置 # cat /data/open-c3/Connector/pp/service-analysis/nginx/nginx.node nginx /data/apps/nginx/conf/conf.d nginx /etc/nginx/conf.d nginx /usr/local/openresty/nginx/conf/conf.d 自定义配置 如果默认的配置不满足需求，可以自定义nginx的采集规则, 配置文件文件路径： /data/open-c3-data/service-analysis/nginx.node 配置文件内容格式: 文件用空格分隔的三列： 第一列: 服务树ID、IP地址、\"nginx\"字样。 其中nginx字样表示服务树节点名称是\"nginx\"的节点下的机器 第二列: 采集的nginx配置的路径 第三列: 配置文件的别名、可以忽略、系统会自动生成 例子: # cat /data/open-c3-data/service-analysis/nginx.node nginx /data/apps/nginx/conf/conf.d nginx /etc/nginx/conf.d nginx /usr/local/openresty/nginx/conf/conf.d 10.10.10.10 /etc/nginx/conf.d_abc 9123 /etc/nginx/conf.d_abc Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/docs/cmdb/outline.html":{"url":"open-c3-code/docs/cmdb/outline.html","title":" CMDB/概要字段说明 ","keywords":"","body":"CMDB/概要字段说明 cmdb中的概要信息，用来做快速的信息匹配和查找。 每个资源的信息有固定的含义。 aws ec2的例子: outline: uuid: - \"实例ID\" baseinfo: - \"account\" - \"实例ID\" - \"主机名\" - \"区域\" - \"所在可用区\" system: - \"状态\" - \"实例类型\" - \"主机名\" - \"名称\" - \"内网IP\" - \"公网IP\" contact: - \"部门\" - \"业务负责人\" - \"运维负责人\" - \"服务树\" 字段说明 uuid uuid字段是资源的唯一标识，这个id一般情况下不要变更。 服务树绑定用的这个uuid。如果uuid变化，会导致服务树绑定错乱,通过olduuid字段进行记录和修复(aws-rds中有使用这个方式)。 baseinfo 当前确定的是前两个字段: account 实例ID system 前两个字段固定： 第一个字段资源状态 第二个字段是资源实例的类型 有的资源可能没有这两个字段.尽量找能体现这两个意思的字段。 如果还是没有，可以配置两个不存在的字段占位 如: system: - \"__status__\" - \"__type__\" 第三个字段之后的说明 第三个字段之后的信息是用来定位资源获取别名的。 有如下三种情况： 情况1: 主机名、内网IP、外网IP 情况2: 主机名、名称、内网IP、外网IP 情况3: 名称、 数据库ip、数据库端口 情况1在通过内网ip、外网ip、主机名这三个字段分别都可以定位到一个资源。 在找机器ip的机器别名时，获取的就是主机名这个字段。 情况2比情况1多了一个字段，比如aws-ec2有机器主机名、还有一个机器名称。情况2中的四个字段都可以定位到资源。 在获取资源别名是，如果传入的是ip，返回的是主机名字段。其他两个字段进行交叉返回。 情况3:数据库资源的资源定位，有时候查询条件带端口有时候不带端口。 在最后一个字段是数字的情况下。查询的uuid扩展为 ip 和 ip:端口。 也就是可以通过数据库ip或者数据库ip加端口的形式查询数据库的别名。 contact 字段内容固定: 分别是 部门，业务负责人、运维负责人、 服务树 Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/Connector/pp/device/crontab/ssl-certificate-expired-notify/":{"url":"open-c3-code/Connector/pp/device/crontab/ssl-certificate-expired-notify/","title":" CMDB/证书过期提醒 ","keywords":"","body":"CMDB/证书过期提醒 CMDB中的ssl证书数据中，有过期时间字段 ExpiredTime。 即将过期的证书，系统会每天邮件提醒告警组“cmdb_notify_ssl_expired”中的用户。 Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/Connector/pp/device/fee/":{"url":"open-c3-code/Connector/pp/device/fee/","title":" CMDB/费用计算 ","keywords":"","body":"CMDB/费用计算 使用方式 1. 把公有云的账号下载到如下路径 /data/open-c3-data/c3mc-device-fee/年-月/文件名字.csv 例: /data/open-c3-data/c3mc-device-fee/2024-05/price_bill_detail_xxx.csv 注: 文件名不重要，随便一个名字即可。可以把多个云的账单详情下载到下面 2. 修改csv文件字段 把上述文件的列名进行修改，csv文件可以有很多列，当前工具只识别三列，请把列名进行对应调整，分别为 NAME: 资源名称 UUID: 资源唯一编号 Price: 该记录关联的费用 3. 通过命令查看服务树资源费用 c3mc-device-fee --tree 服务树 --date 月份 例: c3mc-device-fee --tree open-c3.ops --date 2024-04 注: 当前服务树匹配是根据字符串匹配的方式，包含对应字符串即被包含进来， 如例子中的open-c3.ops，只要资源在任何服务树中的字符串中包含open-c3.ops字符串即被包含进来。 Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/AGENT/device/conf/tree.html":{"url":"open-c3-code/AGENT/device/conf/tree.html","title":" CMDB/默认服务树 ","keywords":"","body":"CMDB/默认服务树 配置服务树信息来源 cat /data/open-c3/AGENT/device/conf/config.copytreecol sync-huawei-dds: [ 'tag.tree', '_tree_', '_buildintree_' ] default: [ 'tag.tree', '_tree_', '_buildintree_' ] default-volume: [ 'tag.tree', '_vmtree_', '_tree_', '_buildintree_' ] 可以通过上述文件配置默认的服务树来源字段，该文件由c3代码进行维护。 如果想自己定义请写到路径/data/open-c3/AGENT/device/conf/config.copytreecol.private 默认情况下，服务树的来源为云上资源的tag（tag.tree）和 内部服务树(_tree_) 磁盘资源服务树来源 云上tag(tag.tree) + 磁盘主机的服务树信息(_vmtree_) + 内部服务树(_tree_) 内置服务树 _buildintree_ ,在系统内可能有其他组件会对资源挂树进行自动调整，这部分为内置服务树。 配置默认服务树挂载节点 cat /data/open-c3/AGENT/device/conf/config.defaulttree sync-huawei-dds: _null_ default: _null_ 可以通过上述文件配置资源默认的挂载服务树节点。该文件由c3代码进行维护。 如果想自己定义默认挂载路径, 请写到路径/data/open-c3/AGENT/device/conf/config.defaulttree.private 这是一个服务树的格式，如sync-huawei-dds: aa.bb.cc Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/Connector/pp/spotx/":{"url":"open-c3-code/Connector/pp/spotx/","title":" EKS弹性伸缩支持大Pod算法 ","keywords":"","body":"EKS 弹性伸缩支持大Pod算法 基本思想： 对大Pod和小Pod进行区分，大pod运行在有“欢迎大Pod运行”的标签的主机上，小pod运行在“欢迎小Pod运行”的主机上。 弹性自动添加的机器最开始没有标签。通过一个定时任务来进行“欢迎大Pod运行”和“欢迎小Pod运行”标签的管理。 标签添加规则： 每分钟检测一次，如果发现主机上没有标签，在这个情况下，检查主机上的pod，如果发现大pod，打上“欢迎大Pod运行”标签。 如果发现的都是小pod，打上“欢迎小Pod运行”运行的标签。 标签去除规则： 每分钟扫描“欢迎小Pod运行”的主机，如果全部资源可以释放3个主机，进行碎片整理。 碎片整理步骤： 去掉主机标签，进行驱逐操作。 【5分钟一次或者10分钟。】 同时扫描“欢迎大pod运行”的主机，如果主机上没有pod，把标签删除【T1】 注： 大Pod是使用资源多的，如当前的PHP服务， 小Pod是使用资源少的。 这里说的pod只包括应用的pod，k8s系统默认的pod忽略。 大pod从request获取 使用需要的操作： 1.在大pod 上配置软亲和性“尽量到有欢迎大Pod运行”的主机上执行，同时尽量不在“欢迎小pod运行”的主机上执行。 2.在小pod上配置软亲和性“尽量到有欢迎小Pod运行”的主机上执行，同时尽量不在“欢迎大pod运行”的主机上执行。 3.保持原来的两个lambda的弹性伸缩逻辑。 4.运行上述的算法。 几个场景描述算法的运作逻辑： 1. 刚启动时： 刚启动时，所有主机都没有标签，pod和主机的关系有四种，A: 主机上只执行了大pod，B: 主机上只执行了小pod， C：主机上执行了大pod和小pod，D：主机空闲。 通过上述算法执行后，会给A和C类型的主机打上“欢迎大Pod运行”标签，会给B类型主机打上“欢迎小Pod运行”标签， D类主机不打标签。 在pod滚动更新的过程中，C类主机会慢慢消失，只剩下A、B、D种类型的情况。 2.弹性扩展主机的情况下： 主机扩展是因为要运行更多的pod，主机刚开机的时候是不知道是因为小pod资源不足还是大pod资源不足而引起的扩展。 大pod变多导致的扩展： 因为小pod还可以在原来的打有“ 欢迎小Pod运行”的主机上还足够运行，新开的机器，小pod不会运行到上面，也就不会 因为小pod占用了新机器的部分资源而使得新开的机器运行不了大pod。 大pod将能够正常的运行在新开的机器上，同时本算法会在一分钟后给他打上“欢迎大Pod运行”标签。 小pod变多导致的扩展： 小pod在“ 欢迎小Pod运行”的主机上没有足够的资源，小pod的数量变多的情况下，会自动的使用新开的机器，因为上面没有任何标签。 本算法随后会给小pod新占用的机器打上“欢迎小Pod运行”标签。 小pod随后会涌入被第一个小pod占领的主机。不会无限的污染新开的空闲主机。 3.弹性收缩的情况 如果是大pod数量变少导致的收缩，原来的lambda算法能正常的进行回收。【T1】 如果是小pod数量变少导致的搜索，这种情况下。原来的lambda有部分可能可以正常回收， 另一种可能是，“欢迎小Pod运行”的主机的资源利用率变低，但是不会触发回收。着时候需要进行标签去除的算法， 进行算法中的驱逐，驱逐后“欢迎小Pod运行”主机变少等待原来的lambda正常回收。 Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/Installer/C3/pkg/install-cache/":{"url":"open-c3-code/Installer/C3/pkg/install-cache/","title":" Installer/C3/pkg/install-cache ","keywords":"","body":"230608: 添加了kubectl_v1.26.0 230925: 更新tt前端 240310: 添加redis-cli Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/JOB/tools/":{"url":"open-c3-code/JOB/tools/","title":" JOB/任务说明 ","keywords":"","body":"JOB/任务说明 notify 负责 作业中的报警通知 和 审批插件的通知(不包括OA消息) Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/prometheus/image/":{"url":"open-c3-code/prometheus/image/","title":" prometheus镜像构建 ","keywords":"","body":"prometheus镜像构建 环境准备 # 安装promu curl -s -L https://github.com/prometheus/promu/releases/download/v0.5.0/promu-0.5.0.linux-amd64.tar.gz | tar -xvzf - -C /tmp cp /tmp/promu-0.15.0.linux-amd64/promu /usr/bin/ mkdir -p /data/open-c3/prometheus/image/code cd /data/open-c3/prometheus/image/code git clone git@github.com:open-c3/prometheus.git 编译 cd /data/open-c3/prometheus/image/code/prometheus promu crossbuild -p linux/amd64 make npm_licenses #第一次编译时运行一次即可 make common-docker-amd64 docker tag prom/prometheus-linux-amd64:main openc3/prometheus:v1 # 修改成当前要构建的版本号 编译版本 openc3/prometheus:v1 # 消息超时10年 openc3/prometheus:v2 # 消息超时10倍 openc3/prometheus:v3 # debug日志中显示往alertmanager发送的数据 Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/docs/https.html":{"url":"open-c3-code/docs/https.html","title":" 使用https ","keywords":"","body":"使用https Open-C3启动后默认是一个80端口的http服务。 如果你需要https的协议，请用一个nginx进行转发,把Open-C3的80端口作为后端。 配置过程中需要注意如下几个代理的配置字段： # 把协议传递到后端，影响到keycloak的功能,配置错误会导致keycloak登录页打开失败。 proxy_set_header X-Forwarded-Proto $scheme; # 把用户IP传递到后端，影响登录审计 # Open-C3会记录用户的登录IP，同时IP频繁登录失败时会自动临时限制IP登录。 proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; # 长连接,影响日志展示 proxy_http_version 1.1; proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection \"upgrade\"; nginx https配置的例子 server { listen 443 ssl; server_name open-c3.domain.org; #ssl证书文件位置(常见证书文件格式为：crt/pem) ssl_certificate /etc/nginx/csr/domain.org_nginx/domain.org_bundle.crt; #ssl证书key位置 ssl_certificate_key /etc/nginx/csr/domain.org_nginx/domain.org.key; #ssl配置参数（选择性配置） ssl_session_cache shared:SSL:1m; ssl_session_timeout 5m; #数字签名，此处使用MD5 ssl_ciphers HIGH:!aNULL:!MD5; location /third-party/keycloak/ { include /etc/nginx/allow.d/ip.conf; proxy_set_header X-Forwarded-For $remote_addr; proxy_set_header X-Forwarded-Proto $scheme; proxy_set_header X-Real-IP $remote_addr; proxy_set_header Host $host; proxy_http_version 1.1; proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection \"upgrade\"; proxy_pass http://open-c3.domain.org; } location / { proxy_set_header X-Forwarded-For $remote_addr; proxy_set_header X-Forwarded-Proto $scheme; proxy_set_header X-Real-IP $remote_addr; proxy_set_header Host $host; proxy_http_version 1.1; proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection \"upgrade\"; proxy_pass http://open-c3.domain.org; } location ~ ^/status/ { stub_status on; access_log off; } error_page 404 /404.html; error_page 500 502 503 504 /50x.html; location = /50x.html { root html; } } Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/AGENT/device/conf/region.html":{"url":"open-c3-code/AGENT/device/conf/region.html","title":" 公有云/区域编码 ","keywords":"","body":"公有云/区域编码 区域编码 AWS: https://docs.aws.amazon.com/zh_cn/general/latest/gr/rande.html 阿里云: https://help.aliyun.com/document_detail/140601.html 腾讯云: https://cloud.tencent.com/document/product/213/6091 华为云: https://developer.huaweicloud.com/endpoint 金山云: https://docs.ksyun.com/documents/6965 谷歌云: https://cloud.google.com/compute/docs/regions-zones?hl=zh-cn Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/AGENT/device/conf/template/":{"url":"open-c3-code/AGENT/device/conf/template/","title":" 公有云/文档 ","keywords":"","body":"公有云/文档 aws aws python3 sdk boto3 库的文档地址 https://boto3.amazonaws.com/v1/documentation/api/latest/reference/services/s3.html 谷歌云 查询虚拟机字段说明 https://cloud.google.com/compute/docs/reference/rest/v1/instances/get 阿里云 查询 ecs 字段说明 https://help.aliyun.com/document_detail/25506.html 华为云 查询 ecs 字段说明 https://support.huaweicloud.com/api-ecs/ecs_02_0104.html 腾讯云 查询 cvm 字段说明 https://cloud.tencent.com/document/api/213/15753#Instance 金山云 查询 epc 字段说明 https://docs.ksyun.com/documents/651 查询 kec 字段说明 https://docs.ksyun.com/documents/833 Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/AGENT/device/conf/authorization.html":{"url":"open-c3-code/AGENT/device/conf/authorization.html","title":" 公有云/权限说明 ","keywords":"","body":"公有云/权限说明 IP白名单 某些云的权限配置需要同时添加访问IP白名单，请添加c3的出口IP白名单, 否则某些功能无法正常运行。 权限点说明 腾讯云 请创建一个自定义策略，在该策略中分配如下权限，可以直接复制如下配置创建自定义策略。 { \"version\": \"2.0\", \"statement\": [ { \"effect\": \"allow\", \"action\": [ \"cam:ListMaskedSubAccounts\", \"cam:ListAttachedUserAllPolicies\", \"cam:GetPolicy\", \"cam:CreatePolicyVersion\", \"cam:DeletePolicyVersion\", \"finance:*\", \"cvm:StopInstances\", \"cvm:DetachCbsStorages\", \"cvm:TerminateCbsStorages\", \"cvm:TerminateInstances\", \"cvm:RunInstances\", \"cvm:DescribeSecurityGroups\", \"cvm:DescribeInstances\", \"cvm:DescribeCbsStorages\", \"cvm:DescribeImages\", \"cvm:StartInstances\", \"cvm:ResetInstancesType\", \"dcdb:DescribeProjects\", \"cdb:DescribeDBInstances\", \"cdb:ModifyInstanceTag\", \"cdb:CreateDBInstanceHour\", \"cdb:CreateDBInstance\", \"cdb:DescribeParamTemplates\", \"cdb:IsolateDBInstance\", \"cdb:OfflineIsolatedInstances\", \"cdb:OpenWanService\", \"ckafka:DescribeInstances\", \"clb:DescribeLoadBalancers\", \"clb:CreateLoadBalancer\", \"clb:CreateListener\", \"clb:CreateRule\", \"clb:RegisterTargets\", \"clb:DeleteLoadBalancer\", \"redis:DescribeInstances\", \"vpc:DescribeVpcEx\", \"vpc:DescribeSubnetEx\", \"cos:GetService\", \"cos:GetBucketTagging\", \"mongodb:DescribeDBInstances\", \"mongodb:DescribeDBInstanceNodeProperty\", \"sqlserver:DescribeDBInstances\", \"tag:TagResources\", \"tag:UnTagResources\", \"cynosdb:DescribeInstances\", \"dnspod:DescribeDomainList\", \"monitor:*\" ], \"resource\": [ \"*\" ] } ] } 在上面的策略中， [ \"cam:ListMaskedSubAccounts\", \"cam:ListAttachedUserAllPolicies\", \"cam:GetPolicy\", \"cam:DeletePolicyVersion\", ] 这四项是不需要的，但是没这四项会导致在腾讯云控制台无法查看、编辑、更新策略。为了方便管理，默认加上了。 aws { \"Version\": \"2012-10-17\", \"Statement\": [ { \"Sid\": \"VisualEditor0\", \"Effect\": \"Allow\", \"Action\": [ \"ec2:DescribeInstances\", \"ec2:DescribeVolumes\", \"ec2:DescribeInstanceTypes\", \"ec2:DescribeAddresses\", \"ec2:DeleteTags\", \"ec2:DescribeInstanceTypeOfferings\", \"ec2:DescribeAvailabilityZones\", \"ec2:DescribeSubnets\", \"ec2:RunInstances\", \"ec2:DescribeRegions\", \"ec2:AssociateAddress\", \"ec2:CreateTags\", \"ec2:DescribeVpcs\", \"ec2:DescribeImages\", \"ec2:DescribeSecurityGroups\", \"ec2:StopInstances\", \"ec2:StartInstances\", \"ec2:AllocateAddress\", \"ec2:DisassociateAddress\", \"ec2:ReleaseAddress\", \"ec2:TerminateInstances\", \"ec2:ModifyInstanceAttribute\", \"iam:CreateRole\", \"iam:AddRoleToInstanceProfile\", \"iam:DetachUserPolicy\", \"iam:ListPolicies\", \"iam:GetPolicy\", \"iam:ListGroupsForUser\", \"iam:CreateInstanceProfile\", \"iam:PassRole\", \"iam:ListAttachedUserPolicies\", \"iam:CreatePolicyVersion\", \"iam:ListRoles\", \"iam:ListUsers\", \"iam:ListUserPolicies\", \"iam:GetPolicyVersion\", \"iam:ListPolicyVersions\", \"iam:DeletePolicyVersion\", \"elasticloadbalancing:DescribeLoadBalancers\", \"elasticloadbalancing:DeleteLoadBalancer\", \"elasticloadbalancing:AddTags\", \"elasticloadbalancing:RemoveTags\", \"elasticloadbalancing:DescribeTags\", \"elasticloadbalancing:DescribeTargetGroups\", \"elasticloadbalancing:DeleteTargetGroup\", \"lightsail:GetInstances\", \"lightsail:GetLoadBalancers\", \"lightsail:GetRelationalDatabases\", \"kafka:ListClustersV2\", \"rds:RemoveTagsFromResource\", \"rds:DescribeDBInstances\", \"rds:AddTagsToResource\", \"rds:DescribeDBSnapshots\", \"rds:DeleteDBInstance\", \"rds:DescribeDBClusters\", \"rds:DeleteDBCluster\", \"dynamodb:ListTables\", \"dynamodb:TagResource\", \"dynamodb:UntagResource\", \"dynamodb:DescribeTable\", \"dynamodb:ListTagsOfResource\", \"pricing:GetProducts\", \"s3:ListAllMyBuckets\", \"s3:GetBucketLocation\", \"s3:GetBucketTagging\", \"elasticache:RemoveTagsFromResource\", \"elasticache:AddTagsToResource\", \"elasticache:DescribeCacheClusters\", \"route53:ListHostedZones\", \"route53:ListTagsForResources\", \"route53:ListResourceRecordSets\", \"sts:DecodeAuthorizationMessage\" ], \"Resource\": \"*\" } ] } 华为云 在华为云创建自定义策略，里面可以包含某个资源的单个权限点。如果是多个资源的情况，需要创建多个自定义策略，这样导致创建最小权限比较繁琐。可以直接在资源类型上分配只读权限。 下面权限中，需要完整访问权限是因为某些资源标签修改需要写权限。 [ \"ECS FullAccess\", \"DCS FullAccess\", \"DDS FullAccess\", \"RDS FullAccess\", \"EVS FullAccess\", \"GaussDB NoSQL FullAccess\", \"OBS FullAccess\", \"DMS FullAccess\", \"ELB FullAccess\" ] 注意: 截止2023年2月21日，华为云 北京一(cn-north-1) 和 上海二(cn-east-2) 的资源已经卖完，目前属于私有区域。但是因为华为云接口问题，获取到的项目列表里仍旧包含这俩区域，导致c3从这俩区域获取资源出现403错误，因此配置用户组权限时，在 \"选择授权范围方案\" 选项下，点击\"指定区域项目资源\"，然后选择你要授权的项目列表，这样可以排除上述的那俩特殊区域。 金山云 [ \"EPCReadOnlyAccess\", \"VPCReadOnlyAccess\", \"TagFullAccess\", \"KECReadOnlyAccess\", \"SLBReadOnlyAccess\", \"EBSReadOnlyAccess\", \"KRDSReadAccess\", \"KCSReadAccess\", \"KS3ReadOnlyAccess\" ] 阿里云 下面权限中，需要完整访问权限是因为某些资源标签修改需要写权限。 [ \"AliyunVPCReadOnlyAccess\", \"AliyunECSFullAccess\", \"AliyunRDSFullAccess\", \"AliyunKvstoreFullAccess\", \"AliyunOSSFullAccess\", \"AliyunSLBFullAccess\" ] 谷歌云 请在谷歌云控制台启用如下服务: [\"Cloud SQL Admin API\"] 需要的权限点如下： [ \"cloudsql.instances.get\", \"cloudsql.instances.list\", \"cloudsql.instances.update\", \"compute.disks.get\", \"compute.disks.list\", \"compute.disks.setLabels\", \"compute.instances.get\", \"compute.instances.list\", \"compute.instances.setLabels\", \"compute.images.get\", \"compute.regions.list\", \"redis.instances.list\", ] Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/c3-front/src/assets/js/":{"url":"open-c3-code/c3-front/src/assets/js/","title":" 前端引用文件 ","keywords":"","body":"前端引用文件 引用插件源文件 xlsx.full.min.js (本地路径) file-server.js (本地路径) xlsx.full.min.js与 file-server.js这两个文件是使用xlsx插件相关，为了保持系统稳定性，取消CDN方式加载，使用固定版本的代码进行加载， 下面是源文件链接 xlsx.full.min.js file-server.js 登录状态检查脚本 check-login.js check-login.js文件生效的情况是当从监控面板跳转到 grafana 和 prometheus 等外链新页面时， 状态不能够同步，通过这个脚本通过OPEN-C3接口检测登录态 从而通过弹窗提示用户是否需要重新登录 Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/Installer/scripts/httpload/":{"url":"open-c3-code/Installer/scripts/httpload/","title":" 压测工具 ","keywords":"","body":"压测工具 接口简单压测,测试接口稳定性 注: 测试服务在restart和reload过程中接口的稳定性 安装 ./init.sh #安装完成后，当前目录会有二进制工具http_load 使用 ./http_load -p 10 -s 60 url.txt # 10个并发测试60秒 Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/docs/flow-cicd.html":{"url":"open-c3-code/docs/flow-cicd.html","title":" 发布流程对接到第三方系统 ","keywords":"","body":"发布流程对接到第三方系统 通过分支发布 获取流水线的branch列表 http://openc3.xxx.com/api/ci/v2/c3mc/cibranch/$flowid 例: http://openc3.xxx.com/api/ci/v2/c3mc/cibranch/362 其中362是流水线编号 指定流水线和分支名称提交一个发布请求，可以用get或者post请求，最好用post请求，get是用于调试的，后面可能会关闭。这个请求会返回一个发布的版本号，用这个版本号通过查询API请求是否发布到了这个版本。 http://openc3.xxx.com/api/ci/v2/c3mc/cibranch/$flowid/$branch 例: http://openc3.xxx.com/api/ci/v2/c3mc/cibranch/362/v2.6.0 其中362是流水线编号, v2.6.0是要发布的分支 通过tags发布 获取流水线的tags的列表 http://openc3.xxx.com/api/ci/v2/c3mc/citags/$flowid 例: http://openc3.xxx.com/api/ci/v2/c3mc/citags/362 其中362是流水线编号 指定流水线和分支名称提交一个发布请求，可以用get或者post请求，最好用post请求，get是用于调试的，后面可能会关闭。这个请求会返回一个发布的版本号，用这个版本号通过查询API请求是否发布到了这个版本。 http://openc3.xxx.com/api/ci/v2/c3mc/citags/$flow/$tags 例: http://openc3.xxx.com/api/ci/v2/c3mc/citags/362/release-v2.6.0 其中362是流水线编号, release-v2.6.0是要发布的tags 查询发布状态 通过上一个接口返回的版本号，和这个接口返回的版本号进行对比，如果版本一致，说明发布成功了。这个接口显示的是当前流水线最后发布成功的版本。 http://openc3.xxx.com/api/jobx/flowline_version/$flowid 或者直接指定版本，查询该版本是否发送成功 http://openc3.xxx.com/api/jobx/task/flowline/status/$flowid/$version 例: http://openc3.xxx.com/api/jobx/task/flowline/status/362/release-v2.6.0-20240329153433 Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/Connector/pp/mci/ci-code-merge/":{"url":"open-c3-code/Connector/pp/mci/ci-code-merge/","title":" 发布过程中支持代码自动合并 ","keywords":"","body":"发布过程中支持代码自动合并 准备操作 # 通过下面命令，安装jq命令 yum install epel-release yum install jq 准备代码合并具体操作的脚本 git有多个版本，每个版本的API会有差别。 不是每个公司都需要在做CICD的时候自动做代码合并，所有这里没有提供兼容所有git版本的脚本。 git目录下放了一个 \"git.example.com\" 例子。这个是基于GitLab写的脚本，大家可以根据自己公司的情况编写自己的脚本。 放到 git/ 目录下。 Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/Connector/pp/mmon/alertmanagercrontab/":{"url":"open-c3-code/Connector/pp/mmon/alertmanagercrontab/","title":" 告警屏蔽/每天固定时间屏蔽 ","keywords":"","body":"告警屏蔽/每天固定时间屏蔽 alertmanager中屏蔽告警，只能选择一个时间段，如果想每天固定时间屏蔽某些告警， 比如: 晚上某些数据库不告警CPU相关的内容。 例子: 需求: 机器 10.10.10.10 晚上 10点到早上10点不告警。有效期一百天。 配置: 设置一个正常周期的屏蔽，设置的是最后一天的，如果想有效期是100天，那设置的就是第100天的屏蔽。 特殊的地方在于，在Comment中写上: \"crontab.by.\" 原理: 系统会每10分钟扫描一次所有的屏蔽列表，如果Comment是“crontab.by.”,同时没有最近一天的屏蔽内容， 会自动创建一个最近一天的屏蔽。系统创建的屏蔽的Comment会标记上\"crontab.by.xxx-xxx-xxx\", 其中xxx-xxx-xxx就是原始屏蔽的这条记录的id号。 Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/Connector/bl/proxy/":{"url":"open-c3-code/Connector/bl/proxy/","title":" 堡垒机/代理服务 ","keywords":"","body":"堡垒机/代理服务 该服务运行在类似跳板机这种服务器上，主要的功能是通过该服务调用相关命令添加服务器权限。 Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/Connector/pp/bl-ext/":{"url":"open-c3-code/Connector/pp/bl-ext/","title":" 堡垒机/权限添加 ","keywords":"","body":"堡垒机/权限添加 批量添加权限 示例命令: c3mc-base-bastion-add-server-auth zhangsan@abc.com sudo_0 192.168.x.1,110.10.x.1,172.10.x.1,10.0.x.1,198.10.x.1 Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/AGENT/device/conf/baoleiji.html":{"url":"open-c3-code/AGENT/device/conf/baoleiji.html","title":" 堡垒机说明 ","keywords":"","body":"堡垒机说明 机器同步说明 往堡垒机同步的机器默认同步的是内网ip，如果要同步指定vpc下所有机器的公网ip到堡垒机，请在open-c3进行如下操作: 进入页面 管理 -> 跳板机网络管理; 在页面右上方的输入框中输入数据，并点击添加按钮。数据的组成规则是 Aliyun/AWS/Google/Huawei/KSC/QCloud_VPCName。 在该页面配置完相关vpc后，该vpc下往堡垒机同步的机器都会使用公网ip。如果要同步内网ip，请删除对应条目。 Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/AGENT/scripts/juyuntree/":{"url":"open-c3-code/AGENT/scripts/juyuntree/","title":" 外部服务树缓存 ","keywords":"","body":"外部服务树缓存 简介 如果OpenC3的服务树使用了第三方系统，如果第三方系统要下线。 可以通过下面方式把服务树和服务树的资源绑定关系缓存起来。 这个有别与把服务树切换成OpenC3内部服务树。 OpenC3的服务树可以一次配置多个来源。如果是其中一个来源出现系统要下线的情况下使用该方式。 操作演示 下面我们以服务树依赖的是juyun为例。 例子中用的是treemap1和nodeinfo1。同时使用的服务树有效id在900到2000之间。 在操作之前可以看到Connector/config.inix中有如下内容: ================================================================================= treemap1: https://console.polymericcloud.com/api/keystone/platform/allservicetree treemapenv1: appkey: xxxxxx appname: openc3 treemapeid1: [ 900, 2000 ] nodeinfo1: https://console.polymericcloud.com/api/platform/c3/serviceTree/node/ nodeinfoenv1: appkey: xxxxxx appname: openc3 nodeinfoeid1: [ 900, 2000 ] ================================================================================= 进到OpenC3容器的/data/Software/mydan/AGENT/scripts/juyuntree目录下。 目录下有treemap.sh和nodeinfo.sh工具。把工具中的xxxxxx更换成对应config.inix配置文件中的appkey。 执行：./make.sh 更新Connector/config.inix文件中的treemap1和nodeinfo1为如下内容: treemap1: http://localhost:88/api/scripts/juyuntree/treemap/allservicetree nodeinfo1: http://localhost:88/api/scripts/juyuntree/nodeinfo/ Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/docs/nginx-allow.html":{"url":"open-c3-code/docs/nginx-allow.html","title":" 安全/访问控制 ","keywords":"","body":"安全/访问控制 Open-C3的前端是通过nginx提供服务的，如果您想对访问进行ip限制，可以在 /data/open-c3-data/nginx.conf/allow.conf 添加控制策略。 /data/open-c3-data/nginx.conf/allow.conf文件的例子: allow 10.10.10.1; allow 10.10.10.2; allow 10.10.10.3; allow 10.10.10.4; allow 10.10.10.5; allow 10.10.10.6; deny all; 注: 正常情况下，您的服务如果部署在公有云上，直接通过云上的ACL来控制即可。 Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/Connector/pp/agenti/":{"url":"open-c3-code/Connector/pp/agenti/","title":" 安装/Agent/批量安装&升级 ","keywords":"","body":"安装/Agent/批量安装&升级 通过发布Agent批量安装和升级监控Agent cd /data/Software/mydan/Connector/pp/agenti # 进入该目录下执行，安装和升级脚本会访问执行路径下的 .addr 和 .version 文件 把Open-C3的地址写到本目录的 .addr 文件中， 内容如: http://10.10.10.1 把监控Agent的期望版本号写入本目录的 .version 文件中，版本号是一个数字. 如： 23 批量安装监控Agent,执行命令 c3mc-mon-agent-install 。安装的列表为监控系统中up == 0 的机器 批量升级监控Agent,执行命令 c3mc-mon-agent-update 。 升级的列表是Agent版本号小于 .version 中标记的版本。 批量安装falcon兼容程序, 执行命令c3mc-mon-agent-falconmigrate 。升级的列表是程序版本小于 .versionfalconmigrate 的机器。 在堡垒机上批量安装发布和监控的Agent 和上一步一样，进入指定目录，写好 .addr 和 .version 文件。 1. 执行 ./package.sh 打包当前Open-C3的Agent成一个独立的文件。 2. 把本目录拷贝到跳板机上 3. 执行 ./upgrade.sh 把C3中的中的压缩包下载到跳板机的本目录下 4. 把要安装的机器的ip写到跳板机执行目录的 node 文件中。 5. 执行批量安装命令: ./run.sh Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/CI/cci/":{"url":"open-c3-code/CI/cci/","title":" 常见的CI构建镜像 ","keywords":"","body":"常见的CI构建镜像 Common CI images 【常见的ci构建镜像】 Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/docs/faq.html":{"url":"open-c3-code/docs/faq.html","title":" 常见问题 ","keywords":"","body":"常见问题 发布 同步文件出现md5错误 如同步过程中，出现如下错误。可以检查一下ulimit,看是否是ulimit限制了文件的大小。通过ulimit命令把文件大小的限制调大即可。 sp:/data/glusterfs/ci_repo/30044694/release-online-202306201821 => dp:/data/scripts/packages/web-gateway/release-online-202306201821 localhost => 10.10.10.100: DUMP 10.10.10.100 10.10.10.100: DUMP 10.10.10.100 10.10.10.100: DUMP 10.10.10.100 Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/docs/aws-ami.html":{"url":"open-c3-code/docs/aws-ami.html","title":" 应用市场/AWSmarketplace ","keywords":"","body":"应用市场/AWS marketplace 镜像制作 制作镜像的步骤： 1. 使用一键安装脚本安装最新版本的Open—C3. curl https://raw.githubusercontent.com/open-c3/open-c3/v2.6.1/Installer/scripts/single.sh | OPENC3VERSION=v2.6.1 bash -s install 2. 执行下面命令，清理命令历史，ssh key文件等 /data/open-c3/Installer/scripts/AWS-AMI.sh force 镜像使用 #OpenC3默认使用80端口对外提供服务。 #aws中国境内的服务器，要经过备案后80端口才可以访问。如果需要更换端口，可以执行下面的命令（以8090端口为例） iptables -t nat -A PREROUTING -p tcp --dport 8090 -j REDIRECT --to-port 80 # 注: 正常情况下net转发是打开的，如果端口访问不正常，可以用这个命令打开一下：sysctl net.ipv4.ip_forward=1 #新启动的镜像，可以通过下面命令添加用户用于登录 docker exec openc3-server c3mc-base-adduser --user open-c3 使用指南 1.通过镜像启动产品 2.使用Web浏览器访问http://上的应用程序 3.在通过镜像创建机器之后，使用以下命令创建帐户密码： sudo docker exec openc3-server c3mc-base-adduser --user open-c3 user: open-c3 password: Example \"VSfjZDw8qrScgwWgKI\" • 登录系统后，在右上角的“管理”菜单中输入“系统监视器”，即可检查系统的健康状况。 • 关于编程系统凭据和加密密钥的轮换，默认情况下，用户的登录帐户密码有效期为90天，并且在密码有效期剩余15天时，系统会提醒用户更改密码。 • 敏感信息存储位置： /data/open-c3-data/auth: 代理的公钥和私钥 /data/open-c3-data/device/curr/auth: 授权查看资源管理中账户的用户授权文件 /data/open-c3-data/sysctl.conf: 系统参数配置文件 /data/open-c3/Connector/config.ini: 系统连接器配置文件 Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/tools/bf/":{"url":"open-c3-code/tools/bf/","title":" 开发工具/根据提交ID编译前端代码 ","keywords":"","body":"开发工具/根据提交ID编译前端代码 有的情况下可能需要查看老版本的前端效果。 该工具可以根据一个提交号编译前端，让当前开发环境的前端回到老的版本效果。 例: ./dev.sh ce24682dd5edd204c941d186d91c16bea1dbb942 Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/c3-front/":{"url":"open-c3-code/c3-front/","title":" 开发环境/前端 ","keywords":"","body":"开发环境/前端 说明 该项目是新运维平台前端的一个雏形，基于AngularJS。 基于AngularJS的 架构 有很多种，我们这里只是使用了其中某一种。核心是 AngularJS，主要不同在于所用的工具（package.json）有差别。代码的写作方式基本一致。 Pre-work npm JS包管理工具 Gulp 构建工具 $ npm install -g gulp Bower 前端(HTML, CSS, JS) 包管理工具 $ npm install -g bower 我本地的版本(参考1) $ npm -v 2.15.1 $ node -v v4.4.3 $ gulp -v [17:20:03] CLI version 3.9.1 [17:20:03] Local version 3.9.1 $ bower -v 1.7.9 我本地的版本(参考2) $ npm -v 6.13.4 $ node -v v8.17.0 $ gulp -v [17:20:03] CLI version 2.3.0 [17:20:03] Local version 3.9.1 $ bower -v 1.8.2 我本地的版本(参考3) # 2023-02-02 $ npm -v 6.13.4 $ node -v v10.2.0 $ gulp -v [17:20:03] CLI version 2.3.0 [17:20:03] Local version 3.9.1 $ bower -v 1.8.2 克隆项目 $ git clone https://github.com/open-c3/open-c3.git cd c3-front $ npm install $ bower install 目录结构 ├── bower.json > bower 主配置文件 ├── custom > 非bower管理的包，如ztree，然后在index.html中引用 ├── gulp > gulp 配置文件 │ ├── server.js > 可修改代理等信息，开发过程中本地server的配置 ├── gulpfile.js > gulp 主配置，一般不需改动 ├── package.json > npm 包信息，一般不需改动 └── src > 开发代码 ├── app │ ├── components > 自定义公共组件，如 tree， auth认证， 菜单栏 等 │ │ ├── tree │ │ │ ├── tree.directive.js │ │ │ ├── tree.html │ │ │ ├── tree.scss │ │ │ └── tree.service.js │ ├── index.config.js > 全局配置，如 debug，interceptor等 │ ├── index.constants.js > 常量配置 │ ├── index.module.js > 模块加载配置 │ ├── index.route.js > 路由配置 │ ├── index.run.js > 启动AngularJS │ ├── index.scss │ ├── main > 首页 main page │ │ ├── main.controller.js │ │ ├── main.html │ │ ├── main.scss │ │ └── demo │ │ └── main.html │ └── pages > 二级子页面 │ ├── detail │ │ ├── detail.controller.js │ │ ├── detail.html │ └── others > 其他特殊页面 │ ├── 404.html │ └── 500.html ├── assets > 一些静态资源信息，如图片等 │ └── images └── index.html > WEB入口 Usage $ gulp serve 本地开发测试用 包括 代码修改自动reload，镜像同步等功能 默认为 3000 端口 $ gulp build 打包到 dist 目录，dist目录为 发布目录 注入js/css到index.html，字体fonts，压缩等 $ bower list 查看当前已经安装的前端包（库） $ bower install ng-table --save $ bower uninstall ng-table --save 安装卸载ng-table $ npm list 查看当前已经安装的npm包 $ npm install xxx --save-dev 注意点 /** @ngInject */ 不是普通注释 ng-annotate, 每个service/filter/controller/directive/provider 都需要 规范 & 建议 子页面在app/pages/ 下，以目录为单位，每个目录下建立相应的 html/scss/service/directive/controller 等。可以认为是 一个目录对应一个路由 $ gulp serve 后，在终端能看到debug信息，可以根据提示信息，检查一些基本的 js语法错误，或语法建议信息，尽量按照语法建议的来修改。 前端的库（包）尽量用bower来安装，并且能 gulp serve 后自动加载对应库的js/css等文件。如果不能正确加载（如zTree），非特殊情况，尽量避免使用。 zTree 之所以不能自动加载，是因为zTree的bower.json配置问题 其他 URL中的#，ui-router - html5mode 前端模板样式参考 http://demo.pixelcave.com/appui/index.php 几个主要（常用）前端插件 zTree, 树 sweetalert，alert插件 angular-toastr，提示框插件 ng-table， 表格插件 angular-bootstrap, bootstrap的AngularJS版 font-awesome，字体图标 一些AngularJS基础技术点说明 路由，这是基本，要知道怎么定义路由，怎么实现路由跳转。本项目是基于ui-router 加载模块，模块需要手动来指定加载。index.module.js $http, 这个是使用频率最高的服务，用来发起http请求。其他常用服务如：$log, $state Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/docs/web-dev.html":{"url":"open-c3-code/docs/web-dev.html","title":" 开发环境/前端开发 ","keywords":"","body":"开发环境/前端开发 OPEN-C3的前端是通过angularjs进行的开发。下面提供了两个方式来准备开发环境。 如果是前端工程师，建议使用“纯前端工程师”的方式。 如果是前后端都进行开发的工程师，建议使用“全栈开发的方式”。 纯前端工程师 方法1: 1. OPEN-C3代码中的c3-front为前端代码，根据c3-front/README.md中的描述准备开发环境。 2. 绑定本地hosts文件，把域名open-c3.org指向后端服务器地址，如：10.10.10.1 open-c3.org 方法2:(通过docker) mkdir c3-www cd c3-www git clone https://github.com/open-c3/open-c3 git clone https://github.com/open-c3/open-c3-dev-cache rsync -av open-c3-dev-cache/c3-front/ open-c3/c3-front/ docker run -it -v `pwd`/open-c3/c3-front/:/code -p 8080:3000 --add-host=open-c3.org:10.10.10.10 openc3/gulp gulp serve #注 上一条命令的8080是本地监听的端口，通过访问http://localhost:8080 即可访问前端服务。 #10.10.10.10为后端Open-C3服务的地址 全栈开发 在本地安装OPEN-C3单机版 运行下面命令启动前端开发环境。 /data/open-c3/Installer/scripts/dev.sh start 10.10.10.10(open-c3 api IP) 启动后会多一个docker实例openc3/gulp。通过3000端口进行访问。直接修改c3-front目录中的文件即可实时生效。 Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/Connector/pp/dtool/":{"url":"open-c3-code/Connector/pp/dtool/","title":" 开发调试辅助工具 ","keywords":"","body":"开发调试辅助工具 c3mc-dtool-audit-check 检查是否有接口没有添加审计 c3mc-dtool-audit-check # 查看没有审计的接口 c3mc-dtool-audit-check x # 查看所有接口审计详情 Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/Connector/pp/spotx/door.html":{"url":"open-c3-code/Connector/pp/spotx/door.html","title":" 弹性伸缩/spotx ","keywords":"","body":"弹性伸缩/spotx 添加配置: /data/open-c3-data/spotx.conf 定时任务配置有的集群，会自动跑起任务，日志在 /var/log/spotx.[集群编号].log 70000007: #k8s集群管理中的凭据编号 maxcpu: 2000 #大pod的cpu阈值 maxmem: 3000 #大pod的内存阈值，【cpu和内存都大的时候才算大pod】 smallrelease: 2500000 #主机上有小pod标签的，整体资源空闲百分比的时候开始回收整理pod主机。 exclude: [ 'jaeger', 'amazon-cloudwatch', 'default', 'cert-manager' ] #排除掉部分namespace excludeprefix: [ 'kube-', 'monitoring', 'kubestar', 'kube' ] #根据前缀排除掉namespace # debugnode: #调试节点，如果需要调试，可以添加这个字段，这个字段下的主机才会打标签，其他跳过 # - ip-10-10-10-1.ec2.internal # - ip-10-10-10-2.ec2.internal 批量添加亲和性 在配置文件/data/open-c3-data/spotx-todo.conf中配置好集群配置，格式和 /data/open-c3-data/spotx.conf 格式一样. 批量给已有的deployment添加亲和性设置 c3mc-spotx-affinity-todo 70000007 #命令执行完后会生成两个脚本，一个是批量添加亲和性，一个是批量去掉亲和性设置。 Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/Connector/pp/cloud/":{"url":"open-c3-code/Connector/pp/cloud/","title":" 当前支持的公有云 ","keywords":"","body":"当前支持的公有云 云厂商 资源同步 AWS 计算(ec2、lightsail-vps)、 数据库(rds、redis、memcached、dynamodb、lightsail-db)、存储(s3)、 网络(alb、elb、lightsail-lb) 华为云 计算(ecs)、 数据库(rds、redis、dds、nosql)、 网络(elb) 腾讯云 计算(cvm)、 数据库(cdb、redis、mongodb、sqlserver)、 存储(ckafka、cos)、网络(clb) 谷歌云 计算(vm)、 数据库(rds、redis) 阿里云 计算(ecs)、 数据库(rds、redis)、 存储(oss)、 网络(slb) 金山云 计算(kec、epc)、数据库(krds、redis)、 存储(ks3)、 网络(slb) IBM 计算(虚拟机、裸金属服务器) CMDB 云资源同步 说明 本目录下存放云资源同步的插件。 每个插件是一个独立的可执行命令，命令把获取到的云资源输出到标准输出。 输出的格式每一行是一个资源，每一行都是一个json格式的数据。 名称格式：c3mc-cloud-云名称-云资源类型 【例：c3mc-cloud-huawei-rds 】 多账号问题 通过 c3mc-cloud-account 工具完成 工具使用方式: 方式1 echo \"账号名称 插件的参数\" | c3mc-cloud-account -p 插件名称 例: echo \"acountname ak sk project_id(可以传None) cn-north-4\" | c3mc-cloud-account -p c3mc-cloud-huawei-rds 方式2 c3mc-cloud-account -p 插件名称 --account 账号文件 例：c3mc-cloud-account -p c3mc-cloud-huawei-rds --account huawei 账号文件位置： /data/open-c3/AGENT/device/conf/account/账号文件名 账号文件格式： cat /data/open-c3/AGENT/device/conf/account/huawei huawei001 ak1 sk1 None cn-north-4 huawei002 ak2 sk2 None cn-north-4 多账号处理后的数据内容变化 通过c3mc-cloud-account工具处理完后，原始同步插件返回的数据中多出来一个字段\"account\", 字段的内容是第一个字段的账号名。 注意事项 华为云资源同步。如果传递了 project_id 参数，需要在项目级别配置权限；如果传递了 None，需要在 iam 级别配置权限。 Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/tools/pd/":{"url":"open-c3-code/tools/pd/","title":" 性能优化/perl/开发工具 ","keywords":"","body":"性能优化/perl/开发工具 路径 cd /data/open-c3/tools/pd 安装 ./init.sh #只有开发环境需要该模块，暂时不默认打包到容器中 使用 # 启动 ./runfast cmd argv ... # 只检查第一层perl，如果system调用了其它命令不进行统计 ./rundeep cmd argv ... # 深入检查，如果当前的perl调用了其它perl程序，也一样会检查 # 例 ./runfast /data/Software/mydan/Connector/pp/device/c3mc-device-cat-all --timemachine curr # 访问报告 打开浏览器访问 http://localhost:8000 Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/Connector/pp/bpm/action/update-resource-tags/":{"url":"open-c3-code/Connector/pp/bpm/action/update-resource-tags/","title":" 批量更新标签说明 ","keywords":"","body":"批量更新标签说明 调用脚本的命令为: echo '{\"filepath\": \"./data.txt\"}' | c3mc-bpm-action-update-resource-tags data.txt的内容格式为: lb-xxxxxxx [{\"TagKey\": \"OpsOwner\", \"TagValue\": \"aaaa@example.com\"}, {\"TagKey\": \"ProductOwner\", \"TagValue\": \"dddd@example.com\"}] lb-wwwwwww [{\"TagKey\": \"OpsOwner\", \"TagValue\": \"bbbb@example.com\"}, {\"TagKey\": \"ProductOwner\", \"TagValue\": \"eeee@example.com\"}] lb-eeeeeee [{\"TagKey\": \"OpsOwner\", \"TagValue\": \"cccc@example.com\"}, {\"TagKey\": \"ProductOwner\", \"TagValue\": \"ffff@example.com\"}] 第一列和第二列使用制表符\"\\t\"连接。\"TagKey\"字段后指定标签键名，\"TagKey\"固定和\"TagValue\"固定。 至于data.txt的名字随意，只要在命令中指定正确就行。 Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/Connector/data/":{"url":"open-c3-code/Connector/data/","title":" 数据库表结构更新 ","keywords":"","body":"数据库表结构更新 v2.5.11 以上的版本数据库结构的修改保存在(sysupdate.dat)。 Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/Connector/pp/dbcheck/":{"url":"open-c3-code/Connector/pp/dbcheck/","title":" 数据检查 ","keywords":"","body":"数据检查 dbcheck-user 检查作业中的审批人、监控订阅人、监控告警组中的人是否在地址簿中配置了联系方式。 Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/Connector/pp/treex/door.html":{"url":"open-c3-code/Connector/pp/treex/door.html","title":" 服务树外部连接器 ","keywords":"","body":"服务树外部连接器 导出服务树信息给第三方系统 例： 账单系统 ./node # 导出服务树中的绑定关系，只包含主机 ./dump # 导出cmdb中所有数据, 同时包含主机的部分，根据使用情况决定主机部分使用cmdb的还是./node 把使用的服务树导入到c3内部 切换服务树为使用c3服务树时使用 ./todb | c3mc-base-savebind 服务树结构导入C3内部 c3mc-base-treemap | c3mc-base-savetree 常规导出(去掉了cmdb中的磁盘导出关系，磁盘uuid从主机中获取id) TODO: 可以把磁盘服务树关系从主机中获取出来，之后磁盘就可以直接从CMDB获取 ./run.sh # 然后到当前目录下的data目录获取生成的数据 Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/docs/multi-change-tree-name.html":{"url":"open-c3-code/docs/multi-change-tree-name.html","title":" 服务树/批量修改服务树名称 ","keywords":"","body":"服务树/批量修改服务树名称 #Open-C3中服务树的信息存储是一个扁平的结构，目前没有在页面添加修改非叶子节点名称的界面。 #如果有修改需求，可以使用下面命令进行修改。 #例子: c3mc-base-db-get -t openc3_connector_tree id name |grep demo.treetest|sed s/demo/dev/ | c3mc-base-tree-load Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/Connector/pp/base/tree-edit.html":{"url":"open-c3-code/Connector/pp/base/tree-edit.html","title":" 服务树/整理 ","keywords":"","body":"服务树/整理 如果在服务树调整阶段。需要大量的调整服务树。提供了如下命令对服务树的名称进行批量调整 c3mc-base-tree-dump |sed 's/_/-/g' |c3mc-base-tree-load c3mc-base-tree-dump |sed 's/;open-c3/;open-c4/' | ./c3mc-base-tree-load 注: 该工具只针对使用C3服务树的情况下，它们整理的是c3数据库中的服务树。 Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/Connector/pp/device/buildintree/":{"url":"open-c3-code/Connector/pp/device/buildintree/","title":" 服务树自动绑定/内置服务树 ","keywords":"","body":"服务树自动绑定/内置服务树 v1 根据资源类型绑定服务树 cat /data/open-c3-data/buildintree/v1.yml database: huawei-rds: open-c3.database.mysql.huawei-rds v2 根据资源字段匹配进行服务树绑定 cat /data/open-c3-data/buildintree/v2.yml database: huawei-rds: - tree: open-c3.database.mysql.huawei-rds1 match: - [ 'account', '/./' ] - [ 'private_ips.0', '/10.213.1/' ] - tree: open-c3.database.mysql.huawei-rds2 match: - [ 'account', '/./', '/./' ] - [ 'private_ips.0', '^10' ] - tree: x match: - [ 'account', '/./' ] - [ 'private_ips.0', '/10/' ] - tree: open-c3.database.mysql.huawei-rds4 注: 上面例子中一个资源类型下配置的是一个数组，会从上到下匹配. 匹配成功后后面的不会在匹配。 match中是数组，是“与”的关系，需要同时满足。 单个match中的元素也是数组，是”或“的关系。 匹配规则三种写法: 1. 正则： 写法 /xxx/, 在斜杠中间的部分是正则。 比如可以写 '/^1\\.1\\.1/' 或者 /\\d+/ 2. 匹配开头: 写法 ^xxx , 以^开头的字符串表示匹配开头， 如 ^abc.d 表示匹配 abc.d开头的字符串。 3. 相等， 除了上面两种情况就是完全匹配 如 [ 'account', 'foo', 'bar' ] 是比较 account 是不是等于foo或者bar。 服务树为“x”的时候表示忽略。比如 如果想某个网段的资源不想自动绑定服务树，可以让它匹配上名为 “x” 的服务树。 Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/Connector/pp/device/crontab/bind-tree-from-outside/":{"url":"open-c3-code/Connector/pp/device/crontab/bind-tree-from-outside/","title":" 服务树资源挂载同步 ","keywords":"","body":"服务树资源挂载同步 ``` 有的机器开机的时候调用了接口进行自动挂树。 为了让c3可以识别这些挂树信息。原来的挂树接口进行了处理，在有挂树请求时，把信息打到日志。 c3会定期同步这些挂树信息，然后导入到自己的数据库中。 `` Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/Installer/C3/cloudeye-exporter/":{"url":"open-c3-code/Installer/C3/cloudeye-exporter/","title":" 构建/cloudeye采集器 ","keywords":"","body":"构建/cloudeye采集器 ./init.sh 下载二进制文件 ./build.sh 构建并运行新构建的容器。账号文件为当前目录下文件 clouds.yml 测试一下请求返回 curl http://localhost:8087/metrics?services=SYS.RDS Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/Installer/C3/tencentcloud-exporter/":{"url":"open-c3-code/Installer/C3/tencentcloud-exporter/","title":" 构建/tencentcloud采集器 ","keywords":"","body":"构建/tencentcloud采集器 使用说明 ./init.sh 下载项目代码 ./build.sh 构建并运行新构建的容器。账号文件为当前目录下文件 qcloud.yml 测试一下请求返回 curl localhost:9123/metrics github https://github.com/tencentyun/tencentcloud-exporter Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/docs/mesg.html":{"url":"open-c3-code/docs/mesg.html","title":" 消息出口规范 ","keywords":"","body":"消息出口规范 发邮件 curl -H \"Content-Type: application/json\" -H 'appname: xxx' -H 'appkey: xxxxxx' -X POST -d '{\"user\": \"lijinfeng2011@gmail.com\",\"title\": \"邮件标题\", \"content\": \"邮件内容\" }' 'http://mesg.c3.xxx.org:8080/mail?encode=1' 发短信 curl -H \"Content-Type: application/json\" -H 'appname: xxx' -H 'appkey: xxxxxx' -X POST -d '{\"user\": \"1331136xxxx\",\"mesg\": \"短信内容\" }' 'http://mesg.c3.xxx.org:8080/mesg' 打电话 curl -H \"Content-Type: application/json\" -H 'appname: xxx' -H 'appkey: xxxxxx' -X POST -d '{\"user\": \"1331136xxxx\",\"mesg\": \"您好，电话测试\" }' http://mesg.c3.xxx.org:8080/call Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/AGENT/c3demoslave/":{"url":"open-c3-code/AGENT/c3demoslave/","title":" 演示环境虚拟节点 ","keywords":"","body":"演示环境虚拟节点 本工具给C3添加10个slave。slave中安装了发布和监控的agent。 机器ip以172开头。start完后slave会默认添加到服务树[7,8,9,10]中。 启动方式 1. cp env.example .env 2. 把c3的地址写入 .env 3. ./start.sh 停止方式 ./stop.sh Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/Installer/scripts/single/v2.6.1.html":{"url":"open-c3-code/Installer/scripts/single/v2.6.1.html","title":" 版本说明/v2.6.1 ","keywords":"","body":"版本说明/v2.6.1 解决更新server容器中的nginx添加upload模块问题 更新依赖镜像到basev2，让其与体验版的镜像进行统一。 用来解决upload文件（作业中的文件管理，镜像管理）中占用api时间过长的问题。 Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/AGENT/agent.mon/":{"url":"open-c3-code/AGENT/agent.mon/","title":" 监控AGENT版本说明 ","keywords":"","body":"监控AGENT版本说明 版本2: 解决进程采集太耗CPU的问题。 版本3: 进程监控匹配方式改成“包含”字符。 修改了进程启动时间的获取方式。 进程监控指标node_process_time改成node_process_etime。 端口监控状态区分端口是否是开放的。 版本4: 没有监控项时跳过进程和端口监控。 版本5: 没有安装sar或者ss命令时，返回采集状态3。 版本6: 进程监控和端口监控添加app字段。 版本7: 处理HTTP协议，确保大的携带数据能正确匹配，避免过早关闭连接。 版本8: 兼容只安装普罗米修斯node exporter的情况，本程序只作为代理。 版本9: 端口和进程监控，名称支持下划线和减号。 版本10: 添加文件、目录、软链接监控功能。 版本11: sar 监控去掉下面两个指标，有的机器没有gnice指标。 node_cpu_gnice_percent_summary node_cpu_gnice_percent 版本12: url 监控支持指定Host头 版本13: 执行命令时，通过AnyEvent从管道中实时获取数据，避免堵塞导致插件超时。 版本14: 修复上一个版本已入的bug，不要提前退出。 版本15: 磁盘监控命令df添加-P参数，增强可移植性。 有的情况下df的输出为了展示美观进行了换行，这样会导致匹配内容错误，添加-P参数后避免该情况。 版本16: 磁盘监控，去掉-l参数，网络盘也进行监控【如：nfs盘】 版本17: debug时显示后端url信息。 版本18: 修复13版本引入的异常，导致CPU使用率高。【13-17版本的要升级到该版本】。 版本19: NodeExporter 在作为代理的时候，扩展了nodeext（外部数据）采集，代理需要更新才能识别外部数据采集的URL。 否则可能返回的是代理节点的metrics数据(外部采集的uri刚好包含 /metrics的情况下)。或者采集不到数据。 版本20: 进程监控添加了debug日志，方便定位在报进程重启时无法找到当时匹配到的进程。 版本21: 进程监控支持字符\":\", 有的进程名会包含有冒号，如: \"nginx: master process nginx\" 版本22: 主机如果已经安装了node_exporter，并且监听在一个具体的ip上，监控agent会尝试找到这个ip。 避免已经安装了node_exporter的情况下采集不到原生的node_exporter数据。 版本23: 采集agent中的公钥列表，用于后续公钥定期替换。 版本24: HTTP监控，post请求，支持配置简单的数据post到接口中. HTTP监控返回内容匹配，匹配的内容可能有特殊的字符，支持通过base64进行编码 版本25: 为了兼容普罗米修斯的格式，把通过push上来的数据指标名中的“.”和“-“字符修改成下划线. 通过Content-Length字段来判定http数据完整，有的push请求，一次push上来很多数据，一次读取不完，需要等待Content-Length长度， 否则因为数据不全时把数据转换成json失败，导致push失败，最终数据没有上传到普罗米修斯中。 版本26: 采集FalconMigrate(falcon兼容程序)的状态数据，包括版本、错误数量等。 处理Http插件body为空时日志中的警告。 版本27: bootstrap中没有falcon_migrate的启动文件的情况下，不请求1988端口采集数据，直接返回-1。避免无效的http请求。 版本28: 添加统计指标，统计通过push方式上传的数据数量和错误数量。 版本29: 支持通过/opt/mydan/dan/agent.mon/exttag.yml文件，给通过push上传的数据追加额外的标签。 版本30: 支持通过/opt/mydan/dan/agent.mon/exttag_by_endpoint/**.yml文件，给通过push上传的数据，针对endpoint数据追加标签。 其中/opt/mydan/dan/agent.mon/exttag_by_endpoint/下面的文件名是endpoint的名字。 版本31: 携带数据，让falcon兼容程序，识别ecs的时候，实例id中允许有减号。 版本32: 处理通过push上来的数据中的step标记。 有的数据5分钟push一次，step为300。如果不处理step，会导致因为数据不是1分钟push异常会被判定为过期数据而删除掉。 版本33: 添加linux的ss命令的监控采集。 版本34: 添加ping监控的功能。 版本35: 监控进程时，进程名字不在限制字符，要限制字符的逻辑在c3主服务进行控制即可。 版本36: 添加物理磁盘使用率指标的采集。这个区别于磁盘使用率，统计的是物理盘。 版本37: 物理磁盘统计，不再统计别名。 版本38: 通过push方式上传的数据，如果tag名字中包含\".\"或者\"-\", 自动替换成下划线 版本39: 通过push方式上传的数据，允许字符“/”,有的标签写的是文件路径 版本40: 通过push方式上传的数据，允许字符“:”, endpoint可能是“ip:端口”的格式 版本41: 通过push方式上传的数据，metric中如果有空格，替换成下划线。 版本42: 采集开启了端口的进程信息，用于服务发现。 版本43: 通过文件标志控制释放开启端口进程的数据采集。有的环境可能不需要采集这部分数据。 版本44: 添加服务发现模块，发现主机上的java和nginx服务. node_collector_error 错误码 -2: 无监控项，采集跳过 -1: 启动中 0: 正常 1: 错误 2: 超时 3: 依赖工具缺失 监控agent的版本指标: node_exporter_version Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/Connector/pp/mmon/crontab/ali-pai-alarm/":{"url":"open-c3-code/Connector/pp/mmon/crontab/ali-pai-alarm/","title":" 监控/ali-pai任务监控 ","keywords":"","body":"监控/ali-pai 任务监控 在文件aksk.sh中写入aksk（可以参考aksk.sh.example文件的写法）。 在/data/open-c3/Connector/openc3.task.crontab中添加下面两条任务。 */5 * * * * root flock -n /tmp/ali-pai-alarm.lock /data/Software/mydan/Connector/pp/mmon/crontab/ali-pai-alarm/run.sh > /tmp/ali-pai-alarm.log 2>&1 0 * * * * root flock -n /tmp/ali-pai-notofy.lock /data/Software/mydan/Connector/pp/mmon/crontab/ali-pai-alarm/runnotify.sh > /tmp/ali-pai-notify.log 2>&1 Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/AGENT/monitor/blackbox-exporter/":{"url":"open-c3-code/AGENT/monitor/blackbox-exporter/","title":" 监控/blackbox ","keywords":"","body":"监控/blackbox 操作步骤 如果你需要黑盒测试，比如测试url的监控状态，https的证书是否过期。 可以按照下面步骤进行操作。 1. 开启黑盒监控的功能 /data/open-c3/AGENT/monitor/blackbox-exporter/start.sh 注: 第一次使用的时候进行操作 2. 创建配置文件 cp /data/open-c3/prometheus/config/targets/blackbox-exporter-http.example.yml /data/open-c3/prometheus/config/targets/blackbox-exporter-http.yml 3. 在配置文件中添加自己要监控的url cat /data/open-c3/prometheus/config/targets/blackbox-exporter-http.yml - targets: - https://www.baidu.com - https://www.github.com 4. reload prometheus /data/open-c3/prometheus/bin/reload.sh 说明 当前操作步骤过于繁琐，后续可能会把这个服务做成默认开启。 要监控的url临时先通过修改文件的方式进行配置，后续会在前端上添加页面管理要监控的url。 其他 如果是tcp监控，请按照上面http的方式编辑如下文件 cat /data/open-c3/prometheus/config/targets/blackbox-exporter-tcp.yml - targets: - 172.10.10.1:2181 - 172.10.10.2:2181 如果是icmp监控，请按照上面http的方式编辑如下文件 cat /data/open-c3/prometheus/config/targets/blackbox-exporter-icmp.yml - targets: - 114.114.114.114 Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/AGENT/monitor/fping/":{"url":"open-c3-code/AGENT/monitor/fping/","title":" 监控/fping ","keywords":"","body":"监控/fping 操作步骤 如果你需要fping监控。可以按照下面步骤进行操作。 1. 开启fping监控容器 /data/open-c3/AGENT/monitor/fping/start.sh 注: 第一次使用的时候进行操作 2. 创建配置文件 cp /data/open-c3/prometheus/config/targets/fping.example.yml /data/open-c3/prometheus/config/targets/fping.yml 3. 在配置文件中添加自己要监控的url cat /data/open-c3/prometheus/config/targets/fping.yml - targets: - 114.114.114.114 4. reload prometheus /data/open-c3/prometheus/bin/reload.sh 说明 当前操作步骤过于繁琐，后续可能会把这个服务做成默认开启。 要监控的ping临时先通过修改文件的方式进行配置，后续会在前端上添加页面管理要监控的地址。 Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/grafana/config/":{"url":"open-c3-code/grafana/config/","title":" 监控/grafana/邮件配置 ","keywords":"","body":"监控/grafana/邮件配置 一般情况下grafana是管理员【c3的管理员角色用户】可以登陆，普通用户进行查看。 但是有的公司可能会开放grafana的权限给研发自己配置看板。 grafana添加用户是基于邀请的，通过邮件进行邀请。这时候就需要配置一下smtp。 目录下有smtp的例子，主要配置的是smtp的字段和root_url【发送邮件的时候会有root_url字段的内容，让用户点击跳转到平台上】 1.修改好本地的 grafana.ini 文件。可以查看grafana.smtp.ini 的例子。 2.拷贝到容器中 docker cp grafana.ini openc3-grafana:/etc/grafana/grafana.ini 3.重启容器 docker restart openc3-grafana 【注：要保证grafana.ini文件的内容是正确的，c3 reborn的时候会直接使用这个文件】 Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/AGENT/monitor/mongodb-query/":{"url":"open-c3-code/AGENT/monitor/mongodb-query/","title":" 监控/MongodbQuery ","keywords":"","body":"监控/MongodbQuery 提取监控资源 在需要让系统识别出mongodb的资源下面存放提取文件的配置，文件名为（ ingestion-mongodb.yml ） 如: /data/open-c3-data/device/curr/database/huawei-rds/ingestion-mongodb.yml 文件内容如下: addr: [ 'private_ips.0', 'port' ] # 这里描述的是ip地址和端口，如果CMDB中没有一个字段包含ip和端口信息，则需要两个字段进行拼装 #auth: [ 'account' ] # 从CMDB字段中获取,登录数据库的账号和密码，用“:”分隔 #auth: [ 'dbuser','dbpass' ] # 从CMDB字段中获取, 如果登录数据库的账号和密码是CMDB中的两个字段，这里写两个字段 auth: root:abc1234 # CMDB中没有mongodb的账号信息，所有资源是同一个登录账号 #authfile: /data/open-c3-data/device/curr/database/huawei-rds/authfile.dat # 账号信息在一个外部文件中。文件格式下面内容会描述. #authpath: /data/open-c3-data/device/curr/auth/mongodb # 从目录中获取账号，每个资源对应一个文件，文件中有账号。可以和CMDB进行联动。 tree: '服务树' # CMDB中存放服务树信息的字段 type: huawei-rds # 给资源一个分类，这个字符串可以随意内容,非CMDB字段。 外部账号信息： # cat /path/authfile.dat 172.26.0.8:3306;root:abc123 10.60.77.73:3306;root:123456 安装代理 系统提取到mongodb资源后，会根据代理情况把请求打到代理机上，代理机需要运行本目录下的如下脚本管理服务。代理服务会根据查询的资源启动采集容器。 ./init.sh # 初始化，在第一次安装的时候执行 ./start.sh # 启动服务 ./stop.sh # 停止服务 不需要代理的部分请求会打到c3主服务容器内部。由内部服务拉起采集容器。 Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/docs/monitor/mongodb.html":{"url":"open-c3-code/docs/monitor/mongodb.html","title":" 监控/mongodb不同的exporter说明 ","keywords":"","body":"监控/mongodb不同的exporter说明 amazonaws/mongodb_exporter 端口 9001 镜像: amazonaws/mongodb_exporter 启动参数 -mongodb.collect.collection -mongodb.collect.connpoolstats -mongodb.collect.database -mongodb.collect.oplog -mongodb.collect.profile -mongodb.collect.replset -mongodb.collect.top 对应看版: MongoDB https://grafana.com/grafana/dashboards/12079-mongodb/ 高版本报错： https://blog.csdn.net/weixin_50231020/article/details/123237962 percona/mongodb_exporter git : https://github.com/percona/mongodb_exporter 镜像: percona/mongodb_exporter:0.35 端口: 9216 启动参数 ： --collect-all 支持高版本； 对应看板: General / Opstree/Mongodb Dashboard https://grafana.com/grafana/dashboards/16490-opstree-mongodb-dashboard/ Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/AGENT/monitor/mysql-query/":{"url":"open-c3-code/AGENT/monitor/mysql-query/","title":" 监控/MysqlQuery ","keywords":"","body":"监控/MysqlQuery 提取监控资源 在需要让系统识别出mysql的资源下面存放提取文件的配置，文件名为（ ingestion-mysql.yml ） 如: /data/open-c3-data/device/curr/database/huawei-rds/ingestion-mysql.yml 文件内容如下: addr: [ 'private_ips.0', 'port' ] # 这里描述的是ip地址和端口，如果CMDB中没有一个字段包含ip和端口信息，则需要两个字段进行拼装 #auth: [ 'account' ] # 从CMDB字段中获取,登录数据库的账号和密码，用“:”分隔 #auth: [ 'dbuser','dbpass' ] # 从CMDB字段中获取, 如果登录数据库的账号和密码是CMDB中的两个字段，这里写两个字段 auth: root:abc1234 # CMDB中没有mysql的账号信息，所有资源是同一个登录账号 #authfile: /data/open-c3-data/device/curr/database/huawei-rds/authfile.dat # 账号信息在一个外部文件中。文件格式下面内容会描述. #authpath: /data/open-c3-data/device/curr/auth/mysql # 从目录中获取账号，每个资源对应一个文件，文件中有账号。可以和CMDB进行联动。 tree: '服务树' # CMDB中存放服务树信息的字段 type: huawei-rds # 给资源一个分类，这个字符串可以随意内容,非CMDB字段。 外部账号信息： # cat /path/authfile.dat 172.26.0.8:3306;root:abc123 10.60.77.73:3306;root:123456 安装代理 系统提取到mysql资源后，会根据代理情况把请求打到代理机上，代理机需要运行本目录下的如下脚本管理服务。代理服务会根据查询的资源启动采集容器。 ./init.sh # 初始化，在第一次安装的时候执行 ./start.sh # 启动服务 ./stop.sh # 停止服务 不需要代理的部分请求会打到c3主服务容器内部。由内部服务拉起采集容器。 Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/prometheus/config/fping-v2/":{"url":"open-c3-code/prometheus/config/fping-v2/","title":" 监控/ping监控 ","keywords":"","body":"监控/ping监控 源 配置 源是发起ping的主机节点。 在 src 目录下，存放源主机分组，每个文件是一个分组，文件每行是个ip或者域名 例子: [root@open-c3]# ls src cloud-aws-afs cloud-huawei-open-c3 [root@open-c3]# cat src/cloud-huawei-open-c3 openc3-fping [root@open-c3]# cat src/cloud-aws-afs 10.10.10.111 10.10.10.112 在源机器上启动容器 docker run -d --restart=always -p 9605:9605 --name openc3-fping joaorua/fping-exporter fping-exporter --fping=/usr/sbin/fping -c 10 ACL 开放访问权限，让Open-C3机器访问源机器的9605端口 目标 目标是要ping的对象，放在dst目录下，每个文件是一个分组。格式和源一样 配置采集 conf.yml配置着需要采集的任务，是个yaml格式 key是src中源的名称 valus 是个数组，数组中的元素是目标的名称，或者一个正则表达式匹配目标中的名称。 特殊情况，当value是 '*' 时表示所有目标组 例子: # cat conf.yml cloud-huawei-open-c3: [ '/country/', '/website/', '/cloud/', '/workplace/' ] cloud-ucloud-ng: [ '/country/', '/website/' ] cloud-huawei-afs: [ '/cloud/' ] cloud-aws-afs: [ '/country/' ] cloud-aliyun-frankfurt: '*' 生成普罗米修斯配置文件 到容器中该目录下执行 ./make.sh 命令 Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/AGENT/monitor/redis-query/":{"url":"open-c3-code/AGENT/monitor/redis-query/","title":" 监控/RedisQuery ","keywords":"","body":"监控/RedisQuery 提取监控资源 在需要让系统识别出redis的资源下面存放提取文件的配置，文件名为（ ingestion-redis.yml ） 如: /data/open-c3-data/device/curr/database/huawei-rds/ingestion-redis.yml 文件内容如下: addr: [ 'private_ips.0', 'port' ] # 这里描述的是ip地址和端口，如果CMDB中没有一个字段包含ip和端口信息，则需要两个字段进行拼装 #auth: [ 'account' ] # 从CMDB字段中获取,登录数据库的账号和密码，用“:”分隔 #auth: [ 'dbuser','dbpass' ] # 从CMDB字段中获取, 如果登录数据库的账号和密码是CMDB中的两个字段，这里写两个字段 auth: root:abc1234 # CMDB中没有redis的账号信息，所有资源是同一个登录账号 #authfile: /data/open-c3-data/device/curr/database/huawei-rds/authfile.dat # 账号信息在一个外部文件中。文件格式下面内容会描述. #authpath: /data/open-c3-data/device/curr/auth/redis # 从目录中获取账号，每个资源对应一个文件，文件中有账号。可以和CMDB进行联动。 tree: '服务树' # CMDB中存放服务树信息的字段 type: huawei-rds # 给资源一个分类，这个字符串可以随意内容,非CMDB字段。 外部账号信息： # cat /path/authfile.dat 172.26.0.8:3306;root:abc123 10.60.77.73:3306;root:123456 安装代理 系统提取到redis资源后，会根据代理情况把请求打到代理机上，代理机需要运行本目录下的如下脚本管理服务。代理服务会根据查询的资源启动采集容器。 ./init.sh # 初始化，在第一次安装的时候执行 ./start.sh # 启动服务 ./stop.sh # 停止服务 不需要代理的部分请求会打到c3主服务容器内部。由内部服务拉起采集容器。 Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/Connector/pp/mmon/http-monitor/":{"url":"open-c3-code/Connector/pp/mmon/http-monitor/","title":" 监控/业务入口监控 ","keywords":"","body":"监控/业务入口监控 介绍 Open-C3中的CMDB能自动获取企业中的所有域名，nginx配置。 这里可以定时生成所有的业务入口url进行监控。 主要监控业务入口状态码和https证书有效期。 配置 默认情况下不会自动生成这部分监控。 需要在当前目录的src.txt文件中写入采集的源机器的ip或者域名。 可以参考 src.example.txt 文件的格式。 在src.txt的文件中，描述的是你要在什么机器上对业务url地址监控探测。 需要在这些机器上执行本目录中的start-docker.sh脚本。它会在机器上启动一个容器，开启9115端口。 确保open-c3的机器可以访问通这个端口。 snapshot 有的企业，可能需要监控的url很多。一下子不好排查，可以执行./snapshot-make.sh 它会把当前的情况进行一个锁定。如果监控的url返回码发生变化了在进行告警。 获取3个小时内的数据，获取所有url中的返回码。 如果返回码是0的取消，可能是暂时不通。 如果有多个返回码，有200的情况下是200。否则哪个返回码数量多就是哪个。 mark 有的情况下，你可能想自己定义一些要监控的url。在cmdb自动生成的范围之外。 可以把要监控的内容记录到mark.txt文件中，格式可以参考mark.example.txt ignore 系统根据CMDB自动生成了很多要监控的url，如果有不需要监控的，请记录到ignore.txt文件中。 系统会把这部分url屏蔽掉。 格式是一行一个url，可以参考mark.example.txt文件内容 Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/Connector/pp/mmon/node-alive/":{"url":"open-c3-code/Connector/pp/mmon/node-alive/","title":" 监控/主机宕机监控 ","keywords":"","body":"监控/主机宕机监控 正常情况下，Open-C3对所有的主机，都会采集65110端口的监控数据。 但是有的情况下，主机不是很方便安装监控Agent。【如：机器没有登录账号、机器配置低、机器系统版本很小众】 这个情况下，Open-C3会通过多个方式进行探测，来做主机宕机的监控。 该模块会生产一个监控指标\"node_alive\"， 只要机器的内网ip或者外网ip能ping通，或者65110、22、3389中的其中一个端口tcp打开即表示机器是活着。 TODO # C3TODO 240609 主机宕控扩展监控不支持代理 # 该功能目前只能在全网通的情况下使用，在监控主机是否活着的时候， # 任务是在Open-C3主机上执行的，没有区分情况把任务调度到代理机器上执行。 Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/docs/metrics_push_by_pod.html":{"url":"open-c3-code/docs/metrics_push_by_pod.html","title":" 监控/容器中的pod上传监控数据 ","keywords":"","body":"监控/容器中的pod上传监控数据 C3的监控agent支持push方式上传数据，agent部署在node节点上，pod需要知道主机节点的ip，可以通过下面方式进行配置 spec: containers: - env: - name: NODE_IP valueFrom: fieldRef: apiVersion: v1 fieldPath: status.hostIP Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/AGENT/monitor/":{"url":"open-c3-code/AGENT/monitor/","title":" 监控/开发新资源监控的步骤 ","keywords":"","body":"监控/开发新资源监控的步骤 添加一个资源类型监控的步骤 下面以mongodb为例 第一步： 添加测试数据到CMDB中。 添加测试服务的容器启停工具。: /data/open-c3/AGENT/monitor/mongodb-query/dev 第二步: CMDB 添加连接mongodb的的账号管理 授权 mkdir /data/open-c3-data/device/curr/auth/mongodb.auth touch /data/open-c3-data/device/curr/auth/mongodb.auth/open-c3 CMDB 可以编辑mongodb账号 /data/open-c3/c3-front/src/app/pages/device/data/detail.html /data/open-c3/AGENT/lib/api/device.pm 第三步: 添加摄取mongodb资源的工具 c3mc-device-ingestion-mongodb 在容器里面执行一下 c3mc-device-ingestion-mongodb 7 看数据是不是正常的. 测试的数据放到了服务树open-c3下，服务树id是7.所以测试的时候查看一下7号服务树。 第四步: 生成监控对象给prometheus 修改: c3mc-server-agent promesd 添加: c3mc-mon-mongodbsd-format 生成了文件： cat /data/Software/mydan/prometheus/config/openc3_mongodb_sd_v3.yml 第五步: prometheus进行监控数据采集 /data/open-c3/prometheus/config/prometheus.example.yml /data/open-c3/prometheus/config/prometheus.yml prometheus的targets页面能看到采集任务 第六步: 添加mongodb-query 接口 添加： /data/open-c3/AGENT/server/mysqlquery 添加： /data/open-c3/AGENT/agent.mon/lib/OPENC3/MYDan/MonitorV3/MongodbQuery.pm 修改： /data/open-c3/AGENT/tools 中的reload, start, stop 脚本，启动接口 修改： /data/open-c3/AGENT/config/api.agent.x.x.conf.Template /data/open-c3/JOBX/code/server/monitor 的 agent_supervisor 加1 prometheus采集的监控数据的url有数据了，不在是404. http://xxx/api/agent/v3/mongodb/metrics/10.10.10.10:27017 第七步: 启动采集容器 测试启动服务 添加： c3mc-mon-mongodb-v3-exportermaker 测试启动：find /data/open-c3-data/mongodb-exporter-v3/cache/ -type f -mmin -60 | ./c3mc-mon-mongodb-v3-exportermaker 添加： c3mc-mon-mongodb-v3-exporterclean 测试清理: find /data/open-c3-data/mongodb-exporter-v3/cache/ -type f -mmin -60 | ./c3mc-mon-mongodb-v3-exporterclean 添加： c3mc-mon-mongodb-v3-exportercheck 测试配置变更清理 c3mc-server-agent extend-exporter 启动上面三个任务 第八步: 为mongodb生成proxy和carry数据 添加Connector/pp/c3mc-mon-carry-mongodb c3mc-server-agent carry 添加mogodb部分 第九步: 把验证后的代码打tag，生成一个allinone镜像，用于代理使用。 第十步: /data/open-c3/Installer/C3/mongodb-query 添加代理镜像构建工具。 docker run -it -p 9216:9216 -p 17001:17001 percona/mongodb_exporter:0.20 --mongodb.uri mongodb://root:123456@10.10.10.10 Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/Connector/pp/mmon/exmesg/":{"url":"open-c3-code/Connector/pp/mmon/exmesg/","title":" 监控/监控告警转发 ","keywords":"","body":"监控/监控告警转发 有些监控，是直接产生于其他平台，比如华为云、AWS等。 为了方便的统一查看所有的告警和统一告警出口，Open-C3提供了回调地址。允许其他监控告警消息回调到Open-C3上。 配置回调地址 在第三方平台上添加Open-C3的回调地址 http://open-c3xxx.com/api/ci/exmesg/[type]?group=[report_group] 其中[type]是消息的类型，消息处理的时候会根据这个类型进行处理，如果没有定义，就会用默认的处理方式。 [report_group]对应C3里面的告警组，如果找不到对应的组，会默认使用名字为report的组。 [例] http://open-c3xxx.com/api/ci/exmesg/huawei_rds?group=huawei_report [注]当前支持的type: nexus 、default Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/Connector/pp/mmon/exalarm/":{"url":"open-c3-code/Connector/pp/mmon/exalarm/","title":" 监控/监控扩展 ","keywords":"","body":"监控/监控扩展 有些监控，是直接产生于其他平台，比如华为云、AWS等。 为了方便的统一查看所有的告警和统一告警出口，Open-C3提供了回调地址。允许其他监控告警消息回调到Open-C3上。 华为云 在华为云上添加Open-C3的回调地址 [例]http://open-c3xxx.com/api/ci/exalarm/huawei?account=xx&group=yunwei 当告警发生时，可以看到Open-C3的普罗米修斯上会有exalarm监控指标，可以通过这个指标来配置告警。 Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/AGENT/monitor/push/":{"url":"open-c3-code/AGENT/monitor/push/","title":" 监控/自定义push指标 ","keywords":"","body":"监控/自定义push指标 通过本地脚本push的方式添加监控指标 把采集脚本添加到crontab中每分钟执行一次 脚本介绍 vm_dns_check 用途：监控本地主机dns解析是否正常，可以同时监控多个 例： ./vm_dns_check.sh www.baidu.com # 不写名称默认名称为default ./vm_dns_check.sh www.google.com abc 到监控系统中使用监控指标vm_dns_check配置告警。 Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/Connector/pp/mmon/resourcelow/dump/":{"url":"open-c3-code/Connector/pp/mmon/resourcelow/dump/","title":" 监控/获取资源监控表格 ","keywords":"","body":"监控/获取资源监控表格 导出资源列表，列表中包含资源类型，资源Owner，资源CPU和内存使用率等。 例: c3mc-mon-aws-rds-dump # 获取aws rds表格 c3mc-mon-aws-redis-dump # 获取aws redis表格 c3mc-mon-aws-alb-dump # 获取aws alb表格 c3mc-mon-aws-elb-dump # 获取aws elb表格 c3mc-mon-aws-nlb-dump # 获取aws nlb表格 Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/Connector/pp/device/crontab/resources-fee-change-notify/":{"url":"open-c3-code/Connector/pp/device/crontab/resources-fee-change-notify/","title":" 监控/资源配置变更通知 ","keywords":"","body":"监控/资源配置变更通知 为了对服务器成本进行有效的管理，需要知道所有配置变更的情况。 有的云平台可以设置自动扩容，当资源不足时，平台会对资源进行自动扩容。 当资源配置变更时，Open-C3会发出通知。 使用方式 在Open-C3的地址簿中添加open-c3-fee这个用户。系统会默认给这个用户发送消息。 Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/Connector/pp/mmon/migrate/tree-unmonitor/":{"url":"open-c3-code/Connector/pp/mmon/migrate/tree-unmonitor/","title":" 监控迁移/unmonitor服务树 ","keywords":"","body":"监控迁移/unmonitor服务树 监控迁移过程中，遇到部分子树是不需要监控。 比如 .unmonitor 和 .pool 结尾的服务树下的资源是不需要监控的。 执行./run 脚本，会把这些服务树的 “服务树继承解除”的开关打开。 这样他们父树上的监控策略就可以过滤掉这些资源的监控。 Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/Connector/pp/mmon/migrate/from-falcon/":{"url":"open-c3-code/Connector/pp/mmon/migrate/from-falcon/","title":" 监控迁移/从falcon迁移到Open-C3 ","keywords":"","body":"监控迁移/从falcon迁移到Open-C3 迁移步骤 1. 准备好迁移表格,内容类似于本目录下的debug.csv文件，需要字段在本文'字段要求'中有描述 2. 执行命令 cat debug.csv|./make-data 生成策略到dist中。看情况是否要执行前清理dist目录。 3. 导入策略到系统中，执行命令 ./load-data 在前端设置好模版 把模版倒出来 c3mc-mon-rule-dump -t 12 > rule_tpl/mem.memused.percent 3. 修改模版中要修改的，现在应该就是三个变量, 可以参考 load.1min 模版，搜索里面的VAR关键字 字段要求 要导入的表格，需要包含如下字段: metric # 监控指标名称 priority # 监控级别 func: # 处理函数，会生成普罗米修斯的for字段 right_value # 阈值 op: # 比较, 比如 , = , == tags: file.check # tag 添加识别的字段的方式 1. 在前端编辑好策略 2. 导出策略 c3mc-mon-rule-dump -t 12 > rule_tpl/mem.memused.percent 3. 修改导出的策略，用变量替换上需要替换的位置，可以参考load.1min模版中的变量，在里面搜索一下VAR即可看出。 注 导出时候可以根据mark标记只导出部分的数据。 格式为 cat debug.csv |./make-data grep1 grep2 ... grepn 如： 只导出 simplemetric 的策略 cat debug.csv |./make-data simplemetric 迁移操作 #迁移过程中，如果策略很多，普罗米修斯可能会顶不住，可以缓慢导入。 ./run-debug 2 100 debug.csv # 导入第二行到100行， 第一行是标题 ./run-debug 101 200 debug.csv # 导入第100行到200行 后续注意 自定义 jvm_OldGen_Util/project=xxx-im > 0.9 导致误报，因为默认的函数是一个四舍五入 round(avg(jvm_OldGen_Util{project=\"xxx-im\"}) by (instance)) > 0.9 改成了如下： (avg(jvm_OldGen_Util{project=\"xxx-im\"}) by (instance)) > 0.9 Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/Connector/pp/mmon/migrate/alarm-subscription/":{"url":"open-c3-code/Connector/pp/mmon/migrate/alarm-subscription/","title":" 监控迁移/告警订阅迁移 ","keywords":"","body":"监控迁移/告警订阅迁移 # debug.csv 中和策略导入使用的是同一个文件，使用了文件中的treeid和uic字段。 # 导入之前需要把告警组和告警人的地址簿导入。因为原始的uic字段是不区分人和组的。 # 导入的过程中会在c3的数据库查找来定义对应的uic是人还是组 # 执行下面的命令导入数据 cat debug.csv |./make-data | c3mc-base-monitorsubscribe-load --user 'openc3-migrate@sys' Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/AGENT/scripts/installAgentMonFalconMigrate.html":{"url":"open-c3-code/AGENT/scripts/installAgentMonFalconMigrate.html","title":" 监控迁移/数据与falcon兼容 ","keywords":"","body":"监控迁移/数据与falcon兼容 falcon的agent使用的是1988端口，OpenC3的agent使用的是65110端口。 在迁移过程中，需要部署两个agent，两个agent会各自采集数据。但是有一个数据是比较特殊的，就是本地的采集脚本push到falcon agent本地端口上的数据（1988端口）。 正常的情况下，只要把数据一样的格式上报到1988和65110端口即可。 但是可能falcon已经用了很长一段时间，主机上也有很多的脚本，甚至有本地的二进制程序会push数据到本地的1988端口，这时候全部修改上报逻辑就会很麻烦。 可以通过下面方式进行解决： curl -L http://your_openc3_addr/api/scripts/installAgentMonFalconMigrate.sh |sudo bash 该脚本安装后，会把原来falcon 1988端口改成1987，然后在1988端口上启动一个服务，当有数据请求1988端口时，会把数据同时提供给1987和65110. 版本 版本包含两个信息: 个位表示状态（0: 数据提供给falcon和open-c3; 1: 数据只给一方，比如只给open-c3） 十位以上表示代码版本 10+: 最开始的版本 20+: 执行/opt/mydan/dan/agent.mon/bin/falcon_migrate_ecs_tag,把ecs监控容器中的标签提取到本地，监控agent处理push数据时追加标签。 30+: 安装兼容程序时，脚本默认启动ecs标签处理的定时任务，5分钟执行一次。 40+: ecs容器的id字符串允许有减号，否则可能很多ecs容器的tag无法识别。 50+: 修复内存泄漏问题，tcp释放问题。【重要】 60+: 添加文件标志 touch /opt/mydan/dan/agent.mon/falcon_migrate.nofalcon，如果有这个标识就不发送复制数据到falcon了。 说明falcon下线了。 如果falcon下线（也就是有这个标识文件），那么版本是61。 Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/Connector/pp/mmon/migrate/user-addr/":{"url":"open-c3-code/Connector/pp/mmon/migrate/user-addr/","title":" 监控迁移/迁移告警接收人信息 ","keywords":"","body":"监控迁移/迁移告警接收人信息 # debug.csv 文件中有四列数据，第一列是用户名、第二例是邮箱地址、 # 第三列接收短信的手机号、第四列是接收电话的手机号（可以为空，为空时和短信手机号一致）。 # 执行下面的命令导入数据 cat debug.csv |sed 1d|sed 's/\\t/;/g' | c3mc-base-useraddr-load --user 'openc3-migrate@sys' # 注: 上述命令会去掉第一行的表头 Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/Connector/pp/mmon/migrate/alarm-group/":{"url":"open-c3-code/Connector/pp/mmon/migrate/alarm-group/","title":" 监控迁移/迁移告警组 ","keywords":"","body":"监控迁移/迁移告警组 # debug.csv 文件中有三列数据，第一列是组名，第二例是用户列表（多个用户用英文的逗号分隔），第三列是组的备注信息 # 执行下面的命令导入组 cat debug.csv |sed 1d|sed 's/\\t/;/g' | c3mc-mon-alarm-group-load --user 'openc3-migrate@sys' # 注: 上述命令会去掉第一行的表头 Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/AGENT/cloudmon/exporter/elasticsearch-exporter/":{"url":"open-c3-code/AGENT/cloudmon/exporter/elasticsearch-exporter/","title":" 监控采集器/elasticsearch ","keywords":"","body":"监控采集器/elasticsearch 测试容器 docker run -d -p 9200:9200 -p 9300:9300 -e ES_JAVA_POTS=\"-Xms128m -Xmx128m\" -e \"discovery.type=single-node\" elasticsearch:7.8.0 配置文件 无密码 url: http://10.10.1.1:9200 有密码 url: 'http://admin:pass@localhost:9200' 注： 格式为：://:@: 如该有特殊字符，需要url格式转码 grafana dashboard https://grafana.com/grafana/dashboards/6483 Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/AGENT/cloudmon/exporter/kube-state-metrics-v2/":{"url":"open-c3-code/AGENT/cloudmon/exporter/kube-state-metrics-v2/","title":" 监控采集器/kube-state-metrics-v2 ","keywords":"","body":"监控采集器/kube-state-metrics-v2 target: 10.10.10.10:8080 path: /metrics Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/AGENT/cloudmon/exporter/metrics/":{"url":"open-c3-code/AGENT/cloudmon/exporter/metrics/","title":" 监控采集器/metrics ","keywords":"","body":"监控采集器/metrics target: 10.10.10.10:8080 path: /metrics Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/AGENT/cloudmon/exporter/prometheus-federate/":{"url":"open-c3-code/AGENT/cloudmon/exporter/prometheus-federate/","title":" 监控采集器/prometheus-federate ","keywords":"","body":"监控采集器/prometheus-federate target: 10.10.10.10:9090 Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/AGENT/cloudmon/exporter/cloudwatch-exporter/":{"url":"open-c3-code/AGENT/cloudmon/exporter/cloudwatch-exporter/","title":" 监控采集器/云监控/AWS ","keywords":"","body":"监控采集器/云监控/AWS https://github.com/prometheus/cloudwatch_exporter 配置例子 --- ak: 'ak' sk: 'sk' region: us-west-2 metrics: - aws_namespace: AWS/RDS aws_metric_name: DatabaseConnections aws_dimensions: [ DBInstanceIdentifier] aws_statistics: [Maximum] - aws_namespace: AWS/RDS aws_metric_name: FreeableMemory aws_dimensions: [ DBInstanceIdentifier] aws_statistics: [Maximum] - aws_namespace: AWS/RDS aws_metric_name: CPUUtilization aws_dimensions: [ DBInstanceIdentifier] aws_statistics: [Maximum] - aws_namespace: AWS/RDS aws_metric_name: FreeStorageSpace aws_dimensions: [ DBInstanceIdentifier] aws_statistics: [Maximum] - aws_namespace: AWS/ELB aws_metric_name: RequestCount aws_dimensions: [AvailabilityZone, LoadBalancerName] aws_statistics: [Sum] - aws_namespace: AWS/ElastiCache aws_metric_name: EngineCPUUtilization aws_dimensions: [ CacheClusterId] aws_statistics: [Maximum] - aws_namespace: AWS/ElastiCache aws_metric_name: DatabaseMemoryUsagePercentage aws_dimensions: [ CacheClusterId] aws_statistics: [Maximum] 获取metrics列表 AWS_ACCESS_KEY_ID='ak' AWS_SECRET_ACCESS_KEY='sk' aws cloudwatch list-metrics AWS_ACCESS_KEY_ID='ak' AWS_SECRET_ACCESS_KEY='sk' aws cloudwatch list-metrics --namespace AWS/RDS AWS_ACCESS_KEY_ID='ak' AWS_SECRET_ACCESS_KEY='sk' aws cloudwatch list-metrics --namespace AWS/ElastiCache 生成配置文件 上述配置文件的编写步骤繁琐，可以通过如下方式生产配置文件。 # 查看可用的namespace ./cloudmon/exporter/cloudwatch-exporter/config-make --ak yourak --sk yoursk --region ap-southeast-1 # 生成某类资源的配置 ./cloudmon/exporter/cloudwatch-exporter/config-make --ak yourak --sk yoursk --region ap-southeast-1 --namespace AWS/Kafka 云监控账号生成控制 默认情况下，程序会把所有CMDB中的账号的所有资源的区域都生成云监控配置。 但是有的情况下，可能需要控制只监控部分账号或部分区域。 或者不监控部分账号的部分区域。 需要在本地放置配置文件 control.conf ， 可以参考配置文件 control.conf.example Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/AGENT/cloudmon/exporter/google-stackdriver-exporter/":{"url":"open-c3-code/AGENT/cloudmon/exporter/google-stackdriver-exporter/","title":" 监控采集器/云监控/google ","keywords":"","body":"监控采集器/云监控/google github https://github.com/prometheus-community/stackdriver_exporter 可用的指标（Google Cloud 指标） https://cloud.google.com/monitoring/api/metrics Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/AGENT/cloudmon/exporter/cloudeye-exporter/":{"url":"open-c3-code/AGENT/cloudmon/exporter/cloudeye-exporter/","title":" 监控采集器/云监控/华为云 ","keywords":"","body":"监控采集器/云监控/华为云 配置例子: global: prefix: \"huaweicloud\" scrape_batch_size: 300 auth: auth_url: \"https://iam.cn-north-4.myhuaweicloud.com/v3\" project_name: \"cn-north-4\" access_key: \"xxx\" secret_key: \"xxx\" region: \"cn-north-4\" metric: simple # simple or full services: SYS.RDS,SYS.ECS,SYS.DCS Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/AGENT/cloudmon/exporter/tencentcloud-cache-exporter/":{"url":"open-c3-code/AGENT/cloudmon/exporter/tencentcloud-cache-exporter/","title":" 监控采集器/云监控/腾讯云cache ","keywords":"","body":"监控采集器/云监控/腾讯云cache 是tencentcloud-exporter的cache版，tencentcloud-exporter采集数据不稳定，有丢数据的情况。 通过c3的接口进行缓存，如果拿到的数据小于之前正常数据的75%则使用旧的数据返回。 旧的数据最多使用3分钟，如果3分钟后还是不正常的，则返回不正常的数据。 CMDB联动 执行下面命令，把cmdb中的云账号自动同步到云监控中 docker exec openc3-server /data/Software/mydan/AGENT/cloudmon/exporter/tencentcloud-cache-exporter/config-make-from-cmdb 注: 这里暂时不做自动处理，后续看情况可能会让程序自动做联动 Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/AGENT/cloudmon/exporter/tencentcloud-exporter/":{"url":"open-c3-code/AGENT/cloudmon/exporter/tencentcloud-exporter/","title":" 监控采集器/云监控/腾讯云 ","keywords":"","body":"监控采集器/云监控/腾讯云 github https://github.com/tencentyun/tencentcloud-exporter 配置例子 --- credential: access_key: \"ak\" secret_key: \"sk\" region: \"ap-beijing\" products: - namespace: QCE/CMONGO only_include_metrics: [ClusterDiskusage,Connper] all_instances: true extra_labels: [InstanceName,Zone] - namespace: QCE/CDB only_include_metrics: [CpuUseRate,MemoryUseRate,VolumeRate,Capacity] all_instances: true extra_labels: [InstanceName,Zone] - namespace: QCE/REDIS_MEM only_include_metrics: [CpuMaxUtil,MemMaxUtil] all_instances: true extra_labels: [InstanceName,Zone] 获取metrics列表 github 地址的文档里面有, https://github.com/tencentyun/tencentcloud-exporter CMDB联动 本exporter和tencentcloud-cache-exporter功能一致，tencentcloud-cache-exporter是被c3特殊处理优化过的，自动联动的部分默认使用tencentcloud-cache-exporter。 所以要想做联动，请到tencentcloud-cache-exporter下查看。 Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/AGENT/cloudmon/exporter/aliyun-exporter/":{"url":"open-c3-code/AGENT/cloudmon/exporter/aliyun-exporter/","title":" 监控采集器/云监控/阿里云 ","keywords":"","body":"监控采集器/云监控/阿里云 例子: credential: access_key_id: YOUR_ACCESS_ID access_key_secret: YOUR_ACCESS_KEY region_id: cn-beijing metrics: acs_ecs_dashboard: - name: CPUUtilization period: 60 - name: DiskReadBPS period: 60 - name: DiskReadIOPS period: 60 - name: diskusage_utilization period: 15 - name: DiskWriteBPS period: 60 - name: DiskWriteIOPS period: 60 - name: fs_inodeutilization period: 15 - name: InternetIn period: 60 - name: InternetOut period: 60 - name: IntranetIn period: 60 - name: IntranetOut period: 60 - name: load_15m period: 15 - name: load_1m period: 15 - name: load_5m period: 15 - name: memory_actualusedspace period: 15 - name: memory_totalspace period: 15 - name: memory_usedspace period: 15 - name: memory_usedutilization period: 15 - name: net_tcpconnection period: 15 acs_rds_dashboard: - name: ConnectionUsage period: 60 - name: CpuUsage period: 60 - name: DataDelay period: 60 - name: DiskUsage period: 60 - name: IOPSUsage period: 60 - name: MemoryUsage period: 60 - name: MySQL_ActiveSessions period: 60 - name: MySQL_NetworkInNew period: 60 - name: MySQL_NetworkOutNew period: 60 - name: Rt period: 30 - name: TPS period: 30 acs_kvstore: - name: ConnectionUsage period: 60 - name: CpuUsage period: 60 - name: FailedCount period: 60 - name: IntranetIn period: 60 - name: IntranetInRatio period: 60 - name: IntranetOut period: 60 - name: IntranetOutRatio period: 60 - name: MemoryUsage period: 60 - name: Rt period: 10 acs_slb_dashboard: - name: ActiveConnection period: 60 - name: DropConnection period: 60 - name: DropPacketRX period: 60 - name: DropPacketTX period: 60 - name: DropTrafficRX period: 60 - name: DropTrafficTX period: 60 - name: MaxConnection period: 60 - name: NewConnection period: 60 - name: Qps period: 60 - name: Rt period: 60 - name: StatusCode2xx period: 60 - name: StatusCode3xx period: 60 - name: StatusCode4xx period: 60 - name: StatusCode5xx period: 60 - name: TrafficRXNew period: 60 - name: TrafficTXNew period: 60 - name: UnhealthyServerCount period: 60 - name: UpstreamCode4xx period: 60 - name: UpstreamCode5xx period: 60 - name: UpstreamRt period: 60 - name: HeathyServerCount period: 60 acs_mongodb: - name: CPUUtilization period: 300 - name: ConnectionAmount period: 300 - name: ConnectionUtilization period: 300 - name: DataDiskAmount period: 300 - name: DiskUtilization period: 300 - name: GroupCPUUtilization period: 300 - name: GroupConnectionUtilization period: 300 - name: GroupDiskUtilization period: 300 - name: GroupIOPSUtilization period: 300 - name: GroupMemoryUtilization period: 300 - name: GroupShardingCPUUtilization period: 300 - name: GroupShardingConnectionUtilization period: 300 - name: GroupShardingDiskUtilization period: 300 - name: GroupShardingIOPSUtilization period: 300 - name: GroupShardingMemoryUtilization period: 300 - name: IOPSUtilization period: 300 - name: InstanceDiskAmount period: 300 - name: IntranetIn period: 300 - name: IntranetOut period: 300 - name: LogDiskAmount period: 300 - name: MemoryUtilization period: 300 - name: NumberRequests period: 300 - name: OpCommand period: 300 - name: OpDelete period: 300 - name: OpGetmore period: 300 - name: OpInsert period: 300 - name: OpQuery period: 300 - name: OpUpdate period: 300 - name: QPS period: 300 - name: ShardingCPUUtilization period: 300 - name: ShardingConnectionAmount period: 300 - name: ShardingConnectionUtilization period: 300 - name: ShardingDataDiskAmount period: 300 - name: ShardingDataDiskAmountOriginal period: 300 - name: ShardingDiskUtilization period: 300 - name: ShardingIOPSUtilization period: 300 - name: ShardingInstanceDiskAmount period: 300 - name: ShardingIntranetIn period: 300 - name: ShardingIntranetOut period: 300 - name: ShardingLogDiskAmount period: 300 - name: ShardingMemoryUtilization period: 300 - name: ShardingNumberRequests period: 300 - name: ShardingOpCommand period: 300 - name: ShardingOpDelete period: 300 - name: ShardingOpGetmore period: 300 - name: ShardingOpInsert period: 300 - name: ShardingOpQuery period: 300 - name: ShardingOpUpdate period: 300 - name: ShardingQPS period: 300 - name: SingleNodeCPUUtilization period: 300 - name: SingleNodeConnectionAmount period: 300 - name: SingleNodeConnectionUtilization period: 300 - name: SingleNodeDataDiskAmount period: 300 - name: SingleNodeDiskUtilization period: 300 - name: SingleNodeIntranetIn period: 300 - name: SingleNodeIntranetOut period: 300 - name: SingleNodeMemoryUtilization period: 300 - name: SingleNodeNumberRequests period: 300 - name: SingleNodeOpCommand period: 300 - name: SingleNodeOpDelete period: 300 - name: SingleNodeOpGetmore period: 300 - name: SingleNodeOpInsert period: 300 - name: SingleNodeOpQuery period: 300 - name: SingleNodeOpUpdate period: 300 - name: SingleNodeQPS period: 300 info_metrics: - ecs - rds - redis Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/Connector/pp/thirdparty/keycloak/":{"url":"open-c3-code/Connector/pp/thirdparty/keycloak/","title":" 第三方应用/keycloak ","keywords":"","body":"第三方应用/keycloak 安装 & 启动 cd /data/open-c3/Connector/pp/thirdparty/keycloak ./init.sh # 初始化 ./start.sh # 启动服务 # 需要的时候 可以通过./stop.sh停止服务， 通过./restart.sh 重启服务。 常见错误 https 问题 默认会提示 we are sorry, https required.这个是由于安全限制导致的登录失败，在用https的域名访问是不会出现的，如果一定要用IP访问，可以通过下面的命令取消 docker exec -it openc3-keycloak bash cd /opt/jboss/keycloak/bin ./kcadm.sh config credentials --server http://localhost:8080/third-party/keycloak/auth --realm master --user admin ./kcadm.sh update realms/master -s sslRequired=NONE 重启异常 如果服务启动失败，可以尝试去掉启动脚本中的如下两个参数。 -e KEYCLOAK_USER=admin -e KEYCLOAK_PASSWORD=admin Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/JOB/lib/api/to3part/approval.html":{"url":"open-c3-code/JOB/lib/api/to3part/approval.html","title":" 第三方接口/审批 ","keywords":"","body":"第三方接口/审批 发起审批 请求: user_id: 发起人 special_approver: 审批人 title: 审批标题 apply_note: 审批内容 curl --location --request POST 'http://YOUR_OPENC3_IP/api/job/to3part/v1/approval' \\ --header 'appkey: your_appkey' \\ --header 'appname: your_appname' \\ --header 'Content-Type: application/json' \\ --data-raw '{ \"user_id\": \"user1@openc3.org\", \"route_user_id\": \"\", \"special_approver\": \"user2@openc3.org\", \"route_node\": \"0\", \"apply_note\": \"审批的内容\", \"title\": \"审批的标题\", \"participant\": \"\" }' 返回: 其中的djbh字段的内容就是该审批单子的唯一编号，后面用这个这个编号查询审批的状态。 { \"mesg\" : \"ok\", \"stat\" : true, \"code\" : 0, \"data\" : { \"djbh\" : \"9XFHBJySvnhh\", \"msg\" : \"ok\" } } 查询审批状态 查询: djbh: 要查询的审批单的唯一编号。 curl --location --request GET 'http://YOUR_OPENC3_IP/api/job/to3part/v1/approval?djbh=9XFHBJySvnhh' --header 'appkey: your_appkey' --header 'appname: your_appname' 返回: actionname有三种状态：待办、同意、不同意 user_id: 审批人账号 { \"stat\" : true, \"code\" : 0, \"msg\" : \"ok\", \"data\" : { \"isend\" : 0, \"data\" : [ { \"actionname\" : \"待办\", \"user_id\" : \"user001\" } ] } } Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/Connector/lib/api/to3part.html":{"url":"open-c3-code/Connector/lib/api/to3part.html","title":" 第三方接口/用户 ","keywords":"","body":"第三方接口/用户 获取用户部门信息 请求: email: 要查询的用户的名（邮件地址） curl --location --request GET 'http://YOUR_OPENC3_IP/api/connector/to3part/v1/user/department?email=user@openc3.org' --header 'appkey: your_appkey' --header 'appname: your_appname' 返回: { \"msg\" : \"ok\", \"data\" : { \"sybDeptName\" : \"产品线名称\", \"oneDeptName\" : \"一级部门\", \"twoDeptName\" : \"二级部门\", \"sybLeaderId\" : \"产品线领导\", \"oneLeaderId\" : \"一级部门领导\", \"twoLeaderId\" : \"二级部门领导\", \"accountName\" : \"用户名\", \"accountId\" : \"用户账号\", \"mobile\" : \"手机号\" }, \"code\" : 0, \"stat\" : true } 获取用户信息 token: 用户的cookie 请求: curl --location --request GET 'http://YOUR_OPENC3_IP/api/connector/to3part/v1/user/userinfo' -H 'token: PfH42PD5PDGFAaHa7eunF6qIf9HsbgXvCQ03JlzcA52MFUqX5twcQGs579vmZcYX' 返回: { \"admin\" : \"1\", \"showconnector\" : \"1\", \"company\" : \"ccc123\", \"name\" : \"OPEN-C3\", \"email\" : \"open-c3\" } Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/Connector/pp/crontask/":{"url":"open-c3-code/Connector/pp/crontask/","title":" 系统CronTask ","keywords":"","body":"系统CronTask 由文件/data/open-c3-data/bpm/crontask.txt控制 文件格式: 动作;执行时间;操作对象;操作对象的editor暂时没用到);作用开始时间;作用结束时间 如 foo;22;10.10.10.10;open-c3;0;99999999999999 bar;* * * * *;10.10.10.2;open-c2;0;99999999999999 其中动作字段会在/data/open-c3/Connector/pp/crontask/action/目录下有对应的操作脚本。 如foo动作当前有两个操作对象node1和node2，会调用 /data/open-c3/Connector/pp/crontask/action/foo 'node1,node2' 默认短信通知用户：crontask-bot Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/Connector/pp/dbfix/door.html":{"url":"open-c3-code/Connector/pp/dbfix/door.html","title":" 系统修正/纠正数据 ","keywords":"","body":"系统修正/纠正数据 更新默认审批模版 ./approval-template-update #系统升级过程中，可能默认审批模版会有变化。 #执行这个脚本把所有数据库中默认的审批模版更新为最新。 dbtask 定时任务每分钟执行一次，处理那些需要临时执行的sql命令。 Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/Connector/pp/treesync/":{"url":"open-c3-code/Connector/pp/treesync/","title":" 系统迁移/同步服务树绑定关系 ","keywords":"","body":"系统迁移/同步服务树绑定关系 用法 sync.sh 在本目录添加如下sync.sh脚本，从老系统中下载绑定数据，同时加载到系统中 #!/bin/bash set -e cd /data/Software/mydan/Connector/pp/treesync wget http://old.sys.domain.com/api/scripts/alias.yml -O alias.yml.temp.$$ mv alias.yml.temp.$$ alias.yml wget http://old.sys.domain.com/api/scripts/treebind.txt -O treebind.txt.temp.$$ mv treebind.txt.temp.$$ treebind.txt ./dump| c3mc-base-savebind crontask 定时执行同步任务，可以把任务添加到/data/open-c3/Connector/openc3.task.crontab中 */5 * * * * root flock -n /tmp/treesync.lock /data/Software/mydan/Connector/pp/treesync/sync.sh > /tmp/treesync.log 2>&1 数据样例 alias 资源id别名,dump脚本生成的数据会把uuid进行更换后在输出。所以导入数据库的是右边的id。 #head alias.yml --- 000071ab50ceb19f: i-0bc0226045d3e1653 0001e9e95c5e8abb: i-011173d9af83bf779 000204c7ae1a9d87: i-029e67740a4f6f170 0002119c-d4f3-411a-9de5-8c1ec58422a2: 0002119c-d4f3-411a-9de5-8c1ec58422a2 0002244ed9e3fc4d: aa9fc7c95f3e311e9870206b90fe3dbb 0002a068c19abc02: i-0c4568d16e30ac3cd 00031420b7418086: i-07903540c980a355f 00035c7d33bc71d1: 00035c7d33bc71d1 00036fd3492e1408: rm-d9j3mn007gxi9vbz8 treebind 服务树绑定关系，数据为两列，第一列是资源id，第二列是服务树id。资源如果绑定了多个服务树，可以看到资源有多行记录。 #head treebind.txt 3e647efbd1b1f193 0 817f3a497823f8b0 0 08cf9e30247a2169 0 ba378dde5f6294df 0 b9a3e9ead8d93157 0 732e93d28106e70e 0 3d3658c8512d21f5 0 45c263ba32657155 0 67ca292b6250f221 0 73a04a653ddd1f60 0 oldtree 如果系统中已经存在了部分的绑定关系。同步过来后会进行覆盖。为了避免覆盖或者自定义部分的服务树。可以把已经存在的服务树或者希望额外追加的服务树， 可以把绑定关系放到这个文件中，多个服务树用逗号分隔。 #head oldtree.yml cdb-l13o80r2: test.openc3.c3_mon_database.mysql.qcloud_cdb,tree.test2 cdb-poqbzhnn: test.openc3.c3_mon_database.mysql.qcloud_cdb cdb-ji50045i: test.openc3.c3_mon_database.mysql.qcloud_cdb cdb-jpbhtn62: test.openc3.c3_mon_database.mysql.qcloud_cdb cdb-j51nzm3y: test.openc3.c3_mon_database.mysql.qcloud_cdb cdb-gn9pyix2: test.openc3.c3_mon_database.mysql.qcloud_cdb cdb-kkl07z3e: test.openc3.c3_mon_database.mysql.qcloud_cdb cdb-64mihr1o: test.openc3.c3_mon_database.mysql.qcloud_cdb cdb-6skbipb8: test.openc3.c3_mon_database.mysql.qcloud_cdb cdb-pz7giveq: test.openc3.c3_mon_database.mysql.qcloud_cdb Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/tools/pr/":{"url":"open-c3-code/tools/pr/","title":" 自动测试/pr自动测试机器人 ","keywords":"","body":"自动测试/pr自动测试机器人 安装 1. 找一台机器安装单机版C3，切换到指定分支v2.6.0 2. 把/data/open-c3/tools/pr 拷贝到 /data/open-c3-pr 3. 添加机器人github账号的个人token到/etc/c3bot.token 4. 添加定时任务每5分钟执行一次检查 */5 * * * * flock -n /var/c3bot-pr.lock /data/open-c3-pr/run /data/open-c3-pr > /tmp/c3bot-pr.log 2> /tmp/c3bot-pr.err 其它 需要测试的命令写到/data/open-c3/tools/pr/test中。 注: 如test文件有更新，需要手动更新到/data/open-c3-pr 下。 在/etc/c3bot.auth.user路径下写入授权的用户列表。 必须是授权用户提交的pr或者授权用户在pr中回复\"/test\"后，bot才会自动进行测试。 Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/Connector/pp/device/dump-cmdb-summary-cvs/":{"url":"open-c3-code/Connector/pp/device/dump-cmdb-summary-cvs/","title":" 获取CMDB数据导出 ","keywords":"","body":"获取CMDB数据导出 ./summary : 获取概要，只包含基本的信息。用途举例: 给某个云厂商导出资源使用概要。云厂商会跟进这个给出迁移到某云后的成本分析。 ./dump : 获取详细列表 注: 命令会在本地产生一组文件。 Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/Connector/":{"url":"open-c3-code/Connector/","title":" 设置c3维修状态 ","keywords":"","body":"设置c3维修状态 本目录下有c3.maintain文件时, 系统处于维修状态。影响如下： CI发现的tag不进行自动构建。 作业平台中的定时任务不执行。 Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/Connector/migrate/":{"url":"open-c3-code/Connector/migrate/","title":" 迁移/C3服务 ","keywords":"","body":"迁移/C3服务 说明 open-c3部署后，会使用本地的两个目录: /data/open-c3 (程序目录) 和 /data/open-c3-data (数据目录) 正常情况下，只要把这两个目录拷贝到新机器的相同路径下就可以把服务启动到新的机器上。 但是有如下几个问题需要考虑: 1. 我的网络环境比较复杂，在c3的代理管理中配置了很多代理，包括用来做CICD的代理和监控的代理 迁移过去的机器网络都是通的吗，怎么做验证。 2. 我的容器管理中的集群，迁移到新c3后网络是否正常。 3. 我流水线中使用到的git地址，在新c3中网络是否通。 4. 我的c3的open-c3-data目录很大(比如：CI构建出来的项目的历史版本的发布包)，数据需要怎么同步 如果需要关旧c3然后拷贝到新C3后在启动服务，这个时间会比较长，想缩短这个时间避免影响业务使用c3。 为了解决如上描述的几个问题，这里提供了迁移的工具。 使用方式 1. 在新旧c3的机器上部署旧c3的agent，让旧c3可以访问它。【注意：新c3和旧c3部署的都是旧c3的agent】 2. 在新c3中通过一键安装的方式安装单机版c3 2. 在旧c3上执行迁移命令 /data/open-c3/Connector/migrate/sync --node C3的ip 需要确认 keycloak 还能用吗？ serverless 发布添加白名单，账号ip白名单允许新机器发布. 迁移完后 stop， start服务，然后upgrade一下， 因为依赖模块没有解压到容器中，比如perl的依赖模块，导致它启动不去来。 云监控的部分，DB同步后，可能开启两个,需要注意关闭旧C3的云监控。 迁移详细步骤 # 锁住新C3，设置成维护状态 touch /data/open-c3/Connector/c3.maintain /data/open-c3/Connector/c3.maintain.mon /data/open-c3/Connector/c3.maintain.flow c3-restart # 执行迁移操作 /data/open-c3/Connector/migrate/sync --node C3的ip # 确认新c3数据库 到新c3上看一下新发现的tag，是不是都是“reason: sys@app c3.maintain” use ci; select * from openc3_ci_version order by id desc limit 10\\G; # 确认配置是否有需要修改的 检查链接器配置，比如消息出口的ip地址是不是要更换。 系统参数中，比如系统备份的地址是不是要更换。 # 追加数据 需要追加同步的是， ci_repo 和 logs日志，这几天构建出来的包和构建日志 /data/open-c3/Connector/migrate/patch --node C3的ip --day 7 # 用网络c3mc中的网络测试工具测试新旧网络 测试网络差异，包括主机代理, git 等。 Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/docs/migration.html":{"url":"open-c3-code/docs/migration.html","title":" 迁移/从联合使用切换到独立使用 ","keywords":"","body":"迁移/从联合使用切换到独立使用 =================================================== 服务树导入 清空 use connector; delete from openc3_connector_tree; 导入 c3mc-base-treemap | c3mc-base-savetree 检查 select * from openc3_connector_tree; =================================================== 主机绑定关系导入 检查 use agent; select * from openc3_device_bindtree; 导入 cd /data/Software/mydan/Connector/pp/treex ./todb | c3mc-base-savebind 检查一下数据 =================================================== 切换 切换current config.inix/current 登录和服务树权限服务树nodeinfo c3-restart 修正监控 修复监控看版抱错,提示异常，cookie变化引起的。 cookie 从sid修改成u之后，可能会异常，/data/open-c3/open-c3.sh start 修复 【注意：此处主容器可能会recreate,如果是使用高峰期，可以先手动修复】 系统参数中 ，摄取主机 开关打开 c3-restart Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/Connector/tt/migration.html":{"url":"open-c3-code/Connector/tt/migration.html","title":" 迁移/工单数据 ","keywords":"","body":"迁移/工单数据 dump 旧的数据 mysqldump -h $host -uroot -p$password --no-create-info --databases tt > tt.sql 更新sql语句,添加表前缀 sed -i 's/^USE `.*`;/USE `connector`;/' tt.sql sed -i '/^CREATE DATABASE/d' tt.sql sed -i 's/`base_category`/`openc3_tt_base_category`/g' tt.sql sed -i 's/`base_email_templates`/`openc3_tt_base_email_templates`/g' tt.sql sed -i 's/`base_group`/`openc3_tt_base_group`/g' tt.sql sed -i 's/`base_group_user`/`openc3_tt_base_group_user`/g' tt.sql sed -i 's/`base_impact`/`openc3_tt_base_impact`/g' tt.sql sed -i 's/`base_item`/`openc3_tt_base_item`/g' tt.sql sed -i 's/`base_item_group_map`/`openc3_tt_base_item_group_map`/g' tt.sql sed -i 's/`base_type`/`openc3_tt_base_type`/g' tt.sql sed -i 's/`common_lang`/`openc3_tt_common_lang`/g' tt.sql sed -i 's/`common_reply_log`/`openc3_tt_common_reply_log`/g' tt.sql sed -i 's/`common_sys_log`/`openc3_tt_common_sys_log`/g' tt.sql sed -i 's/`common_work_log`/`openc3_tt_common_work_log`/g' tt.sql sed -i 's/`ticket`/`openc3_tt_ticket`/g' tt.sql sed -i 's/`ticket_attachment`/`openc3_tt_ticket_attachment`/g' tt.sql cp tt.sql /data/open-c3/Connector/tt/init/init.sql 初始化数据库 到容器中执行: cd /data/Software/mydan/Connector/tt/init && ./dbinit.sh force Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/docs/maintain.html":{"url":"open-c3-code/docs/maintain.html","title":" 迁移/把C3从集群中迁移到单机版 ","keywords":"","body":"迁移/把C3从集群中迁移到单机版 停止CI和定时任务 #touch 如下文件，关闭掉ci的自动构建和corntab作业任务的执行。 touch /data/open-c3/Connector/c3.maintain 挂载线上共享目录 mount -t glusterfs 10.10.10.10:/c3smx/c3_master/glusterfs /data/open-c3-data/glusterfs 注: 10.10.10.10:/c3smx/c3_master/glusterfs 为线上集群的共享目录。 把c3容器重新启动起来 重新启动的容器会把挂载的路径映射到容器内部。 替换current文件 通过glusterfs把current文件同步，并替换到新C3 更新数据库 通过glusterfs把最新的数据库备份文件放到c3的目录下,为了避免干扰，可以把本机无用的删除了. /data/open-c3-data/backup/mysql 恢复数据库：./databasectrl.sh recovery 221123.210501 更新其他数据 在master上 dump.sh 在新c3上load.sh # 【工具路径 /data/open-c3/Connector/maintain】 在master dump_log.sh foo 在新c3上load_load.sh foo # 这里如果有多个机器，每个的日志都要同步过来 Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/Connector/pp/diff/cmdb/":{"url":"open-c3-code/Connector/pp/diff/cmdb/","title":" 迁移/数据对比/资源绑定关系对比 ","keywords":"","body":"迁移/数据对比/资源绑定关系对比 什么时候需要用到 1. 当前服务树和服务树的绑定关系来自第三方系统。 2. 已经启用CMDB，而且CMDB中也配置了资源和服务树的绑定关系。 3. 想把服务树主机来源切换到从CMDB摄取。 使用方式 执行目录下的 ./run.pl 这个工具会检查所有流水线和作业所在的节点，确认切换前后服务树下主机资源是否一致。 Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/docs/connector-link.html":{"url":"open-c3-code/docs/connector-link.html","title":" 连接器/对接 ","keywords":"","body":"连接器/对接 如果需要进行连接器对接，需要按照这个文档实现OPEN-C3定义的接口。 登录 获取用户信息 说明： 通过cookie查询用户的信息，配置示例： http://api.connector.open-c3.org/internal/user/username?cookie= 系统调用的时候会把用户的cookie带入进行查询。 调用示例： [root@openc3-srv-docker /]# curl 'http://api.connector.open-c3.org/internal/user/username?cookie=v2aOqUGsQ2mdNrVgynQW73qzWTrXwPlXKgRClIJQdIIZYPPmD7Zz0q2HqhQx3Svd' { \"stat\" : true, \"data\" : { \"admin\" : 1, \"showconnector\" : 1, \"company\" : \"default\", \"user\" : \"open-c3\" } } 返回结果说明： stat： true # 查询正常，固定内容。如果系统故障可以返回false data: 返回查询的内容 data.admin # 0 或 1， 1时表示该用户为管理员，OPEN-C3会通过这个控制前端的显示，有些页面只有管理员可见。 data.showconnector # 0 或 1， OPEN-C3通过这个来控制前端是否显示连接器页面。1为显示。 data.company # 表示公司的名称，为一个字符串。用来控制镜像和密钥共享（密钥和镜像可以选择共享给组织内部）。 data.user # 用户名称，这里最好返回的是用户的邮箱。 用户登出 说明： 通过cookie调用注销用户的登录： http://api.connector.open-c3.org/default/user/logout?sid= 系统调用的时候会把用户的cookie带入进行调用。 调用示例： [root@openc3-srv-docker /]# curl 'http://api.connector.open-c3.org/default/user/logout?sid=v2aOqUGsQ2mdNrVgynQW73qzWTrXwPlXKgRClIJQdIIZYPPmD7Zz0q2HqhQx3Svd' { \"stat\" : true, \"info\" : \"ok\" } 回调 说明: 该地址为当检查到用户没有登录时要跳转的页面，有如下两种格式 格式一：/#/login?callback= 格式二：http://sso.mydomain.org/login?callback= (格式一不是以http开通，系统会默认带上OPEN-C3当前的域名。) 跳转过程中会把访问OPEN-C3的地址带在后面，如: http://sso.mydomain.org/login?callback=http://www.open-c3.org/#/connector/config/123 cookie名 平台用的cookie名称。 服务树 用户服务树 说明： 通过cookie查询用户的服务树信息，配置示例： http://api.connector.open-c3.org/default/tree 系统调用的时候会把用户的cookie带入进行查询。 调用示例： [root@openc3-srv-docker /]# curl 'http://api.connector.open-c3.org/default/tree?cookie=j8wKymLzyeJGT0GLIF4QIDLgRWo8vD3Kk7Kjcjsvw0gHG68U9kKGfxDW0xdtGWtK' { \"stat\" : true, \"data\" : [ { \"children\" : [ { \"children\" : [ { \"children\" : [ { \"id\" : 10, \"name\" : \"c3_demo\" } ], \"id\" : 9, \"name\" : \"opsdev\" } ], \"id\" : 8, \"name\" : \"ops\" } ], \"id\" : 7, \"name\" : \"open-c3\" } ] } 全量服务树 说明： 通过appname、appkey查询平台的全量服务树。配置示例： http://api.connector.open-c3.org/default/tree/map 调用示例： [root@openc3-srv-docker /]# curl -H 'appname: jobx' -H 'appkey: 14318225215653259055111884215373' http://api.connector.open-c3.org/default/tree/map { \"stat\" : true, \"data\" : [ { \"id\" : 7, \"name\" : \"open-c3\", \"update_time\" : \"0000-00-00 00:00:00\", \"len\" : 1 }, { \"update_time\" : \"0000-00-00 00:00:00\", \"len\" : 2, \"id\" : 8, \"name\" : \"open-c3.ops\" }, { \"update_time\" : \"0000-00-00 00:00:00\", \"len\" : 3, \"name\" : \"open-c3.ops.opsdev\", \"id\" : 9 }, { \"name\" : \"open-c3.ops.opsdev.c3_demo\", \"id\" : 10, \"update_time\" : \"0000-00-00 00:00:00\", \"len\" : 4 } ] } 服务树资源 说明： 通过appname、appkey查询指定服务树节点机器资源。配置示例： http://api.connector.open-c3.org/default/node/api/ 查询过程中会在末尾添加查询的服务树节点号。 调用示例： [root@openc3-srv-docker /]# curl -H 'appname: jobx' -H 'appkey: 14318225215653259055111884215373' http://api.connector.open-c3.org/default/node/api/0 { \"data\" : [], \"stat\" : true } [root@openc3-srv-docker /]# curl -H 'appname: jobx' -H 'appkey: 14318225215653259055111884215373' http://api.connector.open-c3.org/default/node/api/10 { \"stat\" : true, \"data\" : [ { \"id\" : 0, \"type\" : \"idc\", \"exip\" : \"\", \"inip\" : \"10.60.77.61\", \"name\" : \"10.60.77.61\" }, { \"inip\" : \"10.60.77.62\", \"name\" : \"10.60.77.62\", \"exip\" : \"\", \"id\" : 1, \"type\" : \"idc\" }, { \"exip\" : \"\", \"type\" : \"idc\", \"id\" : 2, \"inip\" : \"10.60.77.75\", \"name\" : \"10.60.77.75\" } ] } 权限控制 权限点分两种类型，一种是和服务树相关，另一种是服务树无关。 服务树接口示例： http://api.connector.open-c3.org/default/auth/point 服务树无关: http://api.connector.open-c3.org/default/auth/point?point=$point&cookie=$cookie 服务树相关: http://api.connector.open-c3.org/default/auth/point?point=$point&treeid=$treeid&cookie=$cookie 权限点： #级别说明： 0=> 登录用户 1 => 研发 2 => 运维 3 => 管理员 # 全局权限点 my %pointG = ( openc3_job_root => [ 3 ], # job管理员 openc3_jobx_root => [ 3 ], # jobx管理员 openc3_ci_root => [ 3 ], # ci管理员 openc3_agent_root => [ 3 ], # agent管理员 openc3_connector_root => [ 3 ], # connector管理员 ); # 服务树相关权限点 my %pointT = ( openc3_job_read => [ 0, 1, 2, 3 ], # 读取job的信息 openc3_job_write => [ 2, 3 ], # 修改job的配置 openc3_job_delete => [ 2, 3 ], # 删除job的配置 openc3_job_vssh => [ 2, 3 ], # 使用虚拟终端 openc3_job_vsshnobody => [ 1, 2, 3 ], # 使用nobody用户的虚拟终端 openc3_job_control => [ 1, 2, 3 ], # 操作job openc3_jobx_read => [ 0, 1, 2, 3 ], # 读取jobx的信息 openc3_jobx_write => [ 2, 3 ], # 修改jobx的配置 openc3_jobx_delete => [ 2, 3 ], # 删除jobx的配置 openc3_jobx_control => [ 1, 2, 3 ], # 操作jobx openc3_ci_read => [ 0, 1, 2, 3 ], # 读取ci的信息 openc3_ci_write => [ 2, 3 ], # 修改ci的配置 openc3_ci_delete => [ 2, 3 ], # 删除ci的配置 openc3_ci_control => [ 1, 2, 3 ], # 操作ci openc3_agent_read => [ 0, 1, 2, 3 ], # 读取agent的信息 openc3_agent_write => [ 2, 3 ], # 修改agent的配置 openc3_agent_delete => [ 2, 3 ], # 删除agent的配置 openc3_connector_read => [ 0, 1, 2, 3 ], # 读取connector的信息 openc3_connector_write => [ 2, 3 ], # 修改conector的配置 openc3_connector_delete => [ 2, 3 ], # 删除connector的配置 ); 调用示例： [root@openc3-srv-docker /]# curl 'http://api.connector.open-c3.org/default/auth/point?point=openc3_job_read&cookie=j8wKymLzyeJGT0GLIF4QIDLgRWo8vD3Kk7Kjcjsvw0gHG68U9kKGfxDW0xdtGWtK' { \"data\" : 1, \"stat\" : true } [root@openc3-srv-docker /]# curl 'http://api.connector.open-c3.org/default/auth/point?point=openc3_job_read&treeid=10&cookie=j8wKymLzyeJGT0GLIF4QIDLgRWo8vD3Kk7Kjcjsvw0gHG68U9kKGfxDW0xdtGWtK' { \"data\" : 1, \"stat\" : true } 返回结果说明： stat： true # 查询正常 data: 是否有权限，1为有权限，0为无权限 消息出口 消息出口需要appname和appkey完成验证【添加http的Header】。 邮件 配置的地址示例: http://api.connector.open-c3.org/default/mail 调用方式：POST 参数 user：用户名，接口需要自己查询对应的用户的邮箱地址 title: 邮件标题 content: 邮件内容 返回：{ stat： true } 短信 配置的地址如下: http://api.connector.open-c3.org/default/mesg 调用方式：POST 参数 user：用户名，接口需要自己查询对应的用户的手机号 mesg: 短信内容 返回：{ stat： true } 语音 配置的地址如下: http://api.connector.open-c3.org/default/mesg #使用内置是和短信接口一样 调用方式：POST 参数 user：用户名，接口需要自己查询对应的用户的手机号 mesg: 语音内容 返回：{ stat： true } 外部辅助审批 用于辅助审批，如有OA系统，可以进行OA审批对接。 可以缺省，缺省情况下说明无外部审批功能。 审批接口 审批接口示例： http://api.connector.open-c3.org/connectorx/approval 需要实现两个调用，GET和POST，POST用于提交审批，GET用于查询审批状态。 方法：POST 参数 content： 审批内容 submitter： 提交人 approver： 审批人 返回 { stat: true, data: $uuid } #其中$uuid为外部系统的审批单号 方法：GET 参数：uuid 返回{ stat: true, data: { status: $status, reason: 'null' } } 其中$status 为审批单据的状态，状态可以为agree（同意）、refuse（拒绝）、unconfirmed（未审批） 其他 连接器使用的HTTP Header进行验证的部分，在前端页面上不是每一个都可以进行配置， 如果前端上没有进行显示，可以直接修改配置文件/data/open-c3/Connector/config.inix。 可以参考下面配置： cookiekey: sid pmspoint: http://console.jy.com/api/keystone/platform/permission pmspointenv: appkey: kkk appname: ad ssocallback: http://console.jy.com/account/login?from=openc3&redirect=http://openc3.org/api/connector/connectorx/setcookie?c3redirect= ssochpasswd: http://console.jy.com/setting/personalGroup/myprofile ssologoutaddr: http://console.jy.com/account/login?from=openc3logout&redirect=http://openc3.org/api/connector/connectorx/setcookie?c3redirect=http://openc3.org ssousername: http://console.jy.com/api/keystone/platform/user?cookie= ssousernameenv: appkey: kkk appname: ad usertree: http://console.jy.com/api/keystone/platform/servicetree usertreeenv: appkey: kkk appname: ad nodeinfo: http://console.jy.com/api/platform/c3/serviceTree/node/ nodeinfoenv: appkey: kkk appname: ad treemap: http://console.jy.com/api/keystone/platform/allservicetree treemapenv: appkey: kkk appname: ad usermail: http://api.connector.open-c3.org/default/mail usermailenv: appkey: c3random appname: jobx usermesg: http://api.connector.open-c3.org/default/mesg usermesgenv: appkey: c3random appname: jobx 上面配置中使用到了http://openc3.org/api/connector/connectorx/setcookie接口进行cookie的单独处理。 把http://openc3.org改成本服务的地址。 把http://console.jy.com改成提供连接器接口的地址。 在页面上重新保存不会影响多出来的参数。 关于登出接口，如果有ssologoutapi，会使用该接口进行api调用进行登出， 如果没有ssologoutapi而是配置了ssologoutaddr，会通过重定向到ssologoutaddr进行登出。 如果ssologoutapi和ssologoutaddr都没有系统会报错。 资源释放 连接器中的服务树被外部系统接管后，服务树节点的删除要询问OPEN-C3系统该节点是否可以删除，从而保证系统一致。 询问方法: http://open-c3.my.domain/api/connector/release?id=服务树节点id 接口会返回两种情况，都为字符串，分别为： true 、 false 【其中true表示服务树可以释放可以删除，false表示不能删除】 Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/Connector/config.ini/":{"url":"open-c3-code/Connector/config.ini/","title":" 连接器配置说明 ","keywords":"","body":"连接器配置说明 treemap treemap: http://xx.xx.xx.xx:8081/v2/tree/treemap treemapenv: appkey: xx appname: xx treemapgrep: [ 4891 ] # 服务树中 treemapeid: [ 4000, 1000000 ] treemapexstr: ['.foo', '.bar', 'abc'] #配置有OA接口，同时approversync为1时，会对审批状态进行回收. #即：如果审批是在C3上操作的，审批状态会同步到OA系统中. approversync: 1 nodeinfo nodeinfo配置的是服务树获取主机资源的api。 现在的资源是可以从cmdb中摄取的。如果不想从外部也不想从内置的服务树资源获取资源，可以配置为 \"x\" 。 这样获取的时候就会跳过这部分。 Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/Connector/bl/permission/jumpserver/":{"url":"open-c3-code/Connector/bl/permission/jumpserver/","title":" 通过jumpserver添加服务器访问权限 ","keywords":"","body":"通过jumpserver添加服务器访问权限 该命令保存在类似跳板机这种服务器上，主要是有两个要求: 要能够访问 jumpserver 服务 要能通过当前用户 (部署jumpserver服务的用户) ssh无密码登陆目标服务器, 且登陆后允许无密码执行sudo Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/Connector/pp/mmon/crontab/ali-pai/":{"url":"open-c3-code/Connector/pp/mmon/crontab/ali-pai/","title":" 阿里云/PAI/报告 ","keywords":"","body":"阿里云/PAI/报告 初始化 执行 ./init.sh 安装依赖。 不是每个c3都需要这个功能，暂时不做默认安装。 设置 在文件config.txt中配置要报告的PAI集群 如: ak sk region clusteruuid1:clusteralias1 ak sk region clusteruuid1:clusteralias1 clusteruuid2:clusteralias2 ... 消息 默认会定时给用户alipai发送IM消息如下： A800 | U.min | U.avg | U.max | M.min | M.avg | M.max -------------------------------------+-------+-------+-------+-------+-------+------- Cluster | 0.0 | 90.3 | 100.0 | 96.5 | 96.5 | 96.5 lixxxxxxxxxxxi-xxxxxxxxxxxxxxxxq-0 | 0.0 | 89.1 | 100.0 | 96.5 | 96.5 | 96.5 lixxxxxxxxxxxi-xxxxxxxxxxxxxxxxq-1 | 0.0 | 91.7 | 100.0 | 96.5 | 96.5 | 96.5 H800 | U.min | U.avg | U.max | M.min | M.avg | M.max -------------------------------------+-------+-------+-------+-------+-------+------- Cluster | 78.6 | 99.2 | 99.9 | 84.0 | 84.0 | 88.7 xxxxxxxxxxxxxxa0g-mxxxxxxxxxxxxn-0 | 62.5 | 99.2 | 100.0 | 88.9 | 88.9 | 88.9 xxxxxxxxxxxxxxa0g-mxxxxxxxxxxxxn-1 | 0.0 | 97.5 | 99.9 | 31.7 | 31.9 | 32.2 xxxxxxxxxxxxxxa0g-mxxxxxxxxxxxxn-2 | 95.9 | 99.5 | 100.0 | 88.7 | 88.7 | 88.7 xxxxxxxxxxxxxxa0g-mxxxxxxxxxxxxn-3 | 93.9 | 99.3 | 100.0 | 88.5 | 88.5 | 88.5 xxxxxxxxxxxxxxa0g-mxxxxxxxxxpbio-0 | 0.0 | 99.1 | 100.0 | 88.6 | 88.6 | 88.6 xxxxxxxxxxxxxxa0g-mxxxxxxxxxpbio-1 | 93.8 | 99.4 | 100.0 | 88.6 | 88.6 | 88.6 xxxxxxxxxxxxxxa0g-mxxxxxxxxxpbio-2 | 90.4 | 99.4 | 100.0 | 88.8 | 88.8 | 88.8 Time: 2023-09-05 00:00:00 ~ 2023-09-05 23:55:00 Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "},"open-c3-code/docs/cluster.html":{"url":"open-c3-code/docs/cluster.html","title":" 集群版部署 ","keywords":"","body":"集群版部署 把第一台的数据库3306端口打开,/data/open-c3/Installer/C3/docker-compose.yml 添加文件: /data/open-c3/Connector/mysql.config-test --- host: 10.10.10.10 #username: root #password: '123456' #port: 3306 #database: openc3 添加文件: /data/open-c3-data/.open-c3.hostname openc3-srv-docker-002 修改文件: /data/open-c3/Connector/tt/trouble-ticketing/cfg.json 修改数据库地址: OPENC3_DB_IP 到10.10.10.10 拷贝agent的key到第二台机器： /data/open-c3-data/auth/* Copyright 2020 - 2020. all right reserved，powered by Gitbook该文件修订时间： 2025-12-04 23:01:53 "}}